(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("THREE"));
	else if(typeof define === 'function' && define.amd)
		define(["THREE"], factory);
	else if(typeof exports === 'object')
		exports["Sketchbook"] = factory(require("THREE"));
	else
		root["Sketchbook"] = factory(root["THREE"]);
})(window, function(__WEBPACK_EXTERNAL_MODULE_three__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/js/sketchbook.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/js/characters/Character.js":
/*!****************************************!*\
  !*** ./src/js/characters/Character.js ***!
  \****************************************/
/*! exports provided: Character */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Character\", function() { return Character; });\n/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! three */ \"three\");\n/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(three__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _sketchbook_Utilities__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../sketchbook/Utilities */ \"./src/js/sketchbook/Utilities.js\");\n/* harmony import */ var _simulation_SpringSimulation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../simulation/SpringSimulation */ \"./src/js/simulation/SpringSimulation.js\");\n/* harmony import */ var _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../sketchbook/Controls */ \"./src/js/sketchbook/Controls.js\");\n/* harmony import */ var _CharacterAI__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./CharacterAI */ \"./src/js/characters/CharacterAI.js\");\n/* harmony import */ var _CharacterStates__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./CharacterStates */ \"./src/js/characters/CharacterStates.js\");\n// import THREE from 'three';\r\n// import CANNON from 'cannon';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//Character class\r\nclass Character extends three__WEBPACK_IMPORTED_MODULE_0__[\"Object3D\"] {\r\n    \r\n    constructor(world) {\r\n\r\n        super();\r\n\r\n        // Save \"this\" for nested functions\r\n        const scope = this;\r\n    \r\n        this.world = world;\r\n\r\n        // Geometry\r\n        this.height = 1;\r\n        this.modelOffset = new THREE.Vector3();\r\n\r\n        // Default model\r\n        const loader = new THREE.FBXLoader();\r\n        loader.load('resources/models/game_man/game_man.fbx', function (object) {\r\n\r\n            object.traverse( function ( child ) {\r\n                if ( child.isMesh ) {\r\n                    child.castShadow = true;\r\n                    child.receiveShadow = true;\r\n                }\r\n                if( child.name == 'game_man') {\r\n                    child.material = new THREE.MeshLambertMaterial({\r\n                        map: new THREE.TextureLoader().load('resources/models/game_man/game_man.png' ),\r\n                        skinning: true\r\n                    });\r\n                }\r\n            } );\r\n\r\n            // Create visual groups\r\n            // The visual hierarchy goes:\r\n            // this->visuals->modelContainer->characterModel\r\n\r\n            // The visuals group is centered for easy character tilting\r\n            scope.visuals = new THREE.Group();\r\n            scope.add(scope.visuals);\r\n\r\n            // Model container is used to reliably ground the character, as animation can alter the position of the model itself\r\n            scope.modelContainer = new THREE.Group();\r\n            scope.modelContainer.position.y = -scope.height/2;\r\n            scope.visuals.add(scope.modelContainer);\r\n\r\n            // Assign model to character\r\n            scope.characterModel = object;\r\n            // Attach model to model container\r\n            scope.modelContainer.add(object);\r\n        \r\n            // Animation\r\n            scope.mixer = new THREE.AnimationMixer(object);\r\n\r\n            // scope.player.setModel(object);\r\n            scope.setModelOffset(new THREE.Vector3(0, -0.1, 0));\r\n            scope.setState(_CharacterStates__WEBPACK_IMPORTED_MODULE_5__[\"CharacterState_Idle\"]);\r\n        } );\r\n\r\n        // Movement\r\n        this.acceleration = new THREE.Vector3();\r\n        this.velocity = new THREE.Vector3();\r\n        this.velocityTarget = new THREE.Vector3();\r\n        // Velocity spring simulator\r\n        this.defaultVelocitySimulatorDamping = 0.8;\r\n        this.defaultVelocitySimulatorMass = 50;\r\n        this.velocitySimulator = new _simulation_SpringSimulation__WEBPACK_IMPORTED_MODULE_2__[\"VectorSpringSimulator\"](60, this.defaultVelocitySimulatorMass, this.defaultVelocitySimulatorDamping);\r\n        this.moveSpeed = 4;\r\n\r\n        // Rotation\r\n        this.angularVelocity = 0;\r\n        this.orientation = new THREE.Vector3(0, 0, 1);\r\n        this.orientationTarget = new THREE.Vector3(0, 0, 1);\r\n        // Rotation spring simulator\r\n        this.defaultRotationSimulatorDamping = 0.5;\r\n        this.defaultRotationSimulatorMass = 10;\r\n        this.rotationSimulator = new _simulation_SpringSimulation__WEBPACK_IMPORTED_MODULE_2__[\"RelativeSpringSimulator\"](60, this.defaultRotationSimulatorMass, this.defaultRotationSimulatorDamping);\r\n\r\n        // States\r\n        this.setState(_CharacterStates__WEBPACK_IMPORTED_MODULE_5__[\"CharacterState_DefaultState\"]);\r\n        this.viewVector = new THREE.Vector3();\r\n\r\n        // Controls\r\n        this.behaviour = new _CharacterAI__WEBPACK_IMPORTED_MODULE_4__[\"CharacterAI_Default\"](this);\r\n        this.controls = {\r\n            up:        new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            down:      new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            left:      new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            right:     new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            run:       new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            jump:      new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            use:       new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            primary:   new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            secondary: new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            tertiary:  new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"](),\r\n            lastControl: new _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_3__[\"Control_EventControl\"]()\r\n        };\r\n\r\n        // Physics\r\n        // Player Capsule\r\n        const characterMass = 1;\r\n        const initPosition = new CANNON.Vec3(0, 0, 0);\r\n        const characterHeight = 0.5;\r\n        const characterRadius = 0.25;\r\n        const characterSegments = 12;\r\n        const characterFriction = 0;\r\n        const characterCollisionGroup = 2;\r\n        this.characterCapsule = world.createCharacterCapsule(characterMass, initPosition, characterHeight, characterRadius, characterSegments, characterFriction);\r\n        this.characterCapsule.visual.visible = false;\r\n\r\n        // Pass reference to character for callbacks\r\n        this.characterCapsule.physical.character = this;\r\n\r\n        // Move character to different collision group for raycasting\r\n        this.characterCapsule.physical.collisionFilterGroup = characterCollisionGroup;\r\n\r\n        // Disable character rotation\r\n        this.characterCapsule.physical.fixedRotation = true;\r\n        this.characterCapsule.physical.updateMassProperties();\r\n\r\n        // Ray casting\r\n        this.rayResult = new CANNON.RaycastResult();\r\n        this.rayHasHit = false;\r\n        this.rayCastLength = 0.63;\r\n        this.raySafeOffset = 0.03;\r\n        this.wantsToJump = false;\r\n        this.justJumped = false;\r\n\r\n        // Ray cast debug\r\n        const boxGeo = new THREE.BoxGeometry(0.1, 0.1, 0.1);\r\n        const boxMat = new THREE.MeshLambertMaterial({\r\n            color: 0xff0000\r\n        });\r\n        this.raycastBox = new THREE.Mesh(boxGeo, boxMat);\r\n        this.raycastBox.visible = false;\r\n\r\n        // PreStep event\r\n        this.characterCapsule.physical.preStep = function() {\r\n\r\n            // Player ray casting\r\n            // Create ray\r\n            const start = new CANNON.Vec3(this.position.x, this.position.y, this.position.z);\r\n            const end = new CANNON.Vec3(this.position.x, this.position.y - this.character.rayCastLength, this.position.z);\r\n            // Raycast options\r\n            const rayCastOptions = {\r\n                collisionFilterMask: ~2 /* cast against everything except second collision group (player) */,\r\n                skipBackfaces: true     /* ignore back faces */\r\n            };\r\n            // Cast the ray\r\n            this.character.rayHasHit = this.character.world.physicsWorld.raycastClosest(start, end, rayCastOptions, this.character.rayResult); \r\n            \r\n            // Jumping\r\n            if(this.character.wantsToJump && this.character.rayHasHit) {\r\n                this.character.characterCapsule.physical.velocity.y += 4;\r\n                this.character.characterCapsule.physical.position.y += this.character.raySafeOffset;\r\n                this.character.justJumped = true;\r\n            }\r\n            this.character.wantsToJump = false;\r\n        };\r\n\r\n        // PostStep event\r\n        this.characterCapsule.physical.postStep = function() {\r\n        \r\n            // Player ray casting\r\n            // Get velocities\r\n            let simulatedVelocity = new CANNON.Vec3().copy(this.velocity);\r\n            let arcadeVelocity = this.character.velocity.clone().multiplyScalar(this.character.moveSpeed);\r\n            arcadeVelocity = _sketchbook_Utilities__WEBPACK_IMPORTED_MODULE_1__[\"Utilities\"].appplyVectorMatrixXZ(this.character.orientation, arcadeVelocity);\r\n\r\n            // If just jumped, don't stick to ground\r\n            if(this.character.justJumped) this.character.justJumped = false;\r\n            else {\r\n                // If we're hitting the ground, stick to ground\r\n                if(this.character.rayHasHit) {\r\n                    if(this.character.raycastBox.visible) this.character.raycastBox.position.copy(this.character.rayResult.hitPointWorld);\r\n                    this.position.y = this.character.rayResult.hitPointWorld.y + this.character.rayCastLength - this.character.raySafeOffset;\r\n                    this.velocity.set(arcadeVelocity.x, 0, arcadeVelocity.z);\r\n                }\r\n                else {\r\n                    // If we're in air, leave vertical velocity to physics\r\n                    if(this.character.raycastBox.visible) this.character.raycastBox.position.set(this.position.x, this.position.y  - this.character.rayCastLength, this.position.z);\r\n                    this.velocity.set(arcadeVelocity.x, simulatedVelocity.y, arcadeVelocity.z);\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    setModel(model) {\r\n    \r\n        this.modelContainer.remove(this.characterModel);\r\n        this.characterModel = model;\r\n        this.modelContainer.add(this.characterModel);\r\n    \r\n        this.mixer = new THREE.AnimationMixer(this.characterModel);\r\n    }\r\n    \r\n    setModelOffset(offset) {\r\n        this.modelOffset.copy(offset);\r\n    }\r\n    \r\n    setViewVector(vector) {\r\n        this.viewVector.copy(vector).normalize();\r\n    }\r\n    \r\n    /**\r\n     * Set state to the player. Pass state class (function) name.\r\n     * @param {function} State \r\n     */\r\n    setState(State) {\r\n        this.charState = new State(this);\r\n    }\r\n    \r\n    setPosition(x, y, z) {\r\n        this.characterCapsule.physical.position = new CANNON.Vec3(x, y, z);\r\n    }\r\n    \r\n    setVelocity(velZ, velX = 0) {\r\n        this.velocity.z = velZ;\r\n        this.velocity.x = velX;\r\n    }\r\n    \r\n    setVelocityTarget(velZ, velX = 0) {\r\n        this.velocityTarget.z = velZ;\r\n        this.velocityTarget.x = velX;\r\n    }\r\n    \r\n    setOrientationTarget(vector) {\r\n    \r\n        this.orientationTarget.copy(vector).setY(0).normalize();\r\n    }\r\n    \r\n    setBehaviour(bhv) {\r\n        this.behaviour = bhv;\r\n    }\r\n    \r\n    setControl(key, value) {\r\n    \r\n        // Get action and set it's parameters\r\n        let action = this.controls[key];\r\n    \r\n        action.value = value;\r\n    \r\n        // Set the 'just' attributes\r\n        if(value) action.justPressed = true;\r\n        else action.justReleased = true;\r\n    \r\n        // Tag control as last activated\r\n        this.controls.lastControl = action;\r\n    \r\n        // Tell player to handle states according to new input\r\n        this.charState.changeState();\r\n    \r\n        // Reset the 'just' attributes\r\n        action.justPressed = false;\r\n        action.justReleased = false;\r\n    }\r\n    \r\n    resetControls() {\r\n        this.setControl('up', false);\r\n        this.setControl('down', false);\r\n        this.setControl('left', false);\r\n        this.setControl('right', false);\r\n        this.setControl('run', false);\r\n        this.setControl('jump', false);\r\n        this.setControl('use', false);\r\n        this.setControl('primary', false);\r\n        this.setControl('secondary', false);\r\n        this.setControl('tertiary', false);\r\n    }\r\n    \r\n    \r\n    update(timeStep, parameters) {\r\n    \r\n        //Default values\r\n        if(parameters == undefined) parameters = {};\r\n        if(parameters.SpringRotation == undefined) parameters.SpringRotation = true;\r\n        if(parameters.SpringVelocity == undefined) parameters.SpringVelocity = true;\r\n        if(parameters.rotateModel == undefined) parameters.rotateModel = true;\r\n        if(parameters.updateAnimation == undefined) parameters.updateAnimation = true;\r\n    \r\n        this.visuals.position.copy(this.modelOffset);\r\n    \r\n        if(parameters.SpringVelocity)  this.SpringMovement(timeStep);\r\n        if(parameters.SpringRotation)  this.SpringRotation(timeStep);\r\n        if(parameters.rotateModel)     this.rotateModel();\r\n        if(parameters.updateAnimation) this.mixer.update(timeStep);\r\n        \r\n        this.position.set(this.characterCapsule.physical.interpolatedPosition.x,\r\n            this.characterCapsule.physical.interpolatedPosition.y - this.height/2,\r\n            this.characterCapsule.physical.interpolatedPosition.z);\r\n    }\r\n    \r\n    setAnimation(clipName, fadeIn) {\r\n        \r\n        let clips = this.characterModel.animations;\r\n        let clip = THREE.AnimationClip.findByName( clips, clipName );\r\n        let action = this.mixer.clipAction( clip );\r\n        this.mixer.stopAllAction();\r\n        action.fadeIn(fadeIn);\r\n        action.play();\r\n    \r\n        return action._clip.duration;\r\n    }\r\n    \r\n    SpringMovement(timeStep) {\r\n    \r\n        // Simulator\r\n        this.velocitySimulator.target.copy(this.velocityTarget);\r\n        this.velocitySimulator.simulate(timeStep);\r\n        \r\n        // Update values\r\n        this.velocity.copy(this.velocitySimulator.position);\r\n        this.acceleration.copy(this.velocitySimulator.velocity);\r\n    }\r\n    \r\n    SpringRotation(timeStep) {\r\n    \r\n        //Spring rotation\r\n        //Figure out angle between current and target orientation\r\n        let normal = new THREE.Vector3(0, 1, 0);\r\n        let dot = this.orientation.dot(this.orientationTarget);\r\n    \r\n\r\n        let angle = 0;\r\n\r\n        // If dot is close to 1, we'll round angle to zero\r\n        let dot_treshold = 0.9995;\r\n        if (dot > dot_treshold) {\r\n            angle = 0;\r\n        }\r\n        // Dot too close to -1\r\n        else if(dot < -dot_treshold) {\r\n            angle = Math.PI / 2;\r\n        }\r\n        else {\r\n            // Get angle difference in radians\r\n            angle = Math.acos(dot);\r\n            // Get vector pointing up or down\r\n            let cross = new THREE.Vector3().crossVectors(this.orientation, this.orientationTarget);\r\n            // Compare cross with normal to find out direction\r\n            if (normal.dot(cross) < 0) {\r\n                angle = -angle;\r\n            }\r\n        }\r\n        \r\n        // Simulator\r\n        this.rotationSimulator.target = angle;\r\n        this.rotationSimulator.simulate(timeStep);\r\n        let rot = this.rotationSimulator.position;\r\n    \r\n        // console.log(this.orientationTarget);\r\n    \r\n        // Updating values\r\n        this.orientation.applyAxisAngle(normal, rot);\r\n        this.angularVelocity = this.rotationSimulator.velocity;\r\n    \r\n    }\r\n    \r\n    setGlobalDirectionGoal() {\r\n        \r\n        const positiveX = this.controls.right.value ? -1 : 0;\r\n        const negativeX = this.controls.left.value  ?  1 : 0;\r\n        const positiveZ = this.controls.up.value    ?  1 : 0;\r\n        const negativeZ = this.controls.down.value  ? -1 : 0;\r\n        \r\n        const localDirection = new THREE.Vector3(positiveX + negativeX, 0, positiveZ + negativeZ);\r\n        const flatViewVector = new THREE.Vector3(this.viewVector.x, 0, this.viewVector.z);\r\n    \r\n        // If no direction is pressed, set target as current orientation\r\n        // if(positiveX == 0 && negativeX == 0 && positiveZ == 0 && negativeZ == 0) {\r\n        if((localDirection.x == 0 && localDirection.y == 0 && localDirection.z == 0) ||\r\n           (flatViewVector.x == 0 && flatViewVector.y == 0 && flatViewVector.z == 0)) {\r\n            this.setOrientationTarget(this.orientation);\r\n        }\r\n        else {\r\n            this.setOrientationTarget(_sketchbook_Utilities__WEBPACK_IMPORTED_MODULE_1__[\"Utilities\"].appplyVectorMatrixXZ(flatViewVector, localDirection));\r\n        }\r\n    }\r\n    \r\n    rotateModel() {\r\n        this.visuals.lookAt(this.orientation.x, this.visuals.position.y, this.orientation.z);\r\n        this.visuals.rotateX(this.acceleration.z * 3);\r\n        this.visuals.rotateZ(-this.angularVelocity * 2.3);\r\n        this.visuals.position.setY(this.visuals.position.y + Math.cos(Math.abs(this.angularVelocity * 2.3)) / 2);\r\n    }\r\n    \r\n    jump() {\r\n        this.wantsToJump = true;\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/characters/Character.js?");

/***/ }),

/***/ "./src/js/characters/CharacterAI.js":
/*!******************************************!*\
  !*** ./src/js/characters/CharacterAI.js ***!
  \******************************************/
/*! exports provided: CharacterAI_Default, CharacterAI_FollowCharacter, CharacterAI_Random */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterAI_Default\", function() { return CharacterAI_Default; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterAI_FollowCharacter\", function() { return CharacterAI_FollowCharacter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterAI_Random\", function() { return CharacterAI_Random; });\n// import THREE from 'three';\r\n\r\nclass CharacterAI_Default {\r\n    constructor(character) {\r\n        this.character = character;\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.character.charState.update(timeStep);\r\n    }\r\n}\r\n\r\n\r\n\r\nclass CharacterAI_FollowCharacter {\r\n    constructor(character, targetCharacter, stopDistance = 2) {\r\n        this.character = character;\r\n        this.targetCharacter = targetCharacter;\r\n        this.stopDistance = stopDistance;\r\n    }\r\n\r\n    update(timeStep) {\r\n\r\n        let viewVector = new THREE.Vector3().subVectors(this.targetCharacter.position, this.character.position);\r\n        this.character.setViewVector(viewVector);\r\n\r\n        // Follow character\r\n        if (viewVector.length() > this.stopDistance) {\r\n            if (!this.character.controls.up.value) this.character.setControl('up', true);\r\n        }\r\n        //Stand still\r\n        else {\r\n            if (this.character.controls.up.value) this.character.setControl('up', false);\r\n\r\n            // Look at character\r\n            this.character.setOrientationTarget(viewVector);\r\n        }\r\n\r\n        this.character.charState.update(timeStep);\r\n    }\r\n}\r\n\r\n\r\n\r\nclass CharacterAI_Random {\r\n    constructor(character, randomFrequency = 100) {\r\n        this.character = character;\r\n        this.randomFrequency = randomFrequency;\r\n    }\r\n\r\n    update(timeStep) {\r\n    \r\n        let rndInt = Math.floor(Math.random() * this.randomFrequency);\r\n    \r\n        if(rndInt == 0) {\r\n            this.character.setViewVector(new THREE.Vector3(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5));\r\n            this.character.setOrientationTarget(this.character.viewVector);\r\n        }\r\n    \r\n        if(rndInt == 1) {\r\n            let rndBool = Math.random() > 0.5 ? true : false;\r\n            this.character.setControl('up', rndBool);\r\n            this.character.setControl('run',rndBool);\r\n        }\r\n    \r\n        this.character.charState.update(timeStep);\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/characters/CharacterAI.js?");

/***/ }),

/***/ "./src/js/characters/CharacterStates.js":
/*!**********************************************!*\
  !*** ./src/js/characters/CharacterStates.js ***!
  \**********************************************/
/*! exports provided: CharacterState_DefaultState, CharacterState_Idle, CharacterState_Walk, CharacterState_Sprint, CharacterState_StartWalkForward, CharacterState_EndWalk, CharacterState_JumpIdle, CharacterState_JumpRunning, CharacterState_Falling, CharacterState_DropIdle, CharacterState_DropRunning */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_DefaultState\", function() { return CharacterState_DefaultState; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_Idle\", function() { return CharacterState_Idle; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_Walk\", function() { return CharacterState_Walk; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_Sprint\", function() { return CharacterState_Sprint; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_StartWalkForward\", function() { return CharacterState_StartWalkForward; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_EndWalk\", function() { return CharacterState_EndWalk; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_JumpIdle\", function() { return CharacterState_JumpIdle; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_JumpRunning\", function() { return CharacterState_JumpRunning; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_Falling\", function() { return CharacterState_Falling; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_DropIdle\", function() { return CharacterState_DropIdle; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_DropRunning\", function() { return CharacterState_DropRunning; });\n//\r\n// Default state\r\n//\r\nclass CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n        this.character = character;\r\n\r\n        this.character.velocitySimulator.damping = this.character.defaultVelocitySimulatorDamping;\r\n        this.character.velocitySimulator.mass = this.character.defaultVelocitySimulatorMass;\r\n\r\n        this.character.rotationSimulator.damping = this.character.defaultRotationSimulatorDamping;\r\n        this.character.rotationSimulator.mass = this.character.defaultRotationSimulatorMass;\r\n    }\r\n\r\n    update(timeStep) {}\r\n\r\n    changeState() {}\r\n\r\n    noDirection() {\r\n        return !this.character.controls.up.value && !this.character.controls.down.value && !this.character.controls.left.value && !this.character.controls.right.value;\r\n    }\r\n\r\n    anyDirection() {\r\n        return this.character.controls.up.value || this.character.controls.down.value || this.character.controls.left.value || this.character.controls.right.value;\r\n    }\r\n\r\n    justPressed(control) {\r\n        return this.character.controls.lastControl == control && control.justPressed;\r\n    }\r\n\r\n    isPressed(control) {\r\n        return control.value;\r\n    }\r\n\r\n    justReleased(control) {\r\n        return this.character.controls.lastControl == control && control.justReleased;\r\n    }\r\n\r\n    fallInAir() {\r\n        if(!this.character.rayHasHit) this.character.setState(CharacterState_Falling);\r\n    }\r\n}\r\n\r\n//\r\n// Idle\r\n//\r\nclass CharacterState_Idle extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n\r\n        super(character);\r\n\r\n        this.character.velocitySimulator.damping = 0.6;\r\n        this.character.velocitySimulator.mass = 10;\r\n        \r\n        this.character.setAnimation('idle', 0.3);\r\n    }\r\n\r\n    update(timeStep) {\r\n    \r\n        this.character.setVelocityTarget(0);\r\n        this.character.update(timeStep);\r\n    \r\n        this.fallInAir();\r\n    }\r\n    changeState() {\r\n        if(this.justPressed(this.character.controls.jump)) {\r\n            this.character.setState(CharacterState_JumpIdle);\r\n        }\r\n    \r\n        if(this.anyDirection()) {\r\n            this.character.setState(CharacterState_StartWalkForward);\r\n        }\r\n    }\r\n}\r\n\r\n//\r\n// Walk\r\n//\r\nclass CharacterState_Walk extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n        super(character);\r\n\r\n        this.character.setAnimation('run', 0.1);\r\n    \r\n        if(this.noDirection()) {\r\n            this.character.setState(CharacterState_EndWalk);\r\n        }\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.character.setGlobalDirectionGoal();\r\n        this.character.setVelocityTarget(0.8);\r\n        this.character.update(timeStep);\r\n    \r\n        this.fallInAir();\r\n    \r\n        if(this.isPressed(this.character.controls.run)) {\r\n            this.character.setState(CharacterState_Sprint);\r\n        }\r\n    }\r\n    changeState() {\r\n        if(this.justPressed(this.character.controls.jump)) {\r\n            this.character.setState(CharacterState_JumpRunning);\r\n        }\r\n    \r\n        if(this.noDirection()) {\r\n            this.character.setState(CharacterState_Idle);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//\r\n// Sprint\r\n//\r\nclass CharacterState_Sprint extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n\r\n        super(character);\r\n\r\n        this.character.velocitySimulator.mass = 10;\r\n        this.character.rotationSimulator.damping = 0.8;\r\n        this.character.rotationSimulator.mass = 50;\r\n    \r\n        this.character.setAnimation('sprint', 0.3);\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.character.setGlobalDirectionGoal();\r\n        this.character.setVelocityTarget(1.4);\r\n        this.character.update(timeStep);\r\n    \r\n        this.fallInAir();\r\n    }\r\n\r\n    changeState() {\r\n        if(this.justReleased(this.character.controls.run)) {\r\n            this.character.setState(CharacterState_Walk);\r\n        }\r\n        if(this.justPressed(this.character.controls.jump)) {\r\n            this.character.setState(CharacterState_JumpRunning);\r\n        }\r\n        if(this.noDirection()) {\r\n            this.character.setState(CharacterState_EndWalk);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//\r\n// Start Walk Forward\r\n//\r\nclass CharacterState_StartWalkForward extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n\r\n        super(character);\r\n\r\n        this.character.velocitySimulator.mass = 30;\r\n    \r\n        let duration = character.setAnimation('start_forward', 0.1);\r\n        this.time = duration;\r\n        this.timer = 0;\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.timer += timeStep;\r\n        if(this.timer > this.time - timeStep) this.character.setState(CharacterState_Walk);\r\n    \r\n        this.character.setGlobalDirectionGoal();\r\n        this.character.setVelocityTarget(0.8);\r\n    \r\n        this.character.update(timeStep);\r\n    \r\n        this.fallInAir();\r\n    }\r\n\r\n    changeState() {\r\n        if(this.justPressed(this.character.controls.jump)) {\r\n            this.character.setState(CharacterState_JumpRunning);\r\n        }\r\n    \r\n        if(this.noDirection()) {\r\n            this.character.setState(CharacterState_Idle);\r\n        }\r\n    \r\n        if(this.justPressed(this.character.controls.run)) {\r\n            this.character.setState(CharacterState_Sprint);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//\r\n// End Walk\r\n//\r\nclass CharacterState_EndWalk extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n\r\n        super(character);\r\n\r\n        let duration = character.setAnimation('stop', 0.1);\r\n        this.time = duration;\r\n        this.timer = 0;\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.timer += timeStep;\r\n        if(this.timer > this.time - timeStep) {\r\n    \r\n            this.character.setState(CharacterState_Idle);\r\n        }\r\n        \r\n        this.character.setVelocityTarget(0);\r\n        this.character.update(timeStep);\r\n        this.fallInAir();\r\n    }\r\n\r\n    changeState() {\r\n        if(this.justPressed(this.character.controls.jump)) {\r\n            this.character.setState(CharacterState_JumpIdle);\r\n        }\r\n    \r\n        if(this.anyDirection()) {\r\n            if(this.isPressed(this.character.controls.run)) {\r\n                this.character.setState(CharacterState_Sprint);\r\n            }\r\n            else {\r\n                this.character.setState(CharacterState_StartWalkForward);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n//\r\n// Jump Idle\r\n//\r\nclass CharacterState_JumpIdle extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n\r\n        super(character);\r\n\r\n        this.character.velocitySimulator.mass = 100;\r\n    \r\n        this.animationLength = this.character.setAnimation('jump_idle', 0.1);\r\n        this.timer = 0;\r\n    \r\n        this.alreadyJumped = false;\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.character.setGlobalDirectionGoal();\r\n        // Move in air\r\n        if(this.timer > 0.3) {\r\n            this.character.setVelocityTarget(this.anyDirection() ? 0.8 : 0);\r\n        }\r\n        this.character.update(timeStep);\r\n\r\n        //Physically jump\r\n        this.timer += timeStep;\r\n        if(this.timer > 0.3 && !this.alreadyJumped) {\r\n            this.character.jump();\r\n            this.alreadyJumped = true;\r\n\r\n            this.character.rotationSimulator.damping = 0.3;\r\n        }\r\n\r\n        if(this.timer > 0.35 && this.character.rayHasHit) {\r\n            this.character.setState(CharacterState_DropIdle);\r\n        }\r\n\r\n        if(this.timer > this.animationLength - timeStep) {\r\n            this.character.setState(CharacterState_Falling);\r\n        }\r\n    }\r\n}\r\n\r\n//\r\n// Jump Running\r\n//\r\nclass CharacterState_JumpRunning extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n\r\n        super(character);\r\n\r\n        this.character.velocitySimulator.mass = 100;\r\n    \r\n        this.animationLength = this.character.setAnimation('jump_running', 0.1);\r\n        this.timer = 0;\r\n    \r\n        this.alreadyJumped = false;\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.character.setGlobalDirectionGoal();\r\n        // Move in air\r\n        if(this.timer > 0.2) {\r\n            this.character.setVelocityTarget(this.anyDirection() ? 0.8 : 0);\r\n        }\r\n        this.character.update(timeStep);\r\n    \r\n        //Physically jump\r\n        this.timer += timeStep;\r\n        if(this.timer > 0.2 && !this.alreadyJumped) {\r\n            this.character.jump();\r\n            this.alreadyJumped = true;\r\n    \r\n            this.character.rotationSimulator.damping = 0.3;\r\n        }\r\n    \r\n        if(this.timer > 0.3 && this.character.rayHasHit) {\r\n            this.character.setState(CharacterState_DropRunning);\r\n        }\r\n    \r\n        if(this.timer > this.animationLength - timeStep) {\r\n            this.character.setState(CharacterState_Falling);\r\n        }\r\n    }\r\n}\r\n\r\n//\r\n// Falling\r\n//\r\nclass CharacterState_Falling extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n        super(character);\r\n\r\n        this.character.velocitySimulator.mass = 100;\r\n        this.character.rotationSimulator.damping = 0.3;\r\n    \r\n        this.character.setAnimation('falling', 0.3);\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.character.setGlobalDirectionGoal();\r\n        this.character.setVelocityTarget(this.anyDirection() ? 0.8 : 0);\r\n        this.character.update(timeStep);\r\n    \r\n        if(this.character.rayHasHit) {\r\n            if(this.anyDirection()) {\r\n                this.character.setState(CharacterState_DropRunning);\r\n            }\r\n            else {\r\n                this.character.setState(CharacterState_DropIdle);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n//\r\n// Drop Idle\r\n//\r\nclass CharacterState_DropIdle extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n        super(character);\r\n\r\n        this.character.velocitySimulator.damping = 0.6;\r\n        this.character.velocitySimulator.mass = 15;\r\n\r\n        this.animationLength = this.character.setAnimation('drop_idle', 0.1);\r\n        this.timer = 0;\r\n        \r\n        if(this.anyDirection()) {\r\n            this.character.setState(CharacterState_StartWalkForward);\r\n        }\r\n    }\r\n\r\n    update(timeStep) {\r\n        this.character.setGlobalDirectionGoal();\r\n        this.character.setVelocityTarget(0);\r\n        this.character.update(timeStep);\r\n    \r\n        this.timer += timeStep;\r\n        if(this.timer > this.animationLength - timeStep) {\r\n            this.character.setState(CharacterState_Idle);\r\n        }\r\n    \r\n        this.fallInAir();\r\n    }\r\n\r\n    changeState() {\r\n        if(this.justPressed(this.character.controls.jump)) {\r\n            this.character.setState(CharacterState_JumpIdle);\r\n        }\r\n        if(this.anyDirection()) {\r\n            this.character.setState(CharacterState_StartWalkForward);\r\n        }\r\n    }\r\n}\r\n\r\n//\r\n// Drop Running\r\n//\r\nclass CharacterState_DropRunning extends CharacterState_DefaultState {\r\n\r\n    constructor(character) {\r\n        super(character);\r\n\r\n        this.animationLength = this.character.setAnimation('drop_running', 0.1);\r\n        this.timer = 0;\r\n    }\r\n    \r\n    update(timeStep) {\r\n        this.character.setGlobalDirectionGoal();\r\n        this.character.setVelocityTarget(0.8);\r\n        this.character.update(timeStep);\r\n    \r\n        this.timer += timeStep;\r\n        if(this.timer > this.animationLength - timeStep) {\r\n            this.character.setState(CharacterState_Walk);\r\n        }\r\n    \r\n        this.fallInAir();\r\n    }\r\n\r\n    changeState() {\r\n        if(this.noDirection(this.character.controls.jump)) {\r\n            this.character.setState(CharacterState_EndWalk);\r\n        }\r\n    \r\n        if(this.anyDirection() && this.justPressed(this.character.controls.run)) {\r\n            this.character.setState(CharacterState_Sprint);\r\n        }\r\n    \r\n        if(this.justPressed(this.character.controls.jump)) {\r\n            this.character.setState(CharacterState_JumpRunning);\r\n        }\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/characters/CharacterStates.js?");

/***/ }),

/***/ "./src/js/lib/shaders/CopyShader.js":
/*!******************************************!*\
  !*** ./src/js/lib/shaders/CopyShader.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author alteredq / http://alteredqualia.com/\n *\n * Full-screen textured quad shader\n */\n\nTHREE.CopyShader = {\n\n\tuniforms: {\n\n\t\t\"tDiffuse\": { value: null },\n\t\t\"opacity\":  { value: 1.0 }\n\n\t},\n\n\tvertexShader: [\n\n\t\t\"varying vec2 vUv;\",\n\n\t\t\"void main() {\",\n\n\t\t\t\"vUv = uv;\",\n\t\t\t\"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n\n\t\t\"}\"\n\n\t].join( \"\\n\" ),\n\n\tfragmentShader: [\n\n\t\t\"uniform float opacity;\",\n\n\t\t\"uniform sampler2D tDiffuse;\",\n\n\t\t\"varying vec2 vUv;\",\n\n\t\t\"void main() {\",\n\n\t\t\t\"vec4 texel = texture2D( tDiffuse, vUv );\",\n\t\t\t\"gl_FragColor = opacity * texel;\",\n\n\t\t\"}\"\n\n\t].join( \"\\n\" )\n\n};\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/shaders/CopyShader.js?");

/***/ }),

/***/ "./src/js/lib/shaders/EffectComposer.js":
/*!**********************************************!*\
  !*** ./src/js/lib/shaders/EffectComposer.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nTHREE.EffectComposer = function ( renderer, renderTarget ) {\n\n\tthis.renderer = renderer;\n\n\tif ( renderTarget === undefined ) {\n\n\t\tvar parameters = {\n\t\t\tminFilter: THREE.LinearFilter,\n\t\t\tmagFilter: THREE.LinearFilter,\n\t\t\tformat: THREE.RGBAFormat,\n\t\t\tstencilBuffer: false\n\t\t};\n\n\t\tvar size = renderer.getDrawingBufferSize();\n\t\trenderTarget = new THREE.WebGLRenderTarget( size.width, size.height, parameters );\n\t\trenderTarget.texture.name = 'EffectComposer.rt1';\n\n\t}\n\n\tthis.renderTarget1 = renderTarget;\n\tthis.renderTarget2 = renderTarget.clone();\n\tthis.renderTarget2.texture.name = 'EffectComposer.rt2';\n\n\tthis.writeBuffer = this.renderTarget1;\n\tthis.readBuffer = this.renderTarget2;\n\n\tthis.passes = [];\n\n\t// dependencies\n\n\tif ( THREE.CopyShader === undefined ) {\n\n\t\tconsole.error( 'THREE.EffectComposer relies on THREE.CopyShader' );\n\n\t}\n\n\tif ( THREE.ShaderPass === undefined ) {\n\n\t\tconsole.error( 'THREE.EffectComposer relies on THREE.ShaderPass' );\n\n\t}\n\n\tthis.copyPass = new THREE.ShaderPass( THREE.CopyShader );\n\n};\n\nObject.assign( THREE.EffectComposer.prototype, {\n\n\tswapBuffers: function () {\n\n\t\tvar tmp = this.readBuffer;\n\t\tthis.readBuffer = this.writeBuffer;\n\t\tthis.writeBuffer = tmp;\n\n\t},\n\n\taddPass: function ( pass ) {\n\n\t\tthis.passes.push( pass );\n\n\t\tvar size = this.renderer.getDrawingBufferSize();\n\t\tpass.setSize( size.width, size.height );\n\n\t},\n\n\tinsertPass: function ( pass, index ) {\n\n\t\tthis.passes.splice( index, 0, pass );\n\n\t},\n\n\trender: function ( delta ) {\n\n\t\tvar maskActive = false;\n\n\t\tvar pass, i, il = this.passes.length;\n\n\t\tfor ( i = 0; i < il; i ++ ) {\n\n\t\t\tpass = this.passes[ i ];\n\n\t\t\tif ( pass.enabled === false ) continue;\n\n\t\t\tpass.render( this.renderer, this.writeBuffer, this.readBuffer, delta, maskActive );\n\n\t\t\tif ( pass.needsSwap ) {\n\n\t\t\t\tif ( maskActive ) {\n\n\t\t\t\t\tvar context = this.renderer.context;\n\n\t\t\t\t\tcontext.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );\n\n\t\t\t\t\tthis.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, delta );\n\n\t\t\t\t\tcontext.stencilFunc( context.EQUAL, 1, 0xffffffff );\n\n\t\t\t\t}\n\n\t\t\t\tthis.swapBuffers();\n\n\t\t\t}\n\n\t\t\tif ( THREE.MaskPass !== undefined ) {\n\n\t\t\t\tif ( pass instanceof THREE.MaskPass ) {\n\n\t\t\t\t\tmaskActive = true;\n\n\t\t\t\t} else if ( pass instanceof THREE.ClearMaskPass ) {\n\n\t\t\t\t\tmaskActive = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\treset: function ( renderTarget ) {\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tvar size = this.renderer.getDrawingBufferSize();\n\n\t\t\trenderTarget = this.renderTarget1.clone();\n\t\t\trenderTarget.setSize( size.width, size.height );\n\n\t\t}\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t},\n\n\tsetSize: function ( width, height ) {\n\n\t\tthis.renderTarget1.setSize( width, height );\n\t\tthis.renderTarget2.setSize( width, height );\n\n\t\tfor ( var i = 0; i < this.passes.length; i ++ ) {\n\n\t\t\tthis.passes[ i ].setSize( width, height );\n\n\t\t}\n\n\t}\n\n} );\n\n\nTHREE.Pass = function () {\n\n\t// if set to true, the pass is processed by the composer\n\tthis.enabled = true;\n\n\t// if set to true, the pass indicates to swap read and write buffer after rendering\n\tthis.needsSwap = true;\n\n\t// if set to true, the pass clears its buffer before rendering\n\tthis.clear = false;\n\n\t// if set to true, the result of the pass is rendered to screen\n\tthis.renderToScreen = false;\n\n};\n\nObject.assign( THREE.Pass.prototype, {\n\n\tsetSize: function ( width, height ) {},\n\n\trender: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n} );\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/shaders/EffectComposer.js?");

/***/ }),

/***/ "./src/js/lib/shaders/FXAAShader.js":
/*!******************************************!*\
  !*** ./src/js/lib/shaders/FXAAShader.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author alteredq / http://alteredqualia.com/\n * @author davidedc / http://www.sketchpatch.net/\n *\n * NVIDIA FXAA by Timothy Lottes\n * http://timothylottes.blogspot.com/2011/06/fxaa3-source-released.html\n * - WebGL port by @supereggbert\n * http://www.glge.org/demos/fxaa/\n */\n\nTHREE.FXAAShader = {\n\n\tuniforms: {\n\n\t\t\"tDiffuse\":   { value: null },\n\t\t\"resolution\": { value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }\n\n\t},\n\n\tvertexShader: [\n\n\t\t\"varying vec2 vUv;\",\n\n\t\t\"void main() {\",\n\n\t\t\t\"vUv = uv;\",\n\t\t\t\"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n\n\t\t\"}\"\n\n\t].join( \"\\n\" ),\n\n\tfragmentShader: [\n        \"precision highp float;\",\n        \"\",\n        \"uniform sampler2D tDiffuse;\",\n        \"\",\n        \"uniform vec2 resolution;\",\n        \"\",\n        \"varying vec2 vUv;\",\n        \"\",\n        \"// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\",\n        \"\",\n        \"//----------------------------------------------------------------------------------\",\n        \"// File:        es3-kepler\\FXAA\\assets\\shaders/FXAA_DefaultES.frag\",\n        \"// SDK Version: v3.00\",\n        \"// Email:       gameworks@nvidia.com\",\n        \"// Site:        http://developer.nvidia.com/\",\n        \"//\",\n        \"// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\",\n        \"//\",\n        \"// Redistribution and use in source and binary forms, with or without\",\n        \"// modification, are permitted provided that the following conditions\",\n        \"// are met:\",\n        \"//  * Redistributions of source code must retain the above copyright\",\n        \"//    notice, this list of conditions and the following disclaimer.\",\n        \"//  * Redistributions in binary form must reproduce the above copyright\",\n        \"//    notice, this list of conditions and the following disclaimer in the\",\n        \"//    documentation and/or other materials provided with the distribution.\",\n        \"//  * Neither the name of NVIDIA CORPORATION nor the names of its\",\n        \"//    contributors may be used to endorse or promote products derived\",\n        \"//    from this software without specific prior written permission.\",\n        \"//\",\n        \"// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY\",\n        \"// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\",\n        \"// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\",\n        \"// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\",\n        \"// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\",\n        \"// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\",\n        \"// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\",\n        \"// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\",\n        \"// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\",\n        \"// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\",\n        \"// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\",\n        \"//\",\n        \"//----------------------------------------------------------------------------------\",\n        \"\",\n        \"#define FXAA_PC 1\",\n        \"#define FXAA_GLSL_100 1\",\n        \"#define FXAA_QUALITY_PRESET 12\",\n        \"\",\n        \"#define FXAA_GREEN_AS_LUMA 1\",\n        \"\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_PC_CONSOLE\",\n        \"    //\",\n        \"    // The console algorithm for PC is included\",\n        \"    // for developers targeting really low spec machines.\",\n        \"    // Likely better to just run FXAA_PC, and use a really low preset.\",\n        \"    //\",\n        \"    #define FXAA_PC_CONSOLE 0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_GLSL_120\",\n        \"    #define FXAA_GLSL_120 0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_GLSL_130\",\n        \"    #define FXAA_GLSL_130 0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_HLSL_3\",\n        \"    #define FXAA_HLSL_3 0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_HLSL_4\",\n        \"    #define FXAA_HLSL_4 0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_HLSL_5\",\n        \"    #define FXAA_HLSL_5 0\",\n        \"#endif\",\n        \"/*==========================================================================*/\",\n        \"#ifndef FXAA_GREEN_AS_LUMA\",\n        \"    //\",\n        \"    // For those using non-linear color,\",\n        \"    // and either not able to get luma in alpha, or not wanting to,\",\n        \"    // this enables FXAA to run using green as a proxy for luma.\",\n        \"    // So with this enabled, no need to pack luma in alpha.\",\n        \"    //\",\n        \"    // This will turn off AA on anything which lacks some amount of green.\",\n        \"    // Pure red and blue or combination of only R and B, will get no AA.\",\n        \"    //\",\n        \"    // Might want to lower the settings for both,\",\n        \"    //    fxaaConsoleEdgeThresholdMin\",\n        \"    //    fxaaQualityEdgeThresholdMin\",\n        \"    // In order to insure AA does not get turned off on colors\",\n        \"    // which contain a minor amount of green.\",\n        \"    //\",\n        \"    // 1 = On.\",\n        \"    // 0 = Off.\",\n        \"    //\",\n        \"    #define FXAA_GREEN_AS_LUMA 0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_EARLY_EXIT\",\n        \"    //\",\n        \"    // Controls algorithm's early exit path.\",\n        \"    // On PS3 turning this ON adds 2 cycles to the shader.\",\n        \"    // On 360 turning this OFF adds 10ths of a millisecond to the shader.\",\n        \"    // Turning this off on console will result in a more blurry image.\",\n        \"    // So this defaults to on.\",\n        \"    //\",\n        \"    // 1 = On.\",\n        \"    // 0 = Off.\",\n        \"    //\",\n        \"    #define FXAA_EARLY_EXIT 1\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_DISCARD\",\n        \"    //\",\n        \"    // Only valid for PC OpenGL currently.\",\n        \"    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\",\n        \"    //\",\n        \"    // 1 = Use discard on pixels which don't need AA.\",\n        \"    //     For APIs which enable concurrent TEX+ROP from same surface.\",\n        \"    // 0 = Return unchanged color on pixels which don't need AA.\",\n        \"    //\",\n        \"    #define FXAA_DISCARD 0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_FAST_PIXEL_OFFSET\",\n        \"    //\",\n        \"    // Used for GLSL 120 only.\",\n        \"    //\",\n        \"    // 1 = GL API supports fast pixel offsets\",\n        \"    // 0 = do not use fast pixel offsets\",\n        \"    //\",\n        \"    #ifdef GL_EXT_gpu_shader4\",\n        \"        #define FXAA_FAST_PIXEL_OFFSET 1\",\n        \"    #endif\",\n        \"    #ifdef GL_NV_gpu_shader5\",\n        \"        #define FXAA_FAST_PIXEL_OFFSET 1\",\n        \"    #endif\",\n        \"    #ifdef GL_ARB_gpu_shader5\",\n        \"        #define FXAA_FAST_PIXEL_OFFSET 1\",\n        \"    #endif\",\n        \"    #ifndef FXAA_FAST_PIXEL_OFFSET\",\n        \"        #define FXAA_FAST_PIXEL_OFFSET 0\",\n        \"    #endif\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#ifndef FXAA_GATHER4_ALPHA\",\n        \"    //\",\n        \"    // 1 = API supports gather4 on alpha channel.\",\n        \"    // 0 = API does not support gather4 on alpha channel.\",\n        \"    //\",\n        \"    #if (FXAA_HLSL_5 == 1)\",\n        \"        #define FXAA_GATHER4_ALPHA 1\",\n        \"    #endif\",\n        \"    #ifdef GL_ARB_gpu_shader5\",\n        \"        #define FXAA_GATHER4_ALPHA 1\",\n        \"    #endif\",\n        \"    #ifdef GL_NV_gpu_shader5\",\n        \"        #define FXAA_GATHER4_ALPHA 1\",\n        \"    #endif\",\n        \"    #ifndef FXAA_GATHER4_ALPHA\",\n        \"        #define FXAA_GATHER4_ALPHA 0\",\n        \"    #endif\",\n        \"#endif\",\n        \"\",\n        \"\",\n        \"/*============================================================================\",\n        \"                        FXAA QUALITY - TUNING KNOBS\",\n        \"------------------------------------------------------------------------------\",\n        \"NOTE the other tuning knobs are now in the shader function inputs!\",\n        \"============================================================================*/\",\n        \"#ifndef FXAA_QUALITY_PRESET\",\n        \"    //\",\n        \"    // Choose the quality preset.\",\n        \"    // This needs to be compiled into the shader as it effects code.\",\n        \"    // Best option to include multiple presets is to\",\n        \"    // in each shader define the preset, then include this file.\",\n        \"    //\",\n        \"    // OPTIONS\",\n        \"    // -----------------------------------------------------------------------\",\n        \"    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\",\n        \"    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\",\n        \"    // 39       - no dither, very expensive\",\n        \"    //\",\n        \"    // NOTES\",\n        \"    // -----------------------------------------------------------------------\",\n        \"    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\",\n        \"    // 13 = about same speed as FXAA 3.9 and better than 12\",\n        \"    // 23 = closest to FXAA 3.9 visually and performance wise\",\n        \"    //  _ = the lowest digit is directly related to performance\",\n        \"    // _  = the highest digit is directly related to style\",\n        \"    //\",\n        \"    #define FXAA_QUALITY_PRESET 12\",\n        \"#endif\",\n        \"\",\n        \"\",\n        \"/*============================================================================\",\n        \"\",\n        \"                           FXAA QUALITY - PRESETS\",\n        \"\",\n        \"============================================================================*/\",\n        \"\",\n        \"/*============================================================================\",\n        \"                     FXAA QUALITY - MEDIUM DITHER PRESETS\",\n        \"============================================================================*/\",\n        \"#if (FXAA_QUALITY_PRESET == 10)\",\n        \"    #define FXAA_QUALITY_PS 3\",\n        \"    #define FXAA_QUALITY_P0 1.5\",\n        \"    #define FXAA_QUALITY_P1 3.0\",\n        \"    #define FXAA_QUALITY_P2 12.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 11)\",\n        \"    #define FXAA_QUALITY_PS 4\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 3.0\",\n        \"    #define FXAA_QUALITY_P3 12.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 12)\",\n        \"    #define FXAA_QUALITY_PS 5\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 4.0\",\n        \"    #define FXAA_QUALITY_P4 12.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 13)\",\n        \"    #define FXAA_QUALITY_PS 6\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 4.0\",\n        \"    #define FXAA_QUALITY_P5 12.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 14)\",\n        \"    #define FXAA_QUALITY_PS 7\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 4.0\",\n        \"    #define FXAA_QUALITY_P6 12.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 15)\",\n        \"    #define FXAA_QUALITY_PS 8\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 2.0\",\n        \"    #define FXAA_QUALITY_P6 4.0\",\n        \"    #define FXAA_QUALITY_P7 12.0\",\n        \"#endif\",\n        \"\",\n        \"/*============================================================================\",\n        \"                     FXAA QUALITY - LOW DITHER PRESETS\",\n        \"============================================================================*/\",\n        \"#if (FXAA_QUALITY_PRESET == 20)\",\n        \"    #define FXAA_QUALITY_PS 3\",\n        \"    #define FXAA_QUALITY_P0 1.5\",\n        \"    #define FXAA_QUALITY_P1 2.0\",\n        \"    #define FXAA_QUALITY_P2 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 21)\",\n        \"    #define FXAA_QUALITY_PS 4\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 22)\",\n        \"    #define FXAA_QUALITY_PS 5\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 23)\",\n        \"    #define FXAA_QUALITY_PS 6\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 24)\",\n        \"    #define FXAA_QUALITY_PS 7\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 3.0\",\n        \"    #define FXAA_QUALITY_P6 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 25)\",\n        \"    #define FXAA_QUALITY_PS 8\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 2.0\",\n        \"    #define FXAA_QUALITY_P6 4.0\",\n        \"    #define FXAA_QUALITY_P7 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 26)\",\n        \"    #define FXAA_QUALITY_PS 9\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 2.0\",\n        \"    #define FXAA_QUALITY_P6 2.0\",\n        \"    #define FXAA_QUALITY_P7 4.0\",\n        \"    #define FXAA_QUALITY_P8 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 27)\",\n        \"    #define FXAA_QUALITY_PS 10\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 2.0\",\n        \"    #define FXAA_QUALITY_P6 2.0\",\n        \"    #define FXAA_QUALITY_P7 2.0\",\n        \"    #define FXAA_QUALITY_P8 4.0\",\n        \"    #define FXAA_QUALITY_P9 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 28)\",\n        \"    #define FXAA_QUALITY_PS 11\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 2.0\",\n        \"    #define FXAA_QUALITY_P6 2.0\",\n        \"    #define FXAA_QUALITY_P7 2.0\",\n        \"    #define FXAA_QUALITY_P8 2.0\",\n        \"    #define FXAA_QUALITY_P9 4.0\",\n        \"    #define FXAA_QUALITY_P10 8.0\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_QUALITY_PRESET == 29)\",\n        \"    #define FXAA_QUALITY_PS 12\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.5\",\n        \"    #define FXAA_QUALITY_P2 2.0\",\n        \"    #define FXAA_QUALITY_P3 2.0\",\n        \"    #define FXAA_QUALITY_P4 2.0\",\n        \"    #define FXAA_QUALITY_P5 2.0\",\n        \"    #define FXAA_QUALITY_P6 2.0\",\n        \"    #define FXAA_QUALITY_P7 2.0\",\n        \"    #define FXAA_QUALITY_P8 2.0\",\n        \"    #define FXAA_QUALITY_P9 2.0\",\n        \"    #define FXAA_QUALITY_P10 4.0\",\n        \"    #define FXAA_QUALITY_P11 8.0\",\n        \"#endif\",\n        \"\",\n        \"/*============================================================================\",\n        \"                     FXAA QUALITY - EXTREME QUALITY\",\n        \"============================================================================*/\",\n        \"#if (FXAA_QUALITY_PRESET == 39)\",\n        \"    #define FXAA_QUALITY_PS 12\",\n        \"    #define FXAA_QUALITY_P0 1.0\",\n        \"    #define FXAA_QUALITY_P1 1.0\",\n        \"    #define FXAA_QUALITY_P2 1.0\",\n        \"    #define FXAA_QUALITY_P3 1.0\",\n        \"    #define FXAA_QUALITY_P4 1.0\",\n        \"    #define FXAA_QUALITY_P5 1.5\",\n        \"    #define FXAA_QUALITY_P6 2.0\",\n        \"    #define FXAA_QUALITY_P7 2.0\",\n        \"    #define FXAA_QUALITY_P8 2.0\",\n        \"    #define FXAA_QUALITY_P9 2.0\",\n        \"    #define FXAA_QUALITY_P10 4.0\",\n        \"    #define FXAA_QUALITY_P11 8.0\",\n        \"#endif\",\n        \"\",\n        \"\",\n        \"\",\n        \"/*============================================================================\",\n        \"\",\n        \"                                API PORTING\",\n        \"\",\n        \"============================================================================*/\",\n        \"#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\",\n        \"    #define FxaaBool bool\",\n        \"    #define FxaaDiscard discard\",\n        \"    #define FxaaFloat float\",\n        \"    #define FxaaFloat2 vec2\",\n        \"    #define FxaaFloat3 vec3\",\n        \"    #define FxaaFloat4 vec4\",\n        \"    #define FxaaHalf float\",\n        \"    #define FxaaHalf2 vec2\",\n        \"    #define FxaaHalf3 vec3\",\n        \"    #define FxaaHalf4 vec4\",\n        \"    #define FxaaInt2 ivec2\",\n        \"    #define FxaaSat(x) clamp(x, 0.0, 1.0)\",\n        \"    #define FxaaTex sampler2D\",\n        \"#else\",\n        \"    #define FxaaBool bool\",\n        \"    #define FxaaDiscard clip(-1)\",\n        \"    #define FxaaFloat float\",\n        \"    #define FxaaFloat2 float2\",\n        \"    #define FxaaFloat3 float3\",\n        \"    #define FxaaFloat4 float4\",\n        \"    #define FxaaHalf half\",\n        \"    #define FxaaHalf2 half2\",\n        \"    #define FxaaHalf3 half3\",\n        \"    #define FxaaHalf4 half4\",\n        \"    #define FxaaSat(x) saturate(x)\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_GLSL_100 == 1)\",\n        \"  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)\",\n        \"  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_GLSL_120 == 1)\",\n        \"    // Requires,\",\n        \"    //  #version 120\",\n        \"    // And at least,\",\n        \"    //  #extension GL_EXT_gpu_shader4 : enable\",\n        \"    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\",\n        \"    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\",\n        \"    #if (FXAA_FAST_PIXEL_OFFSET == 1)\",\n        \"        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\",\n        \"    #else\",\n        \"        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\",\n        \"    #endif\",\n        \"    #if (FXAA_GATHER4_ALPHA == 1)\",\n        \"        // use #extension GL_ARB_gpu_shader5 : enable\",\n        \"        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\",\n        \"        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\",\n        \"        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\",\n        \"        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\",\n        \"    #endif\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_GLSL_130 == 1)\",\n        \"    // Requires \\\"#version 130\\\" or better\",\n        \"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)\",\n        \"    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\",\n        \"    #if (FXAA_GATHER4_ALPHA == 1)\",\n        \"        // use #extension GL_ARB_gpu_shader5 : enable\",\n        \"        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\",\n        \"        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\",\n        \"        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\",\n        \"        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\",\n        \"    #endif\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_HLSL_3 == 1)\",\n        \"    #define FxaaInt2 float2\",\n        \"    #define FxaaTex sampler2D\",\n        \"    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\",\n        \"    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_HLSL_4 == 1)\",\n        \"    #define FxaaInt2 int2\",\n        \"    struct FxaaTex { SamplerState smpl; Texture2D tex; };\",\n        \"    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\",\n        \"    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\",\n        \"#endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"#if (FXAA_HLSL_5 == 1)\",\n        \"    #define FxaaInt2 int2\",\n        \"    struct FxaaTex { SamplerState smpl; Texture2D tex; };\",\n        \"    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\",\n        \"    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\",\n        \"    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\",\n        \"    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\",\n        \"    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\",\n        \"    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\",\n        \"#endif\",\n        \"\",\n        \"\",\n        \"/*============================================================================\",\n        \"                   GREEN AS LUMA OPTION SUPPORT FUNCTION\",\n        \"============================================================================*/\",\n        \"#if (FXAA_GREEN_AS_LUMA == 0)\",\n        \"    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\",\n        \"#else\",\n        \"    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\",\n        \"#endif\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"/*============================================================================\",\n        \"\",\n        \"                             FXAA3 QUALITY - PC\",\n        \"\",\n        \"============================================================================*/\",\n        \"#if (FXAA_PC == 1)\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"FxaaFloat4 FxaaPixelShader(\",\n        \"    //\",\n        \"    // Use noperspective interpolation here (turn off perspective interpolation).\",\n        \"    // {xy} = center of pixel\",\n        \"    FxaaFloat2 pos,\",\n        \"    //\",\n        \"    // Used only for FXAA Console, and not used on the 360 version.\",\n        \"    // Use noperspective interpolation here (turn off perspective interpolation).\",\n        \"    // {xy_} = upper left of pixel\",\n        \"    // {_zw} = lower right of pixel\",\n        \"    FxaaFloat4 fxaaConsolePosPos,\",\n        \"    //\",\n        \"    // Input color texture.\",\n        \"    // {rgb_} = color in linear or perceptual color space\",\n        \"    // if (FXAA_GREEN_AS_LUMA == 0)\",\n        \"    //     {__a} = luma in perceptual color space (not linear)\",\n        \"    FxaaTex tex,\",\n        \"    //\",\n        \"    // Only used on the optimized 360 version of FXAA Console.\",\n        \"    // For everything but 360, just use the same input here as for \\\"tex\\\".\",\n        \"    // For 360, same texture, just alias with a 2nd sampler.\",\n        \"    // This sampler needs to have an exponent bias of -1.\",\n        \"    FxaaTex fxaaConsole360TexExpBiasNegOne,\",\n        \"    //\",\n        \"    // Only used on the optimized 360 version of FXAA Console.\",\n        \"    // For everything but 360, just use the same input here as for \\\"tex\\\".\",\n        \"    // For 360, same texture, just alias with a 3nd sampler.\",\n        \"    // This sampler needs to have an exponent bias of -2.\",\n        \"    FxaaTex fxaaConsole360TexExpBiasNegTwo,\",\n        \"    //\",\n        \"    // Only used on FXAA Quality.\",\n        \"    // This must be from a constant/uniform.\",\n        \"    // {x_} = 1.0/screenWidthInPixels\",\n        \"    // {_y} = 1.0/screenHeightInPixels\",\n        \"    FxaaFloat2 fxaaQualityRcpFrame,\",\n        \"    //\",\n        \"    // Only used on FXAA Console.\",\n        \"    // This must be from a constant/uniform.\",\n        \"    // This effects sub-pixel AA quality and inversely sharpness.\",\n        \"    //   Where N ranges between,\",\n        \"    //     N = 0.50 (default)\",\n        \"    //     N = 0.33 (sharper)\",\n        \"    // {x__} = -N/screenWidthInPixels\",\n        \"    // {_y_} = -N/screenHeightInPixels\",\n        \"    // {_z_} =  N/screenWidthInPixels\",\n        \"    // {__w} =  N/screenHeightInPixels\",\n        \"    FxaaFloat4 fxaaConsoleRcpFrameOpt,\",\n        \"    //\",\n        \"    // Only used on FXAA Console.\",\n        \"    // Not used on 360, but used on PS3 and PC.\",\n        \"    // This must be from a constant/uniform.\",\n        \"    // {x__} = -2.0/screenWidthInPixels\",\n        \"    // {_y_} = -2.0/screenHeightInPixels\",\n        \"    // {_z_} =  2.0/screenWidthInPixels\",\n        \"    // {__w} =  2.0/screenHeightInPixels\",\n        \"    FxaaFloat4 fxaaConsoleRcpFrameOpt2,\",\n        \"    //\",\n        \"    // Only used on FXAA Console.\",\n        \"    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\",\n        \"    // This must be from a constant/uniform.\",\n        \"    // {x__} =  8.0/screenWidthInPixels\",\n        \"    // {_y_} =  8.0/screenHeightInPixels\",\n        \"    // {_z_} = -4.0/screenWidthInPixels\",\n        \"    // {__w} = -4.0/screenHeightInPixels\",\n        \"    FxaaFloat4 fxaaConsole360RcpFrameOpt2,\",\n        \"    //\",\n        \"    // Only used on FXAA Quality.\",\n        \"    // This used to be the FXAA_QUALITY_SUBPIX define.\",\n        \"    // It is here now to allow easier tuning.\",\n        \"    // Choose the amount of sub-pixel aliasing removal.\",\n        \"    // This can effect sharpness.\",\n        \"    //   1.00 - upper limit (softer)\",\n        \"    //   0.75 - default amount of filtering\",\n        \"    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\",\n        \"    //   0.25 - almost off\",\n        \"    //   0.00 - completely off\",\n        \"    FxaaFloat fxaaQualitySubpix,\",\n        \"    //\",\n        \"    // Only used on FXAA Quality.\",\n        \"    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\",\n        \"    // It is here now to allow easier tuning.\",\n        \"    // The minimum amount of local contrast required to apply algorithm.\",\n        \"    //   0.333 - too little (faster)\",\n        \"    //   0.250 - low quality\",\n        \"    //   0.166 - default\",\n        \"    //   0.125 - high quality\",\n        \"    //   0.063 - overkill (slower)\",\n        \"    FxaaFloat fxaaQualityEdgeThreshold,\",\n        \"    //\",\n        \"    // Only used on FXAA Quality.\",\n        \"    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\",\n        \"    // It is here now to allow easier tuning.\",\n        \"    // Trims the algorithm from processing darks.\",\n        \"    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\",\n        \"    //   0.0625 - high quality (faster)\",\n        \"    //   0.0312 - visible limit (slower)\",\n        \"    // Special notes when using FXAA_GREEN_AS_LUMA,\",\n        \"    //   Likely want to set this to zero.\",\n        \"    //   As colors that are mostly not-green\",\n        \"    //   will appear very dark in the green channel!\",\n        \"    //   Tune by looking at mostly non-green content,\",\n        \"    //   then start at zero and increase until aliasing is a problem.\",\n        \"    FxaaFloat fxaaQualityEdgeThresholdMin,\",\n        \"    //\",\n        \"    // Only used on FXAA Console.\",\n        \"    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\",\n        \"    // It is here now to allow easier tuning.\",\n        \"    // This does not effect PS3, as this needs to be compiled in.\",\n        \"    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\",\n        \"    //   Due to the PS3 being ALU bound,\",\n        \"    //   there are only three safe values here: 2 and 4 and 8.\",\n        \"    //   These options use the shaders ability to a free *|/ by 2|4|8.\",\n        \"    // For all other platforms can be a non-power of two.\",\n        \"    //   8.0 is sharper (default!!!)\",\n        \"    //   4.0 is softer\",\n        \"    //   2.0 is really soft (good only for vector graphics inputs)\",\n        \"    FxaaFloat fxaaConsoleEdgeSharpness,\",\n        \"    //\",\n        \"    // Only used on FXAA Console.\",\n        \"    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\",\n        \"    // It is here now to allow easier tuning.\",\n        \"    // This does not effect PS3, as this needs to be compiled in.\",\n        \"    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\",\n        \"    //   Due to the PS3 being ALU bound,\",\n        \"    //   there are only two safe values here: 1/4 and 1/8.\",\n        \"    //   These options use the shaders ability to a free *|/ by 2|4|8.\",\n        \"    // The console setting has a different mapping than the quality setting.\",\n        \"    // Other platforms can use other values.\",\n        \"    //   0.125 leaves less aliasing, but is softer (default!!!)\",\n        \"    //   0.25 leaves more aliasing, and is sharper\",\n        \"    FxaaFloat fxaaConsoleEdgeThreshold,\",\n        \"    //\",\n        \"    // Only used on FXAA Console.\",\n        \"    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\",\n        \"    // It is here now to allow easier tuning.\",\n        \"    // Trims the algorithm from processing darks.\",\n        \"    // The console setting has a different mapping than the quality setting.\",\n        \"    // This only applies when FXAA_EARLY_EXIT is 1.\",\n        \"    // This does not apply to PS3,\",\n        \"    // PS3 was simplified to avoid more shader instructions.\",\n        \"    //   0.06 - faster but more aliasing in darks\",\n        \"    //   0.05 - default\",\n        \"    //   0.04 - slower and less aliasing in darks\",\n        \"    // Special notes when using FXAA_GREEN_AS_LUMA,\",\n        \"    //   Likely want to set this to zero.\",\n        \"    //   As colors that are mostly not-green\",\n        \"    //   will appear very dark in the green channel!\",\n        \"    //   Tune by looking at mostly non-green content,\",\n        \"    //   then start at zero and increase until aliasing is a problem.\",\n        \"    FxaaFloat fxaaConsoleEdgeThresholdMin,\",\n        \"    //\",\n        \"    // Extra constants for 360 FXAA Console only.\",\n        \"    // Use zeros or anything else for other platforms.\",\n        \"    // These must be in physical constant registers and NOT immedates.\",\n        \"    // Immedates will result in compiler un-optimizing.\",\n        \"    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\",\n        \"    FxaaFloat4 fxaaConsole360ConstDir\",\n        \") {\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat2 posM;\",\n        \"    posM.x = pos.x;\",\n        \"    posM.y = pos.y;\",\n        \"    #if (FXAA_GATHER4_ALPHA == 1)\",\n        \"        #if (FXAA_DISCARD == 0)\",\n        \"            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\",\n        \"            #if (FXAA_GREEN_AS_LUMA == 0)\",\n        \"                #define lumaM rgbyM.w\",\n        \"            #else\",\n        \"                #define lumaM rgbyM.y\",\n        \"            #endif\",\n        \"        #endif\",\n        \"        #if (FXAA_GREEN_AS_LUMA == 0)\",\n        \"            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\",\n        \"            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\",\n        \"        #else\",\n        \"            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\",\n        \"            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\",\n        \"        #endif\",\n        \"        #if (FXAA_DISCARD == 1)\",\n        \"            #define lumaM luma4A.w\",\n        \"        #endif\",\n        \"        #define lumaE luma4A.z\",\n        \"        #define lumaS luma4A.x\",\n        \"        #define lumaSE luma4A.y\",\n        \"        #define lumaNW luma4B.w\",\n        \"        #define lumaN luma4B.z\",\n        \"        #define lumaW luma4B.x\",\n        \"    #else\",\n        \"        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\",\n        \"        #if (FXAA_GREEN_AS_LUMA == 0)\",\n        \"            #define lumaM rgbyM.w\",\n        \"        #else\",\n        \"            #define lumaM rgbyM.y\",\n        \"        #endif\",\n        \"        #if (FXAA_GLSL_100 == 1)\",\n        \"          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\",\n        \"        #else\",\n        \"          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\",\n        \"        #endif\",\n        \"    #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat maxSM = max(lumaS, lumaM);\",\n        \"    FxaaFloat minSM = min(lumaS, lumaM);\",\n        \"    FxaaFloat maxESM = max(lumaE, maxSM);\",\n        \"    FxaaFloat minESM = min(lumaE, minSM);\",\n        \"    FxaaFloat maxWN = max(lumaN, lumaW);\",\n        \"    FxaaFloat minWN = min(lumaN, lumaW);\",\n        \"    FxaaFloat rangeMax = max(maxWN, maxESM);\",\n        \"    FxaaFloat rangeMin = min(minWN, minESM);\",\n        \"    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\",\n        \"    FxaaFloat range = rangeMax - rangeMin;\",\n        \"    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\",\n        \"    FxaaBool earlyExit = range < rangeMaxClamped;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    if(earlyExit)\",\n        \"        #if (FXAA_DISCARD == 1)\",\n        \"            FxaaDiscard;\",\n        \"        #else\",\n        \"            return rgbyM;\",\n        \"        #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    #if (FXAA_GATHER4_ALPHA == 0)\",\n        \"        #if (FXAA_GLSL_100 == 1)\",\n        \"          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\",\n        \"        #else\",\n        \"          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\",\n        \"          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\",\n        \"        #endif\",\n        \"    #else\",\n        \"        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\",\n        \"        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\",\n        \"    #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat lumaNS = lumaN + lumaS;\",\n        \"    FxaaFloat lumaWE = lumaW + lumaE;\",\n        \"    FxaaFloat subpixRcpRange = 1.0/range;\",\n        \"    FxaaFloat subpixNSWE = lumaNS + lumaWE;\",\n        \"    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\",\n        \"    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat lumaNESE = lumaNE + lumaSE;\",\n        \"    FxaaFloat lumaNWNE = lumaNW + lumaNE;\",\n        \"    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\",\n        \"    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat lumaNWSW = lumaNW + lumaSW;\",\n        \"    FxaaFloat lumaSWSE = lumaSW + lumaSE;\",\n        \"    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\",\n        \"    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\",\n        \"    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\",\n        \"    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\",\n        \"    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\",\n        \"    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\",\n        \"    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\",\n        \"    FxaaBool horzSpan = edgeHorz >= edgeVert;\",\n        \"    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    if(!horzSpan) lumaN = lumaW;\",\n        \"    if(!horzSpan) lumaS = lumaE;\",\n        \"    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\",\n        \"    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat gradientN = lumaN - lumaM;\",\n        \"    FxaaFloat gradientS = lumaS - lumaM;\",\n        \"    FxaaFloat lumaNN = lumaN + lumaM;\",\n        \"    FxaaFloat lumaSS = lumaS + lumaM;\",\n        \"    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\",\n        \"    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\",\n        \"    if(pairN) lengthSign = -lengthSign;\",\n        \"    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat2 posB;\",\n        \"    posB.x = posM.x;\",\n        \"    posB.y = posM.y;\",\n        \"    FxaaFloat2 offNP;\",\n        \"    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\",\n        \"    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\",\n        \"    if(!horzSpan) posB.x += lengthSign * 0.5;\",\n        \"    if( horzSpan) posB.y += lengthSign * 0.5;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat2 posN;\",\n        \"    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\",\n        \"    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\",\n        \"    FxaaFloat2 posP;\",\n        \"    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\",\n        \"    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\",\n        \"    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\",\n        \"    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\",\n        \"    FxaaFloat subpixE = subpixC * subpixC;\",\n        \"    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    if(!pairN) lumaNN = lumaSS;\",\n        \"    FxaaFloat gradientScaled = gradient * 1.0/4.0;\",\n        \"    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\",\n        \"    FxaaFloat subpixF = subpixD * subpixE;\",\n        \"    FxaaBool lumaMLTZero = lumaMM < 0.0;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    lumaEndN -= lumaNN * 0.5;\",\n        \"    lumaEndP -= lumaNN * 0.5;\",\n        \"    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\",\n        \"    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\",\n        \"    FxaaBool doneNP = (!doneN) || (!doneP);\",\n        \"    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\",\n        \"    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    if(doneNP) {\",\n        \"        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"        doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"        doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\",\n        \"        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\",\n        \"        doneNP = (!doneN) || (!doneP);\",\n        \"        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\",\n        \"        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"        #if (FXAA_QUALITY_PS > 3)\",\n        \"        if(doneNP) {\",\n        \"            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"            doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"            doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\",\n        \"            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\",\n        \"            doneNP = (!doneN) || (!doneP);\",\n        \"            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\",\n        \"            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"            #if (FXAA_QUALITY_PS > 4)\",\n        \"            if(doneNP) {\",\n        \"                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"                doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"                doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\",\n        \"                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\",\n        \"                doneNP = (!doneN) || (!doneP);\",\n        \"                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\",\n        \"                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                #if (FXAA_QUALITY_PS > 5)\",\n        \"                if(doneNP) {\",\n        \"                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"                    doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"                    doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\",\n        \"                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\",\n        \"                    doneNP = (!doneN) || (!doneP);\",\n        \"                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\",\n        \"                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                    #if (FXAA_QUALITY_PS > 6)\",\n        \"                    if(doneNP) {\",\n        \"                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"                        doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"                        doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\",\n        \"                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\",\n        \"                        doneNP = (!doneN) || (!doneP);\",\n        \"                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\",\n        \"                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                        #if (FXAA_QUALITY_PS > 7)\",\n        \"                        if(doneNP) {\",\n        \"                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"                            doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"                            doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\",\n        \"                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\",\n        \"                            doneNP = (!doneN) || (!doneP);\",\n        \"                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\",\n        \"                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    #if (FXAA_QUALITY_PS > 8)\",\n        \"    if(doneNP) {\",\n        \"        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"        doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"        doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\",\n        \"        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\",\n        \"        doneNP = (!doneN) || (!doneP);\",\n        \"        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\",\n        \"        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"        #if (FXAA_QUALITY_PS > 9)\",\n        \"        if(doneNP) {\",\n        \"            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"            doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"            doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\",\n        \"            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\",\n        \"            doneNP = (!doneN) || (!doneP);\",\n        \"            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\",\n        \"            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"            #if (FXAA_QUALITY_PS > 10)\",\n        \"            if(doneNP) {\",\n        \"                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"                doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"                doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\",\n        \"                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\",\n        \"                doneNP = (!doneN) || (!doneP);\",\n        \"                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\",\n        \"                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                #if (FXAA_QUALITY_PS > 11)\",\n        \"                if(doneNP) {\",\n        \"                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"                    doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"                    doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\",\n        \"                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\",\n        \"                    doneNP = (!doneN) || (!doneP);\",\n        \"                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\",\n        \"                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                    #if (FXAA_QUALITY_PS > 12)\",\n        \"                    if(doneNP) {\",\n        \"                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\",\n        \"                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\",\n        \"                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\",\n        \"                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\",\n        \"                        doneN = abs(lumaEndN) >= gradientScaled;\",\n        \"                        doneP = abs(lumaEndP) >= gradientScaled;\",\n        \"                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\",\n        \"                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\",\n        \"                        doneNP = (!doneN) || (!doneP);\",\n        \"                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\",\n        \"                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                    }\",\n        \"                    #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                }\",\n        \"                #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"            }\",\n        \"            #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"        }\",\n        \"        #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    }\",\n        \"    #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                        }\",\n        \"                        #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                    }\",\n        \"                    #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"                }\",\n        \"                #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"            }\",\n        \"            #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"        }\",\n        \"        #endif\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    }\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat dstN = posM.x - posN.x;\",\n        \"    FxaaFloat dstP = posP.x - posM.x;\",\n        \"    if(!horzSpan) dstN = posM.y - posN.y;\",\n        \"    if(!horzSpan) dstP = posP.y - posM.y;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\",\n        \"    FxaaFloat spanLength = (dstP + dstN);\",\n        \"    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\",\n        \"    FxaaFloat spanLengthRcp = 1.0/spanLength;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaBool directionN = dstN < dstP;\",\n        \"    FxaaFloat dst = min(dstN, dstP);\",\n        \"    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\",\n        \"    FxaaFloat subpixG = subpixF * subpixF;\",\n        \"    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\",\n        \"    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\",\n        \"/*--------------------------------------------------------------------------*/\",\n        \"    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\",\n        \"    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\",\n        \"    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\",\n        \"    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\",\n        \"    #if (FXAA_DISCARD == 1)\",\n        \"        return FxaaTexTop(tex, posM);\",\n        \"    #else\",\n        \"        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\",\n        \"    #endif\",\n        \"}\",\n        \"/*==========================================================================*/\",\n        \"#endif\",\n        \"\",\n        \"void main() {\",\n        \"  gl_FragColor = FxaaPixelShader(\",\n        \"    vUv,\",\n        \"    vec4(0.0),\",\n        \"    tDiffuse,\",\n        \"    tDiffuse,\",\n        \"    tDiffuse,\",\n        \"    resolution,\",\n        \"    vec4(0.0),\",\n        \"    vec4(0.0),\",\n        \"    vec4(0.0),\",\n        \"    0.75,\",\n        \"    0.166,\",\n        \"    0.0833,\",\n        \"    0.0,\",\n        \"    0.0,\",\n        \"    0.0,\",\n        \"    vec4(0.0)\",\n        \"  );\",\n        \"\",\n        \"  // TODO avoid querying texture twice for same texel\",\n        \"  gl_FragColor.a = texture2D(tDiffuse, vUv).a;\",\n        \"}\"\n\t].join(\"\\n\")\n\n};\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/shaders/FXAAShader.js?");

/***/ }),

/***/ "./src/js/lib/shaders/MaskPass.js":
/*!****************************************!*\
  !*** ./src/js/lib/shaders/MaskPass.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nTHREE.MaskPass = function ( scene, camera ) {\n\n\tTHREE.Pass.call( this );\n\n\tthis.scene = scene;\n\tthis.camera = camera;\n\n\tthis.clear = true;\n\tthis.needsSwap = false;\n\n\tthis.inverse = false;\n\n};\n\nTHREE.MaskPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {\n\n\tconstructor: THREE.MaskPass,\n\n\trender: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {\n\n\t\tvar context = renderer.context;\n\t\tvar state = renderer.state;\n\n\t\t// don't update color or depth\n\n\t\tstate.buffers.color.setMask( false );\n\t\tstate.buffers.depth.setMask( false );\n\n\t\t// lock buffers\n\n\t\tstate.buffers.color.setLocked( true );\n\t\tstate.buffers.depth.setLocked( true );\n\n\t\t// set up stencil\n\n\t\tvar writeValue, clearValue;\n\n\t\tif ( this.inverse ) {\n\n\t\t\twriteValue = 0;\n\t\t\tclearValue = 1;\n\n\t\t} else {\n\n\t\t\twriteValue = 1;\n\t\t\tclearValue = 0;\n\n\t\t}\n\n\t\tstate.buffers.stencil.setTest( true );\n\t\tstate.buffers.stencil.setOp( context.REPLACE, context.REPLACE, context.REPLACE );\n\t\tstate.buffers.stencil.setFunc( context.ALWAYS, writeValue, 0xffffffff );\n\t\tstate.buffers.stencil.setClear( clearValue );\n\n\t\t// draw into the stencil buffer\n\n\t\trenderer.render( this.scene, this.camera, readBuffer, this.clear );\n\t\trenderer.render( this.scene, this.camera, writeBuffer, this.clear );\n\n\t\t// unlock color and depth buffer for subsequent rendering\n\n\t\tstate.buffers.color.setLocked( false );\n\t\tstate.buffers.depth.setLocked( false );\n\n\t\t// only render where stencil is set to 1\n\n\t\tstate.buffers.stencil.setFunc( context.EQUAL, 1, 0xffffffff );  // draw if == 1\n\t\tstate.buffers.stencil.setOp( context.KEEP, context.KEEP, context.KEEP );\n\n\t}\n\n} );\n\n\nTHREE.ClearMaskPass = function () {\n\n\tTHREE.Pass.call( this );\n\n\tthis.needsSwap = false;\n\n};\n\nTHREE.ClearMaskPass.prototype = Object.create( THREE.Pass.prototype );\n\nObject.assign( THREE.ClearMaskPass.prototype, {\n\n\trender: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {\n\n\t\trenderer.state.buffers.stencil.setTest( false );\n\n\t}\n\n} );\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/shaders/MaskPass.js?");

/***/ }),

/***/ "./src/js/lib/shaders/RenderPass.js":
/*!******************************************!*\
  !*** ./src/js/lib/shaders/RenderPass.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nTHREE.RenderPass = function ( scene, camera, overrideMaterial, clearColor, clearAlpha ) {\n\n\tTHREE.Pass.call( this );\n\n\tthis.scene = scene;\n\tthis.camera = camera;\n\n\tthis.overrideMaterial = overrideMaterial;\n\n\tthis.clearColor = clearColor;\n\tthis.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;\n\n\tthis.clear = true;\n\tthis.clearDepth = false;\n\tthis.needsSwap = false;\n\n};\n\nTHREE.RenderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {\n\n\tconstructor: THREE.RenderPass,\n\n\trender: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {\n\n\t\tvar oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\tthis.scene.overrideMaterial = this.overrideMaterial;\n\n\t\tvar oldClearColor, oldClearAlpha;\n\n\t\tif ( this.clearColor ) {\n\n\t\t\toldClearColor = renderer.getClearColor().getHex();\n\t\t\toldClearAlpha = renderer.getClearAlpha();\n\n\t\t\trenderer.setClearColor( this.clearColor, this.clearAlpha );\n\n\t\t}\n\n\t\tif ( this.clearDepth ) {\n\n\t\t\trenderer.clearDepth();\n\n\t\t}\n\n\t\trenderer.render( this.scene, this.camera, this.renderToScreen ? null : readBuffer, this.clear );\n\n\t\tif ( this.clearColor ) {\n\n\t\t\trenderer.setClearColor( oldClearColor, oldClearAlpha );\n\n\t\t}\n\n\t\tthis.scene.overrideMaterial = null;\n\t\trenderer.autoClear = oldAutoClear;\n\t}\n\n} );\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/shaders/RenderPass.js?");

/***/ }),

/***/ "./src/js/lib/shaders/ShaderPass.js":
/*!******************************************!*\
  !*** ./src/js/lib/shaders/ShaderPass.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nTHREE.ShaderPass = function ( shader, textureID ) {\n\n\tTHREE.Pass.call( this );\n\n\tthis.textureID = ( textureID !== undefined ) ? textureID : \"tDiffuse\";\n\n\tif ( shader instanceof THREE.ShaderMaterial ) {\n\n\t\tthis.uniforms = shader.uniforms;\n\n\t\tthis.material = shader;\n\n\t} else if ( shader ) {\n\n\t\tthis.uniforms = THREE.UniformsUtils.clone( shader.uniforms );\n\n\t\tthis.material = new THREE.ShaderMaterial( {\n\n\t\t\tdefines: Object.assign( {}, shader.defines ),\n\t\t\tuniforms: this.uniforms,\n\t\t\tvertexShader: shader.vertexShader,\n\t\t\tfragmentShader: shader.fragmentShader\n\n\t\t} );\n\n\t}\n\n\tthis.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\tthis.scene = new THREE.Scene();\n\n\tthis.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );\n\tthis.quad.frustumCulled = false; // Avoid getting clipped\n\tthis.scene.add( this.quad );\n\n};\n\nTHREE.ShaderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {\n\n\tconstructor: THREE.ShaderPass,\n\n\trender: function( renderer, writeBuffer, readBuffer, delta, maskActive ) {\n\n\t\tif ( this.uniforms[ this.textureID ] ) {\n\n\t\t\tthis.uniforms[ this.textureID ].value = readBuffer.texture;\n\n\t\t}\n\n\t\tthis.quad.material = this.material;\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.render( this.scene, this.camera );\n\n\t\t} else {\n\n\t\t\trenderer.render( this.scene, this.camera, writeBuffer, this.clear );\n\n\t\t}\n\n\t}\n\n} );\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/shaders/ShaderPass.js?");

/***/ }),

/***/ "./src/js/lib/shaders/Sky.js":
/*!***********************************!*\
  !*** ./src/js/lib/shaders/Sky.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author zz85 / https://github.com/zz85\n *\n * Based on \"A Practical Analytic Model for Daylight\"\n * aka The Preetham Model, the de facto standard analytic skydome model\n * http://www.cs.utah.edu/~shirley/papers/sunsky/sunsky.pdf\n *\n * First implemented by Simon Wallner\n * http://www.simonwallner.at/projects/atmospheric-scattering\n *\n * Improved by Martin Upitis\n * http://blenderartists.org/forum/showthread.php?245954-preethams-sky-impementation-HDR\n *\n * Three.js integration by zz85 http://twitter.com/blurspline\n*/\n\nTHREE.Sky = function () {\n\n\tvar shader = THREE.Sky.SkyShader;\n\n\tvar material = new THREE.ShaderMaterial( {\n\t\tfragmentShader: shader.fragmentShader,\n\t\tvertexShader: shader.vertexShader,\n\t\tuniforms: THREE.UniformsUtils.clone( shader.uniforms ),\n\t\tside: THREE.BackSide\n\t} );\n\n\tTHREE.Mesh.call( this, new THREE.SphereBufferGeometry( 1, 12, 8 ), material );\n\n};\n\nTHREE.Sky.prototype = Object.create( THREE.Mesh.prototype );\n\nTHREE.Sky.SkyShader = {\n\n\tuniforms: {\n\t\tluminance: { value: 1 },\n\t\tturbidity: { value: 2 },\n\t\trayleigh: { value: 1 },\n\t\tmieCoefficient: { value: 0.003 },\n\t\tmieDirectionalG: { value: 0.95 },\n\t\tsunPosition: { value: new THREE.Vector3() }\n\t},\n\n\tvertexShader: [\n\t\t'uniform vec3 sunPosition;',\n\t\t'uniform float rayleigh;',\n\t\t'uniform float turbidity;',\n\t\t'uniform float mieCoefficient;',\n\n\t\t'varying vec3 vWorldPosition;',\n\t\t'varying vec3 vSunDirection;',\n\t\t'varying float vSunfade;',\n\t\t'varying vec3 vBetaR;',\n\t\t'varying vec3 vBetaM;',\n\t\t'varying float vSunE;',\n\n\t\t'const vec3 up = vec3( 0.0, 1.0, 0.0 );',\n\n\t\t// constants for atmospheric scattering\n\t\t'const float e = 2.71828182845904523536028747135266249775724709369995957;',\n\t\t'const float pi = 3.141592653589793238462643383279502884197169;',\n\n\t\t// wavelength of used primaries, according to preetham\n\t\t'const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );',\n\t\t// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n\t\t// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n\t\t'const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );',\n\n\t\t// mie stuff\n\t\t// K coefficient for the primaries\n\t\t'const float v = 4.0;',\n\t\t'const vec3 K = vec3( 0.686, 0.678, 0.666 );',\n\t\t// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n\t\t'const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );',\n\n\t\t// earth shadow hack\n\t\t// cutoffAngle = pi / 1.95;\n\t\t'const float cutoffAngle = 1.6110731556870734;',\n\t\t'const float steepness = 1.5;',\n\t\t'const float EE = 1000.0;',\n\n\t\t'float sunIntensity( float zenithAngleCos ) {',\n\t\t'\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );',\n\t\t'\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );',\n\t\t'}',\n\n\t\t'vec3 totalMie( float T ) {',\n\t\t'\tfloat c = ( 0.2 * T ) * 10E-18;',\n\t\t'\treturn 0.434 * c * MieConst;',\n\t\t'}',\n\n\t\t'void main() {',\n\n\t\t'\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );',\n\t\t'\tvWorldPosition = worldPosition.xyz;',\n\n\t\t'\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n\n\t\t'\tvSunDirection = normalize( sunPosition );',\n\n\t\t'\tvSunE = sunIntensity( dot( vSunDirection, up ) );',\n\n\t\t'\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );',\n\n\t\t'\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );',\n\n\t\t// extinction (absorbtion + out scattering)\n\t\t// rayleigh coefficients\n\t\t'\tvBetaR = totalRayleigh * rayleighCoefficient;',\n\n\t\t// mie coefficients\n\t\t'\tvBetaM = totalMie( turbidity ) * mieCoefficient;',\n\n\t\t'}'\n\t].join( '\\n' ),\n\n\tfragmentShader: [\n\t\t'varying vec3 vWorldPosition;',\n\t\t'varying vec3 vSunDirection;',\n\t\t'varying float vSunfade;',\n\t\t'varying vec3 vBetaR;',\n\t\t'varying vec3 vBetaM;',\n\t\t'varying float vSunE;',\n\n\t\t'uniform float luminance;',\n\t\t'uniform float mieDirectionalG;',\n\n\t\t'const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );',\n\n\t\t// constants for atmospheric scattering\n\t\t'const float pi = 3.141592653589793238462643383279502884197169;',\n\n\t\t'const float n = 1.0003;', // refractive index of air\n\t\t'const float N = 2.545E25;', // number of molecules per unit volume for air at\n\t\t\t\t\t\t\t\t\t// 288.15K and 1013mb (sea level -45 celsius)\n\n\t\t// optical length at zenith for molecules\n\t\t'const float rayleighZenithLength = 8.4E3;',\n\t\t'const float mieZenithLength = 1.25E3;',\n\t\t'const vec3 up = vec3( 0.0, 1.0, 0.0 );',\n\t\t// 66 arc seconds -> degrees, and the cosine of that\n\t\t'const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;',\n\n\t\t// 3.0 / ( 16.0 * pi )\n\t\t'const float THREE_OVER_SIXTEENPI = 0.05968310365946075;',\n\t\t// 1.0 / ( 4.0 * pi )\n\t\t'const float ONE_OVER_FOURPI = 0.07957747154594767;',\n\n\t\t'float rayleighPhase( float cosTheta ) {',\n\t\t'\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );',\n\t\t'}',\n\n\t\t'float hgPhase( float cosTheta, float g ) {',\n\t\t'\tfloat g2 = pow( g, 2.0 );',\n\t\t'\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );',\n\t\t'\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );',\n\t\t'}',\n\n\t\t// Filmic ToneMapping http://filmicgames.com/archives/75\n\t\t'const float A = 0.15;',\n\t\t'const float B = 0.50;',\n\t\t'const float C = 0.10;',\n\t\t'const float D = 0.20;',\n\t\t'const float E = 0.02;',\n\t\t'const float F = 0.30;',\n\n\t\t'const float whiteScale = 1.0748724675633854;', // 1.0 / Uncharted2Tonemap(1000.0)\n\n\t\t'vec3 Uncharted2Tonemap( vec3 x ) {',\n\t\t'\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;',\n\t\t'}',\n\n\n\t\t'void main() {',\n\t\t// optical length\n\t\t// cutoff angle at 90 to avoid singularity in next formula.\n\t\t'\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );',\n\t\t'\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );',\n\t\t'\tfloat sR = rayleighZenithLength * inverse;',\n\t\t'\tfloat sM = mieZenithLength * inverse;',\n\n\t\t// combined extinction factor\n\t\t'\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );',\n\n\t\t// in scattering\n\t\t'\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );',\n\n\t\t'\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );',\n\t\t'\tvec3 betaRTheta = vBetaR * rPhase;',\n\n\t\t'\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );',\n\t\t'\tvec3 betaMTheta = vBetaM * mPhase;',\n\n\t\t'\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );',\n\t\t'\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );',\n\n\t\t// nightsky\n\t\t'\tvec3 direction = normalize( vWorldPosition - cameraPos );',\n\t\t'\tfloat theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]',\n\t\t'\tfloat phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]',\n\t\t'\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );',\n\t\t'\tvec3 L0 = vec3( 0.1 ) * Fex;',\n\n\t\t// composition + solar disc\n\t\t'\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );',\n\t\t'\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;',\n\n\t\t'\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );',\n\n\t\t'\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );',\n\t\t'\tvec3 color = curr * whiteScale;',\n\n\t\t'\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );',\n\n\t\t'\tgl_FragColor = vec4( retColor, 1.0 );',\n\n\t\t'}'\n\t].join( '\\n' )\n\n};\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/shaders/Sky.js?");

/***/ }),

/***/ "./src/js/lib/utils/Detector.js":
/*!**************************************!*\
  !*** ./src/js/lib/utils/Detector.js ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/**\n * @author alteredq / http://alteredqualia.com/\n * @author mr.doob / http://mrdoob.com/\n */\n\nvar Detector = {\n\n\tcanvas: !! window.CanvasRenderingContext2D,\n\twebgl: ( function () {\n\n\t\ttry {\n\n\t\t\tvar canvas = document.createElement( 'canvas' ); return !! ( window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t} )(),\n\tworkers: !! window.Worker,\n\tfileapi: window.File && window.FileReader && window.FileList && window.Blob,\n\n\tgetWebGLErrorMessage: function () {\n\n\t\tvar element = document.createElement( 'div' );\n\t\telement.id = 'webgl-error-message';\n\t\telement.style.fontFamily = 'monospace';\n\t\telement.style.fontSize = '13px';\n\t\telement.style.fontWeight = 'normal';\n\t\telement.style.textAlign = 'center';\n\t\telement.style.background = '#fff';\n\t\telement.style.color = '#000';\n\t\telement.style.padding = '1.5em';\n\t\telement.style.width = '400px';\n\t\telement.style.margin = '5em auto 0';\n\n\t\tif ( ! this.webgl ) {\n\n\t\t\telement.innerHTML = window.WebGLRenderingContext ? [\n\t\t\t\t'Your graphics card does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">WebGL</a>.<br />',\n\t\t\t\t'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000\">here</a>.'\n\t\t\t].join( '\\n' ) : [\n\t\t\t\t'Your browser does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">WebGL</a>.<br/>',\n\t\t\t\t'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000\">here</a>.'\n\t\t\t].join( '\\n' );\n\n\t\t}\n\n\t\treturn element;\n\n\t},\n\n\taddGetWebGLMessage: function ( parameters ) {\n\n\t\tvar parent, id, element;\n\n\t\tparameters = parameters || {};\n\n\t\tparent = parameters.parent !== undefined ? parameters.parent : document.body;\n\t\tid = parameters.id !== undefined ? parameters.id : 'oldie';\n\n\t\telement = Detector.getWebGLErrorMessage();\n\t\telement.id = id;\n\n\t\tparent.appendChild( element );\n\n\t}\n\n};\n\nconsole.log('ahoj');\n\n// browserify support\nif ( true ) {\n\n\tmodule.exports = Detector;\n\n}\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/utils/Detector.js?");

/***/ }),

/***/ "./src/js/lib/utils/FBXLoader.js":
/*!***************************************!*\
  !*** ./src/js/lib/utils/FBXLoader.js ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author Kyle-Larson https://github.com/Kyle-Larson\n * @author Takahiro https://github.com/takahirox\n * @author Lewy Blue https://github.com/looeee\n *\n * Loader loads FBX file and generates Group representing FBX scene.\n * Requires FBX file to be >= 7.0 and in ASCII or >= 6400 in Binary format\n * Versions lower than this may load but will probably have errors\n *\n * Needs Support:\n *  Morph normals / blend shape normals\n *  Animation tracks for morph targets\n *\n *\tEuler rotation order\n *\n * FBX format references:\n * \thttps://wiki.blender.org/index.php/User:Mont29/Foundation/FBX_File_Structure\n * \thttp://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_index_html (C++ SDK reference)\n *\n * \tBinary format specification:\n *\t\thttps://code.blender.org/2013/08/fbx-binary-file-format-specification/\n */\n\n\n( function () {\n\n\tTHREE.FBXLoader = function ( manager ) {\n\n\t\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\n\n\t};\n\n\tObject.assign( THREE.FBXLoader.prototype, {\n\n\t\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\t\tvar self = this;\n\n\t\t\tvar resourceDirectory = THREE.LoaderUtils.extractUrlBase( url );\n\n\t\t\tvar loader = new THREE.FileLoader( this.manager );\n\t\t\tloader.setResponseType( 'arraybuffer' );\n\t\t\tloader.load( url, function ( buffer ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\tvar scene = self.parse( buffer, resourceDirectory );\n\t\t\t\t\tonLoad( scene );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\twindow.setTimeout( function () {\n\n\t\t\t\t\t\tif ( onError ) onError( error );\n\n\t\t\t\t\t\tself.manager.itemError( url );\n\n\t\t\t\t\t}, 0 );\n\n\t\t\t\t}\n\n\t\t\t}, onProgress, onError );\n\n\t\t},\n\n\t\tparse: function ( FBXBuffer, resourceDirectory ) {\n\n\t\t\tvar FBXTree;\n\n\t\t\tif ( isFbxFormatBinary( FBXBuffer ) ) {\n\n\t\t\t\tFBXTree = new BinaryParser().parse( FBXBuffer );\n\n\t\t\t} else {\n\n\t\t\t\tvar FBXText = convertArrayBufferToString( FBXBuffer );\n\n\t\t\t\tif ( ! isFbxFormatASCII( FBXText ) ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown format.' );\n\n\t\t\t\t}\n\n\t\t\t\tif ( getFbxVersion( FBXText ) < 7000 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + getFbxVersion( FBXText ) );\n\n\t\t\t\t}\n\n\t\t\t\tFBXTree = new TextParser().parse( FBXText );\n\n\t\t\t}\n\n\t\t\t// console.log( FBXTree );\n\n\t\t\tvar connections = parseConnections( FBXTree );\n\t\t\tvar images = parseImages( FBXTree );\n\t\t\tvar textures = parseTextures( FBXTree, new THREE.TextureLoader( this.manager ).setPath( resourceDirectory ), images, connections );\n\t\t\tvar materials = parseMaterials( FBXTree, textures, connections );\n\t\t\tvar deformers = parseDeformers( FBXTree, connections );\n\t\t\tvar geometryMap = parseGeometries( FBXTree, connections, deformers );\n\t\t\tvar sceneGraph = parseScene( FBXTree, connections, deformers.skeletons, geometryMap, materials );\n\n\t\t\treturn sceneGraph;\n\n\t\t}\n\n\t} );\n\n\t// Parses FBXTree.Connections which holds parent-child connections between objects (e.g. material -> texture, model->geometry )\n\t// and details the connection type\n\tfunction parseConnections( FBXTree ) {\n\n\t\tvar connectionMap = new Map();\n\n\t\tif ( 'Connections' in FBXTree ) {\n\n\t\t\tvar rawConnections = FBXTree.Connections.connections;\n\n\t\t\trawConnections.forEach( function ( rawConnection ) {\n\n\t\t\t\tvar fromID = rawConnection[ 0 ];\n\t\t\t\tvar toID = rawConnection[ 1 ];\n\t\t\t\tvar relationship = rawConnection[ 2 ];\n\n\t\t\t\tif ( ! connectionMap.has( fromID ) ) {\n\n\t\t\t\t\tconnectionMap.set( fromID, {\n\t\t\t\t\t\tparents: [],\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tvar parentRelationship = { ID: toID, relationship: relationship };\n\t\t\t\tconnectionMap.get( fromID ).parents.push( parentRelationship );\n\n\t\t\t\tif ( ! connectionMap.has( toID ) ) {\n\n\t\t\t\t\tconnectionMap.set( toID, {\n\t\t\t\t\t\tparents: [],\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tvar childRelationship = { ID: fromID, relationship: relationship };\n\t\t\t\tconnectionMap.get( toID ).children.push( childRelationship );\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn connectionMap;\n\n\t}\n\n\t// Parse FBXTree.Objects.Video for embedded image data\n\t// These images are connected to textures in FBXTree.Objects.Textures\n\t// via FBXTree.Connections.\n\tfunction parseImages( FBXTree ) {\n\n\t\tvar images = {};\n\t\tvar blobs = {};\n\n\t\tif ( 'Video' in FBXTree.Objects ) {\n\n\t\t\tvar videoNodes = FBXTree.Objects.Video;\n\n\t\t\tfor ( var nodeID in videoNodes ) {\n\n\t\t\t\tvar videoNode = videoNodes[ nodeID ];\n\n\t\t\t\tvar id = parseInt( nodeID );\n\n\t\t\t\timages[ id ] = videoNode.RelativeFilename || videoNode.Filename;\n\n\t\t\t\t// raw image data is in videoNode.Content\n\t\t\t\tif ( 'Content' in videoNode ) {\n\n\t\t\t\t\tvar arrayBufferContent = ( videoNode.Content instanceof ArrayBuffer ) && ( videoNode.Content.byteLength > 0 );\n\t\t\t\t\tvar base64Content = ( typeof videoNode.Content === 'string' ) && ( videoNode.Content !== '' );\n\n\t\t\t\t\tif ( arrayBufferContent || base64Content ) {\n\n\t\t\t\t\t\tvar image = parseImage( videoNodes[ nodeID ] );\n\n\t\t\t\t\t\tblobs[ videoNode.RelativeFilename || videoNode.Filename ] = image;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( var id in images ) {\n\n\t\t\tvar filename = images[ id ];\n\n\t\t\tif ( blobs[ filename ] !== undefined ) images[ id ] = blobs[ filename ];\n\t\t\telse images[ id ] = images[ id ].split( '\\\\' ).pop();\n\n\t\t}\n\n\t\treturn images;\n\n\t}\n\n\t// Parse embedded image data in FBXTree.Video.Content\n\tfunction parseImage( videoNode ) {\n\n\t\tvar content = videoNode.Content;\n\t\tvar fileName = videoNode.RelativeFilename || videoNode.Filename;\n\t\tvar extension = fileName.slice( fileName.lastIndexOf( '.' ) + 1 ).toLowerCase();\n\n\t\tvar type;\n\n\t\tswitch ( extension ) {\n\n\t\t\tcase 'bmp':\n\n\t\t\t\ttype = 'image/bmp';\n\t\t\t\tbreak;\n\n\t\t\tcase 'jpg':\n\t\t\tcase 'jpeg':\n\n\t\t\t\ttype = 'image/jpeg';\n\t\t\t\tbreak;\n\n\t\t\tcase 'png':\n\n\t\t\t\ttype = 'image/png';\n\t\t\t\tbreak;\n\n\t\t\tcase 'tif':\n\n\t\t\t\ttype = 'image/tiff';\n\t\t\t\tbreak;\n\n \t\t\tcase 'tga':\n\n\t\t\t\tif ( typeof THREE.TGALoader !== 'function' ) {\n\n\t\t\t\t\tconsole.warn( 'FBXLoader: THREE.TGALoader is required to load TGA textures' );\n\t\t\t\t\treturn;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( THREE.Loader.Handlers.get( '.tga' ) === null ) {\n\n\t\t\t\t\t\tTHREE.Loader.Handlers.add( /\\.tga$/i, new THREE.TGALoader() );\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttype = 'image/tga';\n\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\tdefault:\n\n\t\t\t\tconsole.warn( 'FBXLoader: Image type \"' + extension + '\" is not supported.' );\n\t\t\t\treturn;\n\n\t\t}\n\n\t\tif ( typeof content === 'string' ) { // ASCII format\n\n\t\t\treturn 'data:' + type + ';base64,' + content;\n\n\t\t} else { // Binary Format\n\n\t\t\tvar array = new Uint8Array( content );\n\t\t\treturn window.URL.createObjectURL( new Blob( [ array ], { type: type } ) );\n\n\t\t}\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Texture\n\t// These contain details such as UV scaling, cropping, rotation etc and are connected\n\t// to images in FBXTree.Objects.Video\n\tfunction parseTextures( FBXTree, loader, images, connections ) {\n\n\t\tvar textureMap = new Map();\n\n\t\tif ( 'Texture' in FBXTree.Objects ) {\n\n\t\t\tvar textureNodes = FBXTree.Objects.Texture;\n\t\t\tfor ( var nodeID in textureNodes ) {\n\n\t\t\t\tvar texture = parseTexture( textureNodes[ nodeID ], loader, images, connections );\n\t\t\t\ttextureMap.set( parseInt( nodeID ), texture );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn textureMap;\n\n\t}\n\n\t// Parse individual node in FBXTree.Objects.Texture\n\tfunction parseTexture( textureNode, loader, images, connections ) {\n\n\t\tvar texture = loadTexture( textureNode, loader, images, connections );\n\n\t\ttexture.ID = textureNode.id;\n\n\t\ttexture.name = textureNode.attrName;\n\n\t\tvar wrapModeU = textureNode.WrapModeU;\n\t\tvar wrapModeV = textureNode.WrapModeV;\n\n\t\tvar valueU = wrapModeU !== undefined ? wrapModeU.value : 0;\n\t\tvar valueV = wrapModeV !== undefined ? wrapModeV.value : 0;\n\n\t\t// http://download.autodesk.com/us/fbx/SDKdocs/FBX_SDK_Help/files/fbxsdkref/class_k_fbx_texture.html#889640e63e2e681259ea81061b85143a\n\t\t// 0: repeat(default), 1: clamp\n\n\t\ttexture.wrapS = valueU === 0 ? THREE.RepeatWrapping : THREE.ClampToEdgeWrapping;\n\t\ttexture.wrapT = valueV === 0 ? THREE.RepeatWrapping : THREE.ClampToEdgeWrapping;\n\n\t\tif ( 'Scaling' in textureNode ) {\n\n\t\t\tvar values = textureNode.Scaling.value;\n\n\t\t\ttexture.repeat.x = values[ 0 ];\n\t\t\ttexture.repeat.y = values[ 1 ];\n\n\t\t}\n\n\t\treturn texture;\n\n\t}\n\n\t// load a texture specified as a blob or data URI, or via an external URL using THREE.TextureLoader\n\tfunction loadTexture( textureNode, loader, images, connections ) {\n\n\t\tvar fileName;\n\n\t\tvar currentPath = loader.path;\n\n\t\tvar children = connections.get( textureNode.id ).children;\n\n\t\tif ( children !== undefined && children.length > 0 && images[ children[ 0 ].ID ] !== undefined ) {\n\n\t\t\tfileName = images[ children[ 0 ].ID ];\n\n\t\t\tif ( fileName.indexOf( 'blob:' ) === 0 || fileName.indexOf( 'data:' ) === 0 ) {\n\n\t\t\t\tloader.setPath( undefined );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar texture;\n\n\t\tif ( textureNode.FileName.slice( -3 ).toLowerCase() === 'tga' ) {\n\n \t\t\ttexture = THREE.Loader.Handlers.get( '.tga' ).load( fileName );\n\n \t\t} else {\n\n \t\t\ttexture = loader.load( fileName );\n\n \t\t}\n\n\t\tloader.setPath( currentPath );\n\n\t\treturn texture;\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Material\n\tfunction parseMaterials( FBXTree, textureMap, connections ) {\n\n\t\tvar materialMap = new Map();\n\n\t\tif ( 'Material' in FBXTree.Objects ) {\n\n\t\t\tvar materialNodes = FBXTree.Objects.Material;\n\n\t\t\tfor ( var nodeID in materialNodes ) {\n\n\t\t\t\tvar material = parseMaterial( FBXTree, materialNodes[ nodeID ], textureMap, connections );\n\n\t\t\t\tif ( material !== null ) materialMap.set( parseInt( nodeID ), material );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn materialMap;\n\n\t}\n\n\t// Parse single node in FBXTree.Objects.Material\n\t// Materials are connected to texture maps in FBXTree.Objects.Textures\n\t// FBX format currently only supports Lambert and Phong shading models\n\tfunction parseMaterial( FBXTree, materialNode, textureMap, connections ) {\n\n\t\tvar ID = materialNode.id;\n\t\tvar name = materialNode.attrName;\n\t\tvar type = materialNode.ShadingModel;\n\n\t\t//Case where FBX wraps shading model in property object.\n\t\tif ( typeof type === 'object' ) {\n\n\t\t\ttype = type.value;\n\n\t\t}\n\n\t\t// Ignore unused materials which don't have any connections.\n\t\tif ( ! connections.has( ID ) ) return null;\n\n\t\tvar parameters = parseParameters( FBXTree, materialNode, textureMap, ID, connections );\n\n\t\tvar material;\n\n\t\tswitch ( type.toLowerCase() ) {\n\n\t\t\tcase 'phong':\n\t\t\t\tmaterial = new THREE.MeshPhongMaterial();\n\t\t\t\tbreak;\n\t\t\tcase 'lambert':\n\t\t\t\tmaterial = new THREE.MeshLambertMaterial();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: unknown material type \"%s\". Defaulting to MeshPhongMaterial.', type );\n\t\t\t\tmaterial = new THREE.MeshPhongMaterial( { color: 0x3300ff } );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tmaterial.setValues( parameters );\n\t\tmaterial.name = name;\n\n\t\treturn material;\n\n\t}\n\n\t// Parse FBX material and return parameters suitable for a three.js material\n\t// Also parse the texture map and return any textures associated with the material\n\tfunction parseParameters( FBXTree, properties, textureMap, ID, connections ) {\n\n\t\tvar parameters = {};\n\n\t\tif ( properties.BumpFactor ) {\n\n\t\t\tparameters.bumpScale = properties.BumpFactor.value;\n\n\t\t}\n\t\tif ( properties.Diffuse ) {\n\n\t\t\tparameters.color = new THREE.Color().fromArray( properties.Diffuse.value );\n\n\t\t} else if ( properties.DiffuseColor && properties.DiffuseColor.type === 'Color' ) {\n\n\t\t\t// The blender exporter exports diffuse here instead of in properties.Diffuse\n\t\t\tparameters.color = new THREE.Color().fromArray( properties.DiffuseColor.value );\n\n\t\t}\n\t\tif ( properties.DisplacementFactor ) {\n\n\t\t\tparameters.displacementScale = properties.DisplacementFactor.value;\n\n\t\t}\n\t\tif ( properties.Emissive ) {\n\n\t\t\tparameters.emissive = new THREE.Color().fromArray( properties.Emissive.value );\n\n\t\t} else if ( properties.EmissiveColor && properties.EmissiveColor.type === 'Color' ) {\n\n\t\t\t// The blender exporter exports emissive color here instead of in properties.Emissive\n\t\t\tparameters.emissive = new THREE.Color().fromArray( properties.EmissiveColor.value );\n\n\t\t}\n\t\tif ( properties.EmissiveFactor ) {\n\n\t\t\tparameters.emissiveIntensity = parseFloat( properties.EmissiveFactor.value );\n\n\t\t}\n\t\tif ( properties.Opacity ) {\n\n\t\t\tparameters.opacity = parseFloat( properties.Opacity.value );\n\n\t\t}\n\t\tif ( parameters.opacity < 1.0 ) {\n\n\t\t\tparameters.transparent = true;\n\n\t\t}\n\t\tif ( properties.ReflectionFactor ) {\n\n\t\t\tparameters.reflectivity = properties.ReflectionFactor.value;\n\n\t\t}\n\t\tif ( properties.Shininess ) {\n\n\t\t\tparameters.shininess = properties.Shininess.value;\n\n\t\t}\n\t\tif ( properties.Specular ) {\n\n\t\t\tparameters.specular = new THREE.Color().fromArray( properties.Specular.value );\n\n\t\t} else if ( properties.SpecularColor && properties.SpecularColor.type === 'Color' ) {\n\n\t\t\t// The blender exporter exports specular color here instead of in properties.Specular\n\t\t\tparameters.specular = new THREE.Color().fromArray( properties.SpecularColor.value );\n\n\t\t}\n\n\t\tconnections.get( ID ).children.forEach( function ( child ) {\n\n\t\t\tvar type = child.relationship;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'Bump':\n\t\t\t\t\tparameters.bumpMap = textureMap.get( child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'DiffuseColor':\n\t\t\t\t\tparameters.map = getTexture( FBXTree, textureMap, child.ID, connections );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'DisplacementColor':\n\t\t\t\t\tparameters.displacementMap = getTexture( FBXTree, textureMap, child.ID, connections );\n\t\t\t\t\tbreak;\n\n\n\t\t\t\tcase 'EmissiveColor':\n\t\t\t\t\tparameters.emissiveMap = getTexture( FBXTree, textureMap, child.ID, connections );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'NormalMap':\n\t\t\t\t\tparameters.normalMap = getTexture( FBXTree, textureMap, child.ID, connections );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ReflectionColor':\n\t\t\t\t\tparameters.envMap = getTexture( FBXTree, textureMap, child.ID, connections );\n\t\t\t\t\tparameters.envMap.mapping = THREE.EquirectangularReflectionMapping;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'SpecularColor':\n\t\t\t\t\tparameters.specularMap = getTexture( FBXTree, textureMap, child.ID, connections );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'TransparentColor':\n\t\t\t\t\tparameters.alphaMap = getTexture( FBXTree, textureMap, child.ID, connections );\n\t\t\t\t\tparameters.transparent = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'AmbientColor':\n\t\t\t\tcase 'ShininessExponent': // AKA glossiness map\n\t\t\t\tcase 'SpecularFactor': // AKA specularLevel\n\t\t\t\tcase 'VectorDisplacementColor': // NOTE: Seems to be a copy of DisplacementColor\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: %s map is not supported in three.js, skipping texture.', type );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn parameters;\n\n\t}\n\n\t// get a texture from the textureMap for use by a material.\n\tfunction getTexture( FBXTree, textureMap, id, connections ) {\n\n\t\t// if the texture is a layered texture, just use the first layer and issue a warning\n\t\tif ( 'LayeredTexture' in FBXTree.Objects && id in FBXTree.Objects.LayeredTexture ) {\n\n\t\t\tconsole.warn( 'THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer.' );\n\t\t\tid = connections.get( id ).children[ 0 ].ID;\n\n\t\t}\n\n\t\treturn textureMap.get( id );\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Deformer\n\t// Deformer node can contain skinning or Vertex Cache animation data, however only skinning is supported here\n\t// Generates map of Skeleton-like objects for use later when generating and binding skeletons.\n\tfunction parseDeformers( FBXTree, connections ) {\n\n\t\tvar skeletons = {};\n\t\tvar morphTargets = {};\n\n\t\tif ( 'Deformer' in FBXTree.Objects ) {\n\n\t\t\tvar DeformerNodes = FBXTree.Objects.Deformer;\n\n\t\t\tfor ( var nodeID in DeformerNodes ) {\n\n\t\t\t\tvar deformerNode = DeformerNodes[ nodeID ];\n\n\t\t\t\tvar relationships = connections.get( parseInt( nodeID ) );\n\n\t\t\t\tif ( deformerNode.attrType === 'Skin' ) {\n\n\t\t\t\t\tvar skeleton = parseSkeleton( relationships, DeformerNodes );\n\t\t\t\t\tskeleton.ID = nodeID;\n\n\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: skeleton attached to more than one geometry is not supported.' );\n\t\t\t\t\tskeleton.geometryID = relationships.parents[ 0 ].ID;\n\n\t\t\t\t\tskeletons[ nodeID ] = skeleton;\n\n\t\t\t\t} else if ( deformerNode.attrType === 'BlendShape' ) {\n\n\t\t\t\t\tvar morphTarget = {\n\t\t\t\t\t\tid: nodeID,\n\t\t\t\t\t};\n\n\t\t\t\t\tmorphTarget.rawTargets = parseMorphTargets( relationships, deformerNode, DeformerNodes, connections, FBXTree );\n\t\t\t\t\tmorphTarget.id = nodeID;\n\n\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: morph target attached to more than one geometry is not supported.' );\n\t\t\t\t\tmorphTarget.parentGeoID = relationships.parents[ 0 ].ID;\n\n\t\t\t\t\tmorphTargets[ nodeID ] = morphTarget;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\n\t\t\tskeletons: skeletons,\n\t\t\tmorphTargets: morphTargets,\n\n\t\t};\n\n\t}\n\n\t// Parse single nodes in FBXTree.Objects.Deformer\n\t// The top level skeleton node has type 'Skin' and sub nodes have type 'Cluster'\n\t// Each skin node represents a skeleton and each cluster node represents a bone\n\tfunction parseSkeleton( connections, deformerNodes ) {\n\n\t\tvar rawBones = [];\n\n\t\tconnections.children.forEach( function ( child ) {\n\n\t\t\tvar boneNode = deformerNodes[ child.ID ];\n\n\t\t\tif ( boneNode.attrType !== 'Cluster' ) return;\n\n\t\t\tvar rawBone = {\n\n\t\t\t\tID: child.ID,\n\t\t\t\tindices: [],\n\t\t\t\tweights: [],\n\t\t\t\ttransform: new THREE.Matrix4().fromArray( boneNode.Transform.a ),\n\t\t\t\ttransformLink: new THREE.Matrix4().fromArray( boneNode.TransformLink.a ),\n\t\t\t\tlinkMode: boneNode.Mode,\n\n\t\t\t};\n\n\t\t\tif ( 'Indexes' in boneNode ) {\n\n\t\t\t\trawBone.indices = boneNode.Indexes.a;\n\t\t\t\trawBone.weights = boneNode.Weights.a;\n\n\t\t\t}\n\n\t\t\trawBones.push( rawBone );\n\n\t\t} );\n\n\t\treturn {\n\n\t\t\trawBones: rawBones,\n\t\t\tbones: []\n\n\t\t};\n\n\t}\n\n\t// The top level morph deformer node has type \"BlendShape\" and sub nodes have type \"BlendShapeChannel\"\n\tfunction parseMorphTargets( relationships, deformerNode, deformerNodes, connections ) {\n\n\t\tvar rawMorphTargets = [];\n\n\t\tfor ( var i = 0; i < relationships.children.length; i ++ ) {\n\n\t\t\tif ( i === 8 ) {\n\n\t\t\t\tconsole.warn( 'FBXLoader: maximum of 8 morph targets supported. Ignoring additional targets.' );\n\n\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tvar child = relationships.children[ i ];\n\n\t\t\tvar morphTargetNode = deformerNodes[ child.ID ];\n\n\t\t\tvar rawMorphTarget = {\n\n\t\t\t\tname: morphTargetNode.attrName,\n\t\t\t\tinitialWeight: morphTargetNode.DeformPercent,\n\t\t\t\tid: morphTargetNode.id,\n\t\t\t\tfullWeights: morphTargetNode.FullWeights.a\n\n\t\t\t};\n\n\t\t\tif ( morphTargetNode.attrType !== 'BlendShapeChannel' ) return;\n\n\t\t\tvar targetRelationships = connections.get( parseInt( child.ID ) );\n\n\t\t\ttargetRelationships.children.forEach( function ( child ) {\n\n\t\t\t\tif ( child.relationship === 'DeformPercent' ) {\n\n\t\t\t\t\t// TODO: animation of morph targets is currently unsupported\n\t\t\t\t\trawMorphTarget.weightCurveID = child.ID;\n\t\t\t\t\t// weightCurve = FBXTree.Objects.AnimationCurveNode[ weightCurveID ];\n\n\t\t\t\t} else {\n\n\t\t\t\t\trawMorphTarget.geoID = child.ID;\n\t\t\t\t\t// morphGeo = FBXTree.Objects.Geometry[ geoID ];\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\trawMorphTargets.push( rawMorphTarget );\n\n\t\t}\n\n\t\treturn rawMorphTargets;\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Geometry\n\tfunction parseGeometries( FBXTree, connections, deformers ) {\n\n\t\tvar geometryMap = new Map();\n\n\t\tif ( 'Geometry' in FBXTree.Objects ) {\n\n\t\t\tvar geoNodes = FBXTree.Objects.Geometry;\n\n\t\t\tfor ( var nodeID in geoNodes ) {\n\n\t\t\t\tvar relationships = connections.get( parseInt( nodeID ) );\n\t\t\t\tvar geo = parseGeometry( FBXTree, relationships, geoNodes[ nodeID ], deformers );\n\n\t\t\t\tgeometryMap.set( parseInt( nodeID ), geo );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn geometryMap;\n\n\t}\n\n\t// Parse single node in FBXTree.Objects.Geometry\n\tfunction parseGeometry( FBXTree, relationships, geoNode, deformers ) {\n\n\t\tswitch ( geoNode.attrType ) {\n\n\t\t\tcase 'Mesh':\n\t\t\t\treturn parseMeshGeometry( FBXTree, relationships, geoNode, deformers );\n\t\t\t\tbreak;\n\n\t\t\tcase 'NurbsCurve':\n\t\t\t\treturn parseNurbsGeometry( geoNode );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\t// Parse single node mesh geometry in FBXTree.Objects.Geometry\n\tfunction parseMeshGeometry( FBXTree, relationships, geoNode, deformers ) {\n\n\t\tvar skeletons = deformers.skeletons;\n\t\tvar morphTargets = deformers.morphTargets;\n\n\t\tvar modelNodes = relationships.parents.map( function ( parent ) {\n\n\t\t\treturn FBXTree.Objects.Model[ parent.ID ];\n\n\t\t} );\n\n\t\t// don't create geometry if it is not associated with any models\n\t\tif ( modelNodes.length === 0 ) return;\n\n\t\tvar skeleton = relationships.children.reduce( function ( skeleton, child ) {\n\n\t\t\tif ( skeletons[ child.ID ] !== undefined ) skeleton = skeletons[ child.ID ];\n\n\t\t\treturn skeleton;\n\n\t\t}, null );\n\n\t\tvar morphTarget = relationships.children.reduce( function ( morphTarget, child ) {\n\n\t\t\tif ( morphTargets[ child.ID ] !== undefined ) morphTarget = morphTargets[ child.ID ];\n\n\t\t\treturn morphTarget;\n\n\t\t}, null );\n\n\t\tvar preTransform = new THREE.Matrix4();\n\n\t\t// TODO: if there is more than one model associated with the geometry, AND the models have\n\t\t// different geometric transforms, then this will cause problems\n\t\t// if ( modelNodes.length > 1 ) { }\n\n\t\t// For now just assume one model and get the preRotations from that\n\t\tvar modelNode = modelNodes[ 0 ];\n\n\t\tif ( 'GeometricRotation' in modelNode ) {\n\n\t\t\tvar array = modelNode.GeometricRotation.value.map( THREE.Math.degToRad );\n\t\t\tarray[ 3 ] = 'ZYX';\n\n\t\t\tpreTransform.makeRotationFromEuler( new THREE.Euler().fromArray( array ) );\n\n\t\t}\n\n\t\tif ( 'GeometricTranslation' in modelNode ) {\n\n\t\t\tpreTransform.setPosition( new THREE.Vector3().fromArray( modelNode.GeometricTranslation.value ) );\n\n\t\t}\n\n\t\tif ( 'GeometricScaling' in modelNode ) {\n\n\t\t\tpreTransform.scale( new THREE.Vector3().fromArray( modelNode.GeometricScaling.value ) );\n\n\t\t}\n\n\t\treturn genGeometry( FBXTree, geoNode, skeleton, morphTarget, preTransform );\n\n\t}\n\n\t// Generate a THREE.BufferGeometry from a node in FBXTree.Objects.Geometry\n\tfunction genGeometry( FBXTree, geoNode, skeleton, morphTarget, preTransform ) {\n\n\t\tvar geo = new THREE.BufferGeometry();\n\t\tif ( geoNode.attrName ) geo.name = geoNode.attrName;\n\n\t\tvar geoInfo = getGeoInfo( geoNode, skeleton );\n\n\t\tvar buffers = genBuffers( geoInfo );\n\n\t\tvar positionAttribute = new THREE.Float32BufferAttribute( buffers.vertex, 3 );\n\n\t\tpreTransform.applyToBufferAttribute( positionAttribute );\n\n\t\tgeo.addAttribute( 'position', positionAttribute );\n\n\t\tif ( buffers.colors.length > 0 ) {\n\n\t\t\tgeo.addAttribute( 'color', new THREE.Float32BufferAttribute( buffers.colors, 3 ) );\n\n\t\t}\n\n\t\tif ( skeleton ) {\n\n\t\t\tgeo.addAttribute( 'skinIndex', new THREE.Uint16BufferAttribute( buffers.weightsIndices, 4 ) );\n\n\t\t\tgeo.addAttribute( 'skinWeight', new THREE.Float32BufferAttribute( buffers.vertexWeights, 4 ) );\n\n\t\t\t// used later to bind the skeleton to the model\n\t\t\tgeo.FBX_Deformer = skeleton;\n\n\t\t}\n\n\t\tif ( buffers.normal.length > 0 ) {\n\n\t\t\tvar normalAttribute = new THREE.Float32BufferAttribute( buffers.normal, 3 );\n\n\t\t\tvar normalMatrix = new THREE.Matrix3().getNormalMatrix( preTransform );\n\t\t\tnormalMatrix.applyToBufferAttribute( normalAttribute );\n\n\t\t\tgeo.addAttribute( 'normal', normalAttribute );\n\n\t\t}\n\n\t\tbuffers.uvs.forEach( function ( uvBuffer, i ) {\n\n\t\t\t// subsequent uv buffers are called 'uv1', 'uv2', ...\n\t\t\tvar name = 'uv' + ( i + 1 ).toString();\n\n\t\t\t// the first uv buffer is just called 'uv'\n\t\t\tif ( i === 0 ) {\n\n\t\t\t\tname = 'uv';\n\n\t\t\t}\n\n\t\t\tgeo.addAttribute( name, new THREE.Float32BufferAttribute( buffers.uvs[ i ], 2 ) );\n\n\t\t} );\n\n\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t// Convert the material indices of each vertex into rendering groups on the geometry.\n\t\t\tvar prevMaterialIndex = buffers.materialIndex[ 0 ];\n\t\t\tvar startIndex = 0;\n\n\t\t\tbuffers.materialIndex.forEach( function ( currentIndex, i ) {\n\n\t\t\t\tif ( currentIndex !== prevMaterialIndex ) {\n\n\t\t\t\t\tgeo.addGroup( startIndex, i - startIndex, prevMaterialIndex );\n\n\t\t\t\t\tprevMaterialIndex = currentIndex;\n\t\t\t\t\tstartIndex = i;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\t// the loop above doesn't add the last group, do that here.\n\t\t\tif ( geo.groups.length > 0 ) {\n\n\t\t\t\tvar lastGroup = geo.groups[ geo.groups.length - 1 ];\n\t\t\t\tvar lastIndex = lastGroup.start + lastGroup.count;\n\n\t\t\t\tif ( lastIndex !== buffers.materialIndex.length ) {\n\n\t\t\t\t\tgeo.addGroup( lastIndex, buffers.materialIndex.length - lastIndex, prevMaterialIndex );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// case where there are multiple materials but the whole geometry is only\n\t\t\t// using one of them\n\t\t\tif ( geo.groups.length === 0 ) {\n\n\t\t\t\tgeo.addGroup( 0, buffers.materialIndex.length, buffers.materialIndex[ 0 ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\taddMorphTargets( FBXTree, geo, geoNode, morphTarget, preTransform );\n\n\t\treturn geo;\n\n\t}\n\n\tfunction getGeoInfo( geoNode, skeleton ) {\n\n\t\tvar geoInfo = {};\n\n\t\tgeoInfo.vertexPositions = ( geoNode.Vertices !== undefined ) ? geoNode.Vertices.a : [];\n\t\tgeoInfo.vertexIndices = ( geoNode.PolygonVertexIndex !== undefined ) ? geoNode.PolygonVertexIndex.a : [];\n\n\t\tif ( geoNode.LayerElementColor ) {\n\n\t\t\tgeoInfo.color = getColors( geoNode.LayerElementColor[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementMaterial ) {\n\n\t\t\tgeoInfo.material = getMaterials( geoNode.LayerElementMaterial[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementNormal ) {\n\n\t\t\tgeoInfo.normal = getNormals( geoNode.LayerElementNormal[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementUV ) {\n\n\t\t\tgeoInfo.uv = [];\n\n\t\t\tvar i = 0;\n\t\t\twhile ( geoNode.LayerElementUV[ i ] ) {\n\n\t\t\t\tgeoInfo.uv.push( getUVs( geoNode.LayerElementUV[ i ] ) );\n\t\t\t\ti ++;\n\n\t\t\t}\n\n\t\t}\n\n\t\tgeoInfo.weightTable = {};\n\n\t\tif ( skeleton !== null ) {\n\n\t\t\tgeoInfo.skeleton = skeleton;\n\n\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\n\n\t\t\t\t// loop over the bone's vertex indices and weights\n\t\t\t\trawBone.indices.forEach( function ( index, j ) {\n\n\t\t\t\t\tif ( geoInfo.weightTable[ index ] === undefined ) geoInfo.weightTable[ index ] = [];\n\n\t\t\t\t\tgeoInfo.weightTable[ index ].push( {\n\n\t\t\t\t\t\tid: i,\n\t\t\t\t\t\tweight: rawBone.weights[ j ],\n\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn geoInfo;\n\n\t}\n\n\tfunction genBuffers( geoInfo ) {\n\n\t\tvar buffers = {\n\t\t\tvertex: [],\n\t\t\tnormal: [],\n\t\t\tcolors: [],\n\t\t\tuvs: [],\n\t\t\tmaterialIndex: [],\n\t\t\tvertexWeights: [],\n\t\t\tweightsIndices: [],\n\t\t};\n\n\t\tvar polygonIndex = 0;\n\t\tvar faceLength = 0;\n\t\tvar displayedWeightsWarning = false;\n\n\t\t// these will hold data for a single face\n\t\tvar facePositionIndexes = [];\n\t\tvar faceNormals = [];\n\t\tvar faceColors = [];\n\t\tvar faceUVs = [];\n\t\tvar faceWeights = [];\n\t\tvar faceWeightIndices = [];\n\n\t\tgeoInfo.vertexIndices.forEach( function ( vertexIndex, polygonVertexIndex ) {\n\n\t\t\tvar endOfFace = false;\n\n\t\t\t// Face index and vertex index arrays are combined in a single array\n\t\t\t// A cube with quad faces looks like this:\n\t\t\t// PolygonVertexIndex: *24 {\n\t\t\t//  a: 0, 1, 3, -3, 2, 3, 5, -5, 4, 5, 7, -7, 6, 7, 1, -1, 1, 7, 5, -4, 6, 0, 2, -5\n\t\t\t//  }\n\t\t\t// Negative numbers mark the end of a face - first face here is 0, 1, 3, -3\n\t\t\t// to find index of last vertex bit shift the index: ^ - 1\n\t\t\tif ( vertexIndex < 0 ) {\n\n\t\t\t\tvertexIndex = vertexIndex ^ - 1; // equivalent to ( x * -1 ) - 1\n\t\t\t\tendOfFace = true;\n\n\t\t\t}\n\n\t\t\tvar weightIndices = [];\n\t\t\tvar weights = [];\n\n\t\t\tfacePositionIndexes.push( vertexIndex * 3, vertexIndex * 3 + 1, vertexIndex * 3 + 2 );\n\n\t\t\tif ( geoInfo.color ) {\n\n\t\t\t\tvar data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.color );\n\n\t\t\t\tfaceColors.push( data[ 0 ], data[ 1 ], data[ 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.skeleton ) {\n\n\t\t\t\tif ( geoInfo.weightTable[ vertexIndex ] !== undefined ) {\n\n\t\t\t\t\tgeoInfo.weightTable[ vertexIndex ].forEach( function ( wt ) {\n\n\t\t\t\t\t\tweights.push( wt.weight );\n\t\t\t\t\t\tweightIndices.push( wt.id );\n\n\t\t\t\t\t} );\n\n\n\t\t\t\t}\n\n\t\t\t\tif ( weights.length > 4 ) {\n\n\t\t\t\t\tif ( ! displayedWeightsWarning ) {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.' );\n\t\t\t\t\t\tdisplayedWeightsWarning = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tvar wIndex = [ 0, 0, 0, 0 ];\n\t\t\t\t\tvar Weight = [ 0, 0, 0, 0 ];\n\n\t\t\t\t\tweights.forEach( function ( weight, weightIndex ) {\n\n\t\t\t\t\t\tvar currentWeight = weight;\n\t\t\t\t\t\tvar currentIndex = weightIndices[ weightIndex ];\n\n\t\t\t\t\t\tWeight.forEach( function ( comparedWeight, comparedWeightIndex, comparedWeightArray ) {\n\n\t\t\t\t\t\t\tif ( currentWeight > comparedWeight ) {\n\n\t\t\t\t\t\t\t\tcomparedWeightArray[ comparedWeightIndex ] = currentWeight;\n\t\t\t\t\t\t\t\tcurrentWeight = comparedWeight;\n\n\t\t\t\t\t\t\t\tvar tmp = wIndex[ comparedWeightIndex ];\n\t\t\t\t\t\t\t\twIndex[ comparedWeightIndex ] = currentIndex;\n\t\t\t\t\t\t\t\tcurrentIndex = tmp;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tweightIndices = wIndex;\n\t\t\t\t\tweights = Weight;\n\n\t\t\t\t}\n\n\t\t\t\t// if the weight array is shorter than 4 pad with 0s\n\t\t\t\twhile ( weights.length < 4 ) {\n\n\t\t\t\t\tweights.push( 0 );\n\t\t\t\t\tweightIndices.push( 0 );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( var i = 0; i < 4; ++ i ) {\n\n\t\t\t\t\tfaceWeights.push( weights[ i ] );\n\t\t\t\t\tfaceWeightIndices.push( weightIndices[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.normal ) {\n\n\t\t\t\tvar data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.normal );\n\n\t\t\t\tfaceNormals.push( data[ 0 ], data[ 1 ], data[ 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t\tvar materialIndex = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.material )[ 0 ];\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.uv ) {\n\n\t\t\t\tgeoInfo.uv.forEach( function ( uv, i ) {\n\n\t\t\t\t\tvar data = getData( polygonVertexIndex, polygonIndex, vertexIndex, uv );\n\n\t\t\t\t\tif ( faceUVs[ i ] === undefined ) {\n\n\t\t\t\t\t\tfaceUVs[ i ] = [];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfaceUVs[ i ].push( data[ 0 ] );\n\t\t\t\t\tfaceUVs[ i ].push( data[ 1 ] );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfaceLength ++;\n\n\t\t\tif ( endOfFace ) {\n\n\t\t\t\tgenFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength );\n\n\t\t\t\tpolygonIndex ++;\n\t\t\t\tfaceLength = 0;\n\n\t\t\t\t// reset arrays for the next face\n\t\t\t\tfacePositionIndexes = [];\n\t\t\t\tfaceNormals = [];\n\t\t\t\tfaceColors = [];\n\t\t\t\tfaceUVs = [];\n\t\t\t\tfaceWeights = [];\n\t\t\t\tfaceWeightIndices = [];\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn buffers;\n\n\t}\n\n\t// Generate data for a single face in a geometry. If the face is a quad then split it into 2 tris\n\tfunction genFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength ) {\n\n\t\tfor ( var i = 2; i < faceLength; i ++ ) {\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 0 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 2 ] ] );\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 2 ] ] );\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 2 ] ] );\n\n\t\t\tif ( geoInfo.skeleton ) {\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 0 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 3 ] );\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 3 ] );\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 0 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 3 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.color ) {\n\n\t\t\t\tbuffers.colors.push( faceColors[ 0 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ 2 ] );\n\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 2 ] );\n\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.normal ) {\n\n\t\t\t\tbuffers.normal.push( faceNormals[ 0 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ 2 ] );\n\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 2 ] );\n\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.uv ) {\n\n\t\t\t\tgeoInfo.uv.forEach( function ( uv, j ) {\n\n\t\t\t\t\tif ( buffers.uvs[ j ] === undefined ) buffers.uvs[ j ] = [];\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 0 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 1 ] );\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 + 1 ] );\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 + 1 ] );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction addMorphTargets( FBXTree, parentGeo, parentGeoNode, morphTarget, preTransform ) {\n\n\t\tif ( morphTarget === null ) return;\n\n\t\tparentGeo.morphAttributes.position = [];\n\t\tparentGeo.morphAttributes.normal = [];\n\n\t\tmorphTarget.rawTargets.forEach( function ( rawTarget ) {\n\n\t\t\tvar morphGeoNode = FBXTree.Objects.Geometry[ rawTarget.geoID ];\n\n\t\t\tif ( morphGeoNode !== undefined ) {\n\n\t\t\t\tgenMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform );\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\t// a morph geometry node is similar to a standard  node, and the node is also contained\n\t// in FBXTree.Objects.Geometry, however it can only have attributes for position, normal\n\t// and a special attribute Index defining which vertices of the original geometry are affected\n\t// Normal and position attributes only have data for the vertices that are affected by the morph\n\tfunction genMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform ) {\n\n\t\tvar morphGeo = new THREE.BufferGeometry();\n\t\tif ( morphGeoNode.attrName ) morphGeo.name = morphGeoNode.attrName;\n\n\t\tvar vertexIndices = ( parentGeoNode.PolygonVertexIndex !== undefined ) ? parentGeoNode.PolygonVertexIndex.a : [];\n\n\t\t// make a copy of the parent's vertex positions\n\t\tvar vertexPositions = ( parentGeoNode.Vertices !== undefined ) ? parentGeoNode.Vertices.a.slice() : [];\n\n\t\tvar morphPositions = ( morphGeoNode.Vertices !== undefined ) ? morphGeoNode.Vertices.a : [];\n\t\tvar indices = ( morphGeoNode.Indexes !== undefined ) ? morphGeoNode.Indexes.a : [];\n\n\t\tfor ( var i = 0; i < indices.length; i ++ ) {\n\n\t\t\tvar morphIndex = indices[ i ] * 3;\n\n\t\t\t// FBX format uses blend shapes rather than morph targets. This can be converted\n\t\t\t// by additively combining the blend shape positions with the original geometry's positions\n\t\t\tvertexPositions[ morphIndex ] += morphPositions[ i * 3 ];\n\t\t\tvertexPositions[ morphIndex + 1 ] += morphPositions[ i * 3 + 1 ];\n\t\t\tvertexPositions[ morphIndex + 2 ] += morphPositions[ i * 3 + 2 ];\n\n\t\t}\n\n\t\t// TODO: add morph normal support\n\t\tvar morphGeoInfo = {\n\t\t\tvertexIndices: vertexIndices,\n\t\t\tvertexPositions: vertexPositions,\n\t\t};\n\n\t\tvar morphBuffers = genBuffers( morphGeoInfo );\n\n\t\tvar positionAttribute = new THREE.Float32BufferAttribute( morphBuffers.vertex, 3 );\n\t\tpositionAttribute.name = morphGeoNode.attrName;\n\n\t\tpreTransform.applyToBufferAttribute( positionAttribute );\n\n\t\tparentGeo.morphAttributes.position.push( positionAttribute );\n\n\t}\n\n\t// Parse normal from FBXTree.Objects.Geometry.LayerElementNormal if it exists\n\tfunction getNormals( NormalNode ) {\n\n\t\tvar mappingType = NormalNode.MappingInformationType;\n\t\tvar referenceType = NormalNode.ReferenceInformationType;\n\t\tvar buffer = NormalNode.Normals.a;\n\t\tvar indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tif ( 'NormalIndex' in NormalNode ) {\n\n\t\t\t\tindexBuffer = NormalNode.NormalIndex.a;\n\n\t\t\t} else if ( 'NormalsIndex' in NormalNode ) {\n\n\t\t\t\tindexBuffer = NormalNode.NormalsIndex.a;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 3,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse UVs from FBXTree.Objects.Geometry.LayerElementUV if it exists\n\tfunction getUVs( UVNode ) {\n\n\t\tvar mappingType = UVNode.MappingInformationType;\n\t\tvar referenceType = UVNode.ReferenceInformationType;\n\t\tvar buffer = UVNode.UV.a;\n\t\tvar indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tindexBuffer = UVNode.UVIndex.a;\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 2,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse Vertex Colors from FBXTree.Objects.Geometry.LayerElementColor if it exists\n\tfunction getColors( ColorNode ) {\n\n\t\tvar mappingType = ColorNode.MappingInformationType;\n\t\tvar referenceType = ColorNode.ReferenceInformationType;\n\t\tvar buffer = ColorNode.Colors.a;\n\t\tvar indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tindexBuffer = ColorNode.ColorIndex.a;\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 4,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse mapping and material data in FBXTree.Objects.Geometry.LayerElementMaterial if it exists\n\tfunction getMaterials( MaterialNode ) {\n\n\t\tvar mappingType = MaterialNode.MappingInformationType;\n\t\tvar referenceType = MaterialNode.ReferenceInformationType;\n\n\t\tif ( mappingType === 'NoMappingInformation' ) {\n\n\t\t\treturn {\n\t\t\t\tdataSize: 1,\n\t\t\t\tbuffer: [ 0 ],\n\t\t\t\tindices: [ 0 ],\n\t\t\t\tmappingType: 'AllSame',\n\t\t\t\treferenceType: referenceType\n\t\t\t};\n\n\t\t}\n\n\t\tvar materialIndexBuffer = MaterialNode.Materials.a;\n\n\t\t// Since materials are stored as indices, there's a bit of a mismatch between FBX and what\n\t\t// we expect.So we create an intermediate buffer that points to the index in the buffer,\n\t\t// for conforming with the other functions we've written for other data.\n\t\tvar materialIndices = [];\n\n\t\tfor ( var i = 0; i < materialIndexBuffer.length; ++ i ) {\n\n\t\t\tmaterialIndices.push( i );\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 1,\n\t\t\tbuffer: materialIndexBuffer,\n\t\t\tindices: materialIndices,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\tvar dataArray = [];\n\n\tfunction getData( polygonVertexIndex, polygonIndex, vertexIndex, infoObject ) {\n\n\t\tvar index;\n\n\t\tswitch ( infoObject.mappingType ) {\n\n\t\t\tcase 'ByPolygonVertex' :\n\t\t\t\tindex = polygonVertexIndex;\n\t\t\t\tbreak;\n\t\t\tcase 'ByPolygon' :\n\t\t\t\tindex = polygonIndex;\n\t\t\t\tbreak;\n\t\t\tcase 'ByVertice' :\n\t\t\t\tindex = vertexIndex;\n\t\t\t\tbreak;\n\t\t\tcase 'AllSame' :\n\t\t\t\tindex = infoObject.indices[ 0 ];\n\t\t\t\tbreak;\n\t\t\tdefault :\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: unknown attribute mapping type ' + infoObject.mappingType );\n\n\t\t}\n\n\t\tif ( infoObject.referenceType === 'IndexToDirect' ) index = infoObject.indices[ index ];\n\n\t\tvar from = index * infoObject.dataSize;\n\t\tvar to = from + infoObject.dataSize;\n\n\t\treturn slice( dataArray, infoObject.buffer, from, to );\n\n\t}\n\n\t// Generate a NurbGeometry from a node in FBXTree.Objects.Geometry\n\tfunction parseNurbsGeometry( geoNode ) {\n\n\t\tif ( THREE.NURBSCurve === undefined ) {\n\n\t\t\tconsole.error( 'THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.' );\n\t\t\treturn new THREE.BufferGeometry();\n\n\t\t}\n\n\t\tvar order = parseInt( geoNode.Order );\n\n\t\tif ( isNaN( order ) ) {\n\n\t\t\tconsole.error( 'THREE.FBXLoader: Invalid Order %s given for geometry ID: %s', geoNode.Order, geoNode.id );\n\t\t\treturn new THREE.BufferGeometry();\n\n\t\t}\n\n\t\tvar degree = order - 1;\n\n\t\tvar knots = geoNode.KnotVector.a;\n\t\tvar controlPoints = [];\n\t\tvar pointsValues = geoNode.Points.a;\n\n\t\tfor ( var i = 0, l = pointsValues.length; i < l; i += 4 ) {\n\n\t\t\tcontrolPoints.push( new THREE.Vector4().fromArray( pointsValues, i ) );\n\n\t\t}\n\n\t\tvar startKnot, endKnot;\n\n\t\tif ( geoNode.Form === 'Closed' ) {\n\n\t\t\tcontrolPoints.push( controlPoints[ 0 ] );\n\n\t\t} else if ( geoNode.Form === 'Periodic' ) {\n\n\t\t\tstartKnot = degree;\n\t\t\tendKnot = knots.length - 1 - startKnot;\n\n\t\t\tfor ( var i = 0; i < degree; ++ i ) {\n\n\t\t\t\tcontrolPoints.push( controlPoints[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar curve = new THREE.NURBSCurve( degree, knots, controlPoints, startKnot, endKnot );\n\t\tvar vertices = curve.getPoints( controlPoints.length * 7 );\n\n\t\tvar positions = new Float32Array( vertices.length * 3 );\n\n\t\tvertices.forEach( function ( vertex, i ) {\n\n\t\t\tvertex.toArray( positions, i * 3 );\n\n\t\t} );\n\n\t\tvar geometry = new THREE.BufferGeometry();\n\t\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );\n\n\t\treturn geometry;\n\n\t}\n\n\t// create the main THREE.Group() to be returned by the loader\n\tfunction parseScene( FBXTree, connections, skeletons, geometryMap, materialMap ) {\n\n\t\tvar sceneGraph = new THREE.Group();\n\n\t\tvar modelMap = parseModels( FBXTree, skeletons, geometryMap, materialMap, connections );\n\n\t\tvar modelNodes = FBXTree.Objects.Model;\n\n\t\tmodelMap.forEach( function ( model ) {\n\n\t\t\tvar modelNode = modelNodes[ model.ID ];\n\t\t\tsetLookAtProperties( FBXTree, model, modelNode, connections, sceneGraph );\n\n\t\t\tvar parentConnections = connections.get( model.ID ).parents;\n\n\t\t\tparentConnections.forEach( function ( connection ) {\n\n\t\t\t\tvar parent = modelMap.get( connection.ID );\n\t\t\t\tif ( parent !== undefined ) parent.add( model );\n\n\t\t\t} );\n\n\t\t\tif ( model.parent === null ) {\n\n\t\t\t\tsceneGraph.add( model );\n\n\t\t\t}\n\n\n\t\t} );\n\n\t\tbindSkeleton( FBXTree, skeletons, geometryMap, modelMap, connections );\n\n\t\taddAnimations( FBXTree, connections, sceneGraph );\n\n\t\tcreateAmbientLight( FBXTree, sceneGraph );\n\n\t\treturn sceneGraph;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.Model\n\tfunction parseModels( FBXTree, skeletons, geometryMap, materialMap, connections ) {\n\n\t\tvar modelMap = new Map();\n\t\tvar modelNodes = FBXTree.Objects.Model;\n\n\t\tfor ( var nodeID in modelNodes ) {\n\n\t\t\tvar id = parseInt( nodeID );\n\t\t\tvar node = modelNodes[ nodeID ];\n\t\t\tvar relationships = connections.get( id );\n\n\t\t\tvar model = buildSkeleton( relationships, skeletons, id, node.attrName );\n\n\t\t\tif ( ! model ) {\n\n\t\t\t\tswitch ( node.attrType ) {\n\n\t\t\t\t\tcase 'Camera':\n\t\t\t\t\t\tmodel = createCamera( FBXTree, relationships );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Light':\n\t\t\t\t\t\tmodel = createLight( FBXTree, relationships );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Mesh':\n\t\t\t\t\t\tmodel = createMesh( FBXTree, relationships, geometryMap, materialMap );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'NurbsCurve':\n\t\t\t\t\t\tmodel = createCurve( relationships, geometryMap );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'LimbNode': // usually associated with a Bone, however if a Bone was not created we'll make a Group instead\n\t\t\t\t\tcase 'Null':\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tmodel = new THREE.Group();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tmodel.name = THREE.PropertyBinding.sanitizeNodeName( node.attrName );\n\t\t\t\tmodel.ID = id;\n\n\t\t\t}\n\n\t\t\tsetModelTransforms( FBXTree, model, node );\n\t\t\tmodelMap.set( id, model );\n\n\t\t}\n\n\t\treturn modelMap;\n\n\t}\n\n\tfunction buildSkeleton( relationships, skeletons, id, name ) {\n\n\t\tvar bone = null;\n\n\t\trelationships.parents.forEach( function ( parent ) {\n\n\t\t\tfor ( var ID in skeletons ) {\n\n\t\t\t\tvar skeleton = skeletons[ ID ];\n\n\t\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\n\n\t\t\t\t\tif ( rawBone.ID === parent.ID ) {\n\n\t\t\t\t\t\tvar subBone = bone;\n\t\t\t\t\t\tbone = new THREE.Bone();\n\t\t\t\t\t\tbone.matrixWorld.copy( rawBone.transformLink );\n\n\t\t\t\t\t\t// set name and id here - otherwise in cases where \"subBone\" is created it will not have a name / id\n\t\t\t\t\t\tbone.name = THREE.PropertyBinding.sanitizeNodeName( name );\n\t\t\t\t\t\tbone.ID = id;\n\n\t\t\t\t\t\tskeleton.bones[ i ] = bone;\n\n\t\t\t\t\t\t// In cases where a bone is shared between multiple meshes\n\t\t\t\t\t\t// duplicate the bone here and and it as a child of the first bone\n\t\t\t\t\t\tif ( subBone !== null ) {\n\n\t\t\t\t\t\t\tbone.add( subBone );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn bone;\n\n\t}\n\n\t// create a THREE.PerspectiveCamera or THREE.OrthographicCamera\n\tfunction createCamera( FBXTree, relationships ) {\n\n\t\tvar model;\n\t\tvar cameraAttribute;\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tvar attr = FBXTree.Objects.NodeAttribute[ child.ID ];\n\n\t\t\tif ( attr !== undefined ) {\n\n\t\t\t\tcameraAttribute = attr;\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( cameraAttribute === undefined ) {\n\n\t\t\tmodel = new THREE.Object3D();\n\n\t\t} else {\n\n\t\t\tvar type = 0;\n\t\t\tif ( cameraAttribute.CameraProjectionType !== undefined && cameraAttribute.CameraProjectionType.value === 1 ) {\n\n\t\t\t\ttype = 1;\n\n\t\t\t}\n\n\t\t\tvar nearClippingPlane = 1;\n\t\t\tif ( cameraAttribute.NearPlane !== undefined ) {\n\n\t\t\t\tnearClippingPlane = cameraAttribute.NearPlane.value / 1000;\n\n\t\t\t}\n\n\t\t\tvar farClippingPlane = 1000;\n\t\t\tif ( cameraAttribute.FarPlane !== undefined ) {\n\n\t\t\t\tfarClippingPlane = cameraAttribute.FarPlane.value / 1000;\n\n\t\t\t}\n\n\n\t\t\tvar width = window.innerWidth;\n\t\t\tvar height = window.innerHeight;\n\n\t\t\tif ( cameraAttribute.AspectWidth !== undefined && cameraAttribute.AspectHeight !== undefined ) {\n\n\t\t\t\twidth = cameraAttribute.AspectWidth.value;\n\t\t\t\theight = cameraAttribute.AspectHeight.value;\n\n\t\t\t}\n\n\t\t\tvar aspect = width / height;\n\n\t\t\tvar fov = 45;\n\t\t\tif ( cameraAttribute.FieldOfView !== undefined ) {\n\n\t\t\t\tfov = cameraAttribute.FieldOfView.value;\n\n\t\t\t}\n\n\t\t\tvar focalLength = cameraAttribute.FocalLength ? cameraAttribute.FocalLength.value : null;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 0: // Perspective\n\t\t\t\t\tmodel = new THREE.PerspectiveCamera( fov, aspect, nearClippingPlane, farClippingPlane );\n\t\t\t\t\tif ( focalLength !== null ) model.setFocalLength( focalLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1: // Orthographic\n\t\t\t\t\tmodel = new THREE.OrthographicCamera( - width / 2, width / 2, height / 2, - height / 2, nearClippingPlane, farClippingPlane );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown camera type ' + type + '.' );\n\t\t\t\t\tmodel = new THREE.Object3D();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\t// Create a THREE.DirectionalLight, THREE.PointLight or THREE.SpotLight\n\tfunction createLight( FBXTree, relationships ) {\n\n\t\tvar model;\n\t\tvar lightAttribute;\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tvar attr = FBXTree.Objects.NodeAttribute[ child.ID ];\n\n\t\t\tif ( attr !== undefined ) {\n\n\t\t\t\tlightAttribute = attr;\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( lightAttribute === undefined ) {\n\n\t\t\tmodel = new THREE.Object3D();\n\n\t\t} else {\n\n\t\t\tvar type;\n\n\t\t\t// LightType can be undefined for Point lights\n\t\t\tif ( lightAttribute.LightType === undefined ) {\n\n\t\t\t\ttype = 0;\n\n\t\t\t} else {\n\n\t\t\t\ttype = lightAttribute.LightType.value;\n\n\t\t\t}\n\n\t\t\tvar color = 0xffffff;\n\n\t\t\tif ( lightAttribute.Color !== undefined ) {\n\n\t\t\t\tcolor = new THREE.Color().fromArray( lightAttribute.Color.value );\n\n\t\t\t}\n\n\t\t\tvar intensity = ( lightAttribute.Intensity === undefined ) ? 1 : lightAttribute.Intensity.value / 100;\n\n\t\t\t// light disabled\n\t\t\tif ( lightAttribute.CastLightOnObject !== undefined && lightAttribute.CastLightOnObject.value === 0 ) {\n\n\t\t\t\tintensity = 0;\n\n\t\t\t}\n\n\t\t\tvar distance = 0;\n\t\t\tif ( lightAttribute.FarAttenuationEnd !== undefined ) {\n\n\t\t\t\tif ( lightAttribute.EnableFarAttenuation !== undefined && lightAttribute.EnableFarAttenuation.value === 0 ) {\n\n\t\t\t\t\tdistance = 0;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdistance = lightAttribute.FarAttenuationEnd.value;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// TODO: could this be calculated linearly from FarAttenuationStart to FarAttenuationEnd?\n\t\t\tvar decay = 1;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 0: // Point\n\t\t\t\t\tmodel = new THREE.PointLight( color, intensity, distance, decay );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1: // Directional\n\t\t\t\t\tmodel = new THREE.DirectionalLight( color, intensity );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2: // Spot\n\t\t\t\t\tvar angle = Math.PI / 3;\n\n\t\t\t\t\tif ( lightAttribute.InnerAngle !== undefined ) {\n\n\t\t\t\t\t\tangle = THREE.Math.degToRad( lightAttribute.InnerAngle.value );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tvar penumbra = 0;\n\t\t\t\t\tif ( lightAttribute.OuterAngle !== undefined ) {\n\n\t\t\t\t\t\t// TODO: this is not correct - FBX calculates outer and inner angle in degrees\n\t\t\t\t\t\t// with OuterAngle > InnerAngle && OuterAngle <= Math.PI\n\t\t\t\t\t\t// while three.js uses a penumbra between (0, 1) to attenuate the inner angle\n\t\t\t\t\t\tpenumbra = THREE.Math.degToRad( lightAttribute.OuterAngle.value );\n\t\t\t\t\t\tpenumbra = Math.max( penumbra, 1 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tmodel = new THREE.SpotLight( color, intensity, distance, angle, penumbra, decay );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown light type ' + lightAttribute.LightType.value + ', defaulting to a THREE.PointLight.' );\n\t\t\t\t\tmodel = new THREE.PointLight( color, intensity );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( lightAttribute.CastShadows !== undefined && lightAttribute.CastShadows.value === 1 ) {\n\n\t\t\t\tmodel.castShadow = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\tfunction createMesh( FBXTree, relationships, geometryMap, materialMap ) {\n\n\t\tvar model;\n\t\tvar geometry = null;\n\t\tvar material = null;\n\t\tvar materials = [];\n\n\t\t// get geometry and materials(s) from connections\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tif ( geometryMap.has( child.ID ) ) {\n\n\t\t\t\tgeometry = geometryMap.get( child.ID );\n\n\t\t\t}\n\n\t\t\tif ( materialMap.has( child.ID ) ) {\n\n\t\t\t\tmaterials.push( materialMap.get( child.ID ) );\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( materials.length > 1 ) {\n\n\t\t\tmaterial = materials;\n\n\t\t} else if ( materials.length > 0 ) {\n\n\t\t\tmaterial = materials[ 0 ];\n\n\t\t} else {\n\n\t\t\tmaterial = new THREE.MeshPhongMaterial( { color: 0xcccccc } );\n\t\t\tmaterials.push( material );\n\n\t\t}\n\n\t\tif ( 'color' in geometry.attributes ) {\n\n\t\t\tmaterials.forEach( function ( material ) {\n\n\t\t\t\tmaterial.vertexColors = THREE.VertexColors;\n\n\t\t\t} );\n\n\t\t}\n\n\t\tif ( geometry.FBX_Deformer ) {\n\n\t\t\tmaterials.forEach( function ( material ) {\n\n\t\t\t\tmaterial.skinning = true;\n\n\t\t\t} );\n\n\t\t\tmodel = new THREE.SkinnedMesh( geometry, material );\n\n\t\t} else {\n\n\t\t\tmodel = new THREE.Mesh( geometry, material );\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\tfunction createCurve( relationships, geometryMap ) {\n\n\t\tvar geometry = relationships.children.reduce( function ( geo, child ) {\n\n\t\t\tif ( geometryMap.has( child.ID ) ) geo = geometryMap.get( child.ID );\n\n\t\t\treturn geo;\n\n\t\t}, null );\n\n\t\t// FBX does not list materials for Nurbs lines, so we'll just put our own in here.\n\t\tvar material = new THREE.LineBasicMaterial( { color: 0x3300ff, linewidth: 1 } );\n\t\treturn new THREE.Line( geometry, material );\n\n\t}\n\n\t// Parse ambient color in FBXTree.GlobalSettings - if it's not set to black (default), create an ambient light\n\tfunction createAmbientLight( FBXTree, sceneGraph ) {\n\n\t\tif ( 'GlobalSettings' in FBXTree && 'AmbientColor' in FBXTree.GlobalSettings ) {\n\n\t\t\tvar ambientColor = FBXTree.GlobalSettings.AmbientColor.value;\n\t\t\tvar r = ambientColor[ 0 ];\n\t\t\tvar g = ambientColor[ 1 ];\n\t\t\tvar b = ambientColor[ 2 ];\n\n\t\t\tif ( r !== 0 || g !== 0 || b !== 0 ) {\n\n\t\t\t\tvar color = new THREE.Color( r, g, b );\n\t\t\t\tsceneGraph.add( new THREE.AmbientLight( color, 1 ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction setLookAtProperties( FBXTree, model, modelNode, connections, sceneGraph ) {\n\n\t\tif ( 'LookAtProperty' in modelNode ) {\n\n\t\t\tvar children = connections.get( model.ID ).children;\n\n\t\t\tchildren.forEach( function ( child ) {\n\n\t\t\t\tif ( child.relationship === 'LookAtProperty' ) {\n\n\t\t\t\t\tvar lookAtTarget = FBXTree.Objects.Model[ child.ID ];\n\n\t\t\t\t\tif ( 'Lcl_Translation' in lookAtTarget ) {\n\n\t\t\t\t\t\tvar pos = lookAtTarget.Lcl_Translation.value;\n\n\t\t\t\t\t\t// DirectionalLight, SpotLight\n\t\t\t\t\t\tif ( model.target !== undefined ) {\n\n\t\t\t\t\t\t\tmodel.target.position.fromArray( pos );\n\t\t\t\t\t\t\tsceneGraph.add( model.target );\n\n\t\t\t\t\t\t} else { // Cameras and other Object3Ds\n\n\t\t\t\t\t\t\tmodel.lookAt( new THREE.Vector3().fromArray( pos ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\t// parse the model node for transform details and apply them to the model\n\tfunction setModelTransforms( FBXTree, model, modelNode ) {\n\n\t\t// http://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_class_fbx_euler_html\n\t\tif ( 'RotationOrder' in modelNode ) {\n\n\t\t\tvar enums = [\n\t\t\t\t'XYZ', // default\n\t\t\t\t'XZY',\n\t\t\t\t'YZX',\n\t\t\t\t'ZXY',\n\t\t\t\t'YXZ',\n\t\t\t\t'ZYX',\n\t\t\t\t'SphericXYZ',\n\t\t\t];\n\n\t\t\tvar value = parseInt( modelNode.RotationOrder.value, 10 );\n\n\t\t\tif ( value > 0 && value < 6 ) {\n\n\t\t\t\t// model.rotation.order = enums[ value ];\n\n\t\t\t\t// Note: Euler order other than XYZ is currently not supported, so just display a warning for now\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.', enums[ value ] );\n\n\t\t\t} else if ( value === 6 ) {\n\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.' );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( 'Lcl_Translation' in modelNode ) {\n\n\t\t\tmodel.position.fromArray( modelNode.Lcl_Translation.value );\n\n\t\t}\n\n\t\tif ( 'Lcl_Rotation' in modelNode ) {\n\n\t\t\tvar rotation = modelNode.Lcl_Rotation.value.map( THREE.Math.degToRad );\n\t\t\trotation.push( 'ZYX' );\n\t\t\tmodel.quaternion.setFromEuler( new THREE.Euler().fromArray( rotation ) );\n\n\t\t}\n\n\t\tif ( 'Lcl_Scaling' in modelNode ) {\n\n\t\t\tmodel.scale.fromArray( modelNode.Lcl_Scaling.value );\n\n\t\t}\n\n\t\tif ( 'PreRotation' in modelNode ) {\n\n\t\t\tvar array = modelNode.PreRotation.value.map( THREE.Math.degToRad );\n\t\t\tarray[ 3 ] = 'ZYX';\n\n\t\t\tvar preRotations = new THREE.Euler().fromArray( array );\n\n\t\t\tpreRotations = new THREE.Quaternion().setFromEuler( preRotations );\n\t\t\tmodel.quaternion.premultiply( preRotations );\n\n\t\t}\n\n\t}\n\n\tfunction bindSkeleton( FBXTree, skeletons, geometryMap, modelMap, connections ) {\n\n\t\tvar bindMatrices = parsePoseNodes( FBXTree );\n\n\t\tfor ( var ID in skeletons ) {\n\n\t\t\tvar skeleton = skeletons[ ID ];\n\n\t\t\tvar parents = connections.get( parseInt( skeleton.ID ) ).parents;\n\n\t\t\tparents.forEach( function ( parent ) {\n\n\t\t\t\tif ( geometryMap.has( parent.ID ) ) {\n\n\t\t\t\t\tvar geoID = parent.ID;\n\t\t\t\t\tvar geoRelationships = connections.get( geoID );\n\n\t\t\t\t\tgeoRelationships.parents.forEach( function ( geoConnParent ) {\n\n\t\t\t\t\t\tif ( modelMap.has( geoConnParent.ID ) ) {\n\n\t\t\t\t\t\t\tvar model = modelMap.get( geoConnParent.ID );\n\n\t\t\t\t\t\t\tmodel.bind( new THREE.Skeleton( skeleton.bones ), bindMatrices[ geoConnParent.ID ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\tfunction parsePoseNodes( FBXTree ) {\n\n\t\tvar bindMatrices = {};\n\n\t\tif ( 'Pose' in FBXTree.Objects ) {\n\n\t\t\tvar BindPoseNode = FBXTree.Objects.Pose;\n\n\t\t\tfor ( var nodeID in BindPoseNode ) {\n\n\t\t\t\tif ( BindPoseNode[ nodeID ].attrType === 'BindPose' ) {\n\n\t\t\t\t\tvar poseNodes = BindPoseNode[ nodeID ].PoseNode;\n\n\t\t\t\t\tif ( Array.isArray( poseNodes ) ) {\n\n\t\t\t\t\t\tposeNodes.forEach( function ( poseNode ) {\n\n\t\t\t\t\t\t\tbindMatrices[ poseNode.Node ] = new THREE.Matrix4().fromArray( poseNode.Matrix.a );\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tbindMatrices[ poseNodes.Node ] = new THREE.Matrix4().fromArray( poseNodes.Matrix.a );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn bindMatrices;\n\n\t}\n\n\tfunction parseAnimations( FBXTree, connections ) {\n\n\t\t// since the actual transformation data is stored in FBXTree.Objects.AnimationCurve,\n\t\t// if this is undefined we can safely assume there are no animations\n\t\tif ( FBXTree.Objects.AnimationCurve === undefined ) return undefined;\n\n\t\tvar curveNodesMap = parseAnimationCurveNodes( FBXTree );\n\n\t\tparseAnimationCurves( FBXTree, connections, curveNodesMap );\n\n\t\tvar layersMap = parseAnimationLayers( FBXTree, connections, curveNodesMap );\n\t\tvar rawClips = parseAnimStacks( FBXTree, connections, layersMap );\n\n\t\treturn rawClips;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationCurveNode\n\t// each AnimationCurveNode holds data for an animation transform for a model (e.g. left arm rotation )\n\t// and is referenced by an AnimationLayer\n\tfunction parseAnimationCurveNodes( FBXTree ) {\n\n\t\tvar rawCurveNodes = FBXTree.Objects.AnimationCurveNode;\n\n\t\tvar curveNodesMap = new Map();\n\n\t\tfor ( var nodeID in rawCurveNodes ) {\n\n\t\t\tvar rawCurveNode = rawCurveNodes[ nodeID ];\n\n\t\t\tif ( rawCurveNode.attrName.match( /S|R|T/ ) !== null ) {\n\n\t\t\t\tvar curveNode = {\n\n\t\t\t\t\tid: rawCurveNode.id,\n\t\t\t\t\tattr: rawCurveNode.attrName,\n\t\t\t\t\tcurves: {},\n\n\t\t\t\t};\n\n\t\t\t\tcurveNodesMap.set( curveNode.id, curveNode );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn curveNodesMap;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationCurve and connect them up to\n\t// previously parsed AnimationCurveNodes. Each AnimationCurve holds data for a single animated\n\t// axis ( e.g. times and values of x rotation)\n\tfunction parseAnimationCurves( FBXTree, connections, curveNodesMap ) {\n\n\t\tvar rawCurves = FBXTree.Objects.AnimationCurve;\n\n\t\tfor ( var nodeID in rawCurves ) {\n\n\t\t\tvar animationCurve = {\n\n\t\t\t\tid: rawCurves[ nodeID ].id,\n\t\t\t\ttimes: rawCurves[ nodeID ].KeyTime.a.map( convertFBXTimeToSeconds ),\n\t\t\t\tvalues: rawCurves[ nodeID ].KeyValueFloat.a,\n\n\t\t\t};\n\n\t\t\tvar relationships = connections.get( animationCurve.id );\n\n\t\t\tif ( relationships !== undefined ) {\n\n\t\t\t\tvar animationCurveID = relationships.parents[ 0 ].ID;\n\t\t\t\tvar animationCurveRelationship = relationships.parents[ 0 ].relationship;\n\n\t\t\t\tif ( animationCurveRelationship.match( /X/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'x' ] = animationCurve;\n\n\t\t\t\t} else if ( animationCurveRelationship.match( /Y/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'y' ] = animationCurve;\n\n\t\t\t\t} else if ( animationCurveRelationship.match( /Z/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'z' ] = animationCurve;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationLayer. Each layers holds references\n\t// to various AnimationCurveNodes and is referenced by an AnimationStack node\n\t// note: theoretically a stack can have multiple layers, however in practice there always seems to be one per stack\n\tfunction parseAnimationLayers( FBXTree, connections, curveNodesMap ) {\n\n\t\tvar rawLayers = FBXTree.Objects.AnimationLayer;\n\n\t\tvar layersMap = new Map();\n\n\t\tfor ( var nodeID in rawLayers ) {\n\n\t\t\tvar layerCurveNodes = [];\n\n\t\t\tvar connection = connections.get( parseInt( nodeID ) );\n\n\t\t\tif ( connection !== undefined ) {\n\n\t\t\t\t// all the animationCurveNodes used in the layer\n\t\t\t\tvar children = connection.children;\n\n\t\t\t\tchildren.forEach( function ( child, i ) {\n\n\t\t\t\t\tif ( curveNodesMap.has( child.ID ) ) {\n\n\t\t\t\t\t\tvar curveNode = curveNodesMap.get( child.ID );\n\n\t\t\t\t\t\t// check that the curves are defined for at least one axis, otherwise ignore the curveNode\n\t\t\t\t\t\tif ( curveNode.curves.x !== undefined || curveNode.curves.y !== undefined || curveNode.curves.z !== undefined ) {\n\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\n\n\t\t\t\t\t\t\t\tvar modelID;\n\n\t\t\t\t\t\t\t\tconnections.get( child.ID ).parents.forEach( function ( parent ) {\n\n\t\t\t\t\t\t\t\t\tif ( parent.relationship !== undefined ) modelID = parent.ID;\n\n\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\tvar rawModel = FBXTree.Objects.Model[ modelID.toString() ];\n\n\t\t\t\t\t\t\t\tvar node = {\n\n\t\t\t\t\t\t\t\t\tmodelName: THREE.PropertyBinding.sanitizeNodeName( rawModel.attrName ),\n\t\t\t\t\t\t\t\t\tinitialPosition: [ 0, 0, 0 ],\n\t\t\t\t\t\t\t\t\tinitialRotation: [ 0, 0, 0 ],\n\t\t\t\t\t\t\t\t\tinitialScale: [ 1, 1, 1 ],\n\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif ( 'Lcl_Translation' in rawModel ) node.initialPosition = rawModel.Lcl_Translation.value;\n\n\t\t\t\t\t\t\t\tif ( 'Lcl_Rotation' in rawModel ) node.initialRotation = rawModel.Lcl_Rotation.value;\n\n\t\t\t\t\t\t\t\tif ( 'Lcl_Scaling' in rawModel ) node.initialScale = rawModel.Lcl_Scaling.value;\n\n\t\t\t\t\t\t\t\t// if the animated model is pre rotated, we'll have to apply the pre rotations to every\n\t\t\t\t\t\t\t\t// animation value as well\n\t\t\t\t\t\t\t\tif ( 'PreRotation' in rawModel ) node.preRotations = rawModel.PreRotation.value;\n\n\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlayerCurveNodes[ i ][ curveNode.attr ] = curveNode;\n\n\t\t\t\t\t\t}\n\n\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tlayersMap.set( parseInt( nodeID ), layerCurveNodes );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn layersMap;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationStack. These are the top level node in the animation\n\t// hierarchy. Each Stack node will be used to create a THREE.AnimationClip\n\tfunction parseAnimStacks( FBXTree, connections, layersMap ) {\n\n\t\tvar rawStacks = FBXTree.Objects.AnimationStack;\n\n\t\t// connect the stacks (clips) up to the layers\n\t\tvar rawClips = {};\n\n\t\tfor ( var nodeID in rawStacks ) {\n\n\t\t\tvar children = connections.get( parseInt( nodeID ) ).children;\n\n\t\t\tif ( children.length > 1 ) {\n\n\t\t\t\t// it seems like stacks will always be associated with a single layer. But just in case there are files\n\t\t\t\t// where there are multiple layers per stack, we'll display a warning\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.' );\n\n\t\t\t}\n\n\t\t\tvar layer = layersMap.get( children[ 0 ].ID );\n\n\t\t\trawClips[ nodeID ] = {\n\n\t\t\t\tname: rawStacks[ nodeID ].attrName,\n\t\t\t\tlayer: layer,\n\n\t\t\t};\n\n\t\t}\n\n\t\treturn rawClips;\n\n\t}\n\n\t// take raw animation data from parseAnimations and connect it up to the loaded models\n\tfunction addAnimations( FBXTree, connections, sceneGraph ) {\n\n\t\tsceneGraph.animations = [];\n\n\t\tvar rawClips = parseAnimations( FBXTree, connections );\n\n\t\tif ( rawClips === undefined ) return;\n\n\n\t\tfor ( var key in rawClips ) {\n\n\t\t\tvar rawClip = rawClips[ key ];\n\n\t\t\tvar clip = addClip( rawClip );\n\n\t\t\tsceneGraph.animations.push( clip );\n\n\t\t}\n\n\t}\n\n\tfunction addClip( rawClip ) {\n\n\t\tvar tracks = [];\n\n\t\trawClip.layer.forEach( function ( rawTracks ) {\n\n\t\t\ttracks = tracks.concat( generateTracks( rawTracks ) );\n\n\t\t} );\n\n\t\treturn new THREE.AnimationClip( rawClip.name, - 1, tracks );\n\n\t}\n\n\tfunction generateTracks( rawTracks ) {\n\n\t\tvar tracks = [];\n\n\t\tif ( rawTracks.T !== undefined && Object.keys( rawTracks.T.curves ).length > 0 ) {\n\n\t\t\tvar positionTrack = generateVectorTrack( rawTracks.modelName, rawTracks.T.curves, rawTracks.initialPosition, 'position' );\n\t\t\tif ( positionTrack !== undefined ) tracks.push( positionTrack );\n\n\t\t}\n\n\t\tif ( rawTracks.R !== undefined && Object.keys( rawTracks.R.curves ).length > 0 ) {\n\n\t\t\tvar rotationTrack = generateRotationTrack( rawTracks.modelName, rawTracks.R.curves, rawTracks.initialRotation, rawTracks.preRotations );\n\t\t\tif ( rotationTrack !== undefined ) tracks.push( rotationTrack );\n\n\t\t}\n\n\t\tif ( rawTracks.S !== undefined && Object.keys( rawTracks.S.curves ).length > 0 ) {\n\n\t\t\tvar scaleTrack = generateVectorTrack( rawTracks.modelName, rawTracks.S.curves, rawTracks.initialScale, 'scale' );\n\t\t\tif ( scaleTrack !== undefined ) tracks.push( scaleTrack );\n\n\t\t}\n\n\t\treturn tracks;\n\n\t}\n\n\tfunction generateVectorTrack( modelName, curves, initialValue, type ) {\n\n\t\tvar times = getTimesForAllAxes( curves );\n\t\tvar values = getKeyframeTrackValues( times, curves, initialValue );\n\n\t\treturn new THREE.VectorKeyframeTrack( modelName + '.' + type, times, values );\n\n\t}\n\n\tfunction generateRotationTrack( modelName, curves, initialValue, preRotations ) {\n\n\t\tif ( curves.x !== undefined ) {\n\n\t\t\tinterpolateRotations( curves.x );\n\t\t\tcurves.x.values = curves.x.values.map( THREE.Math.degToRad );\n\n\t\t}\n\t\tif ( curves.y !== undefined ) {\n\n\t\t\tinterpolateRotations( curves.y );\n\t\t\tcurves.y.values = curves.y.values.map( THREE.Math.degToRad );\n\n\t\t}\n\t\tif ( curves.z !== undefined ) {\n\n\t\t\tinterpolateRotations( curves.z );\n\t\t\tcurves.z.values = curves.z.values.map( THREE.Math.degToRad );\n\n\t\t}\n\n\t\tvar times = getTimesForAllAxes( curves );\n\t\tvar values = getKeyframeTrackValues( times, curves, initialValue );\n\n\t\tif ( preRotations !== undefined ) {\n\n\t\t\tpreRotations = preRotations.map( THREE.Math.degToRad );\n\t\t\tpreRotations.push( 'ZYX' );\n\n\t\t\tpreRotations = new THREE.Euler().fromArray( preRotations );\n\t\t\tpreRotations = new THREE.Quaternion().setFromEuler( preRotations );\n\n\t\t}\n\n\t\tvar quaternion = new THREE.Quaternion();\n\t\tvar euler = new THREE.Euler();\n\n\t\tvar quaternionValues = [];\n\n\t\tfor ( var i = 0; i < values.length; i += 3 ) {\n\n\t\t\teuler.set( values[ i ], values[ i + 1 ], values[ i + 2 ], 'ZYX' );\n\n\t\t\tquaternion.setFromEuler( euler );\n\n\t\t\tif ( preRotations !== undefined )quaternion.premultiply( preRotations );\n\n\t\t\tquaternion.toArray( quaternionValues, ( i / 3 ) * 4 );\n\n\t\t}\n\n\t\treturn new THREE.QuaternionKeyframeTrack( modelName + '.quaternion', times, quaternionValues );\n\n\t}\n\n\tfunction getKeyframeTrackValues( times, curves, initialValue ) {\n\n\t\tvar prevValue = initialValue;\n\n\t\tvar values = [];\n\n\t\tvar xIndex = - 1;\n\t\tvar yIndex = - 1;\n\t\tvar zIndex = - 1;\n\n\t\ttimes.forEach( function ( time ) {\n\n\t\t\tif ( curves.x ) xIndex = curves.x.times.indexOf( time );\n\t\t\tif ( curves.y ) yIndex = curves.y.times.indexOf( time );\n\t\t\tif ( curves.z ) zIndex = curves.z.times.indexOf( time );\n\n\t\t\t// if there is an x value defined for this frame, use that\n\t\t\tif ( xIndex !== - 1 ) {\n\n\t\t\t\tvar xValue = curves.x.values[ xIndex ];\n\t\t\t\tvalues.push( xValue );\n\t\t\t\tprevValue[ 0 ] = xValue;\n\n\t\t\t} else {\n\n\t\t\t\t// otherwise use the x value from the previous frame\n\t\t\t\tvalues.push( prevValue[ 0 ] );\n\n\t\t\t}\n\n\t\t\tif ( yIndex !== - 1 ) {\n\n\t\t\t\tvar yValue = curves.y.values[ yIndex ];\n\t\t\t\tvalues.push( yValue );\n\t\t\t\tprevValue[ 1 ] = yValue;\n\n\t\t\t} else {\n\n\t\t\t\tvalues.push( prevValue[ 1 ] );\n\n\t\t\t}\n\n\t\t\tif ( zIndex !== - 1 ) {\n\n\t\t\t\tvar zValue = curves.z.values[ zIndex ];\n\t\t\t\tvalues.push( zValue );\n\t\t\t\tprevValue[ 2 ] = zValue;\n\n\t\t\t} else {\n\n\t\t\t\tvalues.push( prevValue[ 2 ] );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn values;\n\n\t}\n\n\t// For all animated objects, times are defined separately for each axis\n\t// Here we'll combine the times into one sorted array without duplicates\n\tfunction getTimesForAllAxes( curves ) {\n\n\t\tvar times = [];\n\n\t\t// first join together the times for each axis, if defined\n\t\tif ( curves.x !== undefined ) times = times.concat( curves.x.times );\n\t\tif ( curves.y !== undefined ) times = times.concat( curves.y.times );\n\t\tif ( curves.z !== undefined ) times = times.concat( curves.z.times );\n\n\t\t// then sort them and remove duplicates\n\t\ttimes = times.sort( function ( a, b ) {\n\n\t\t\treturn a - b;\n\n\t\t} ).filter( function ( elem, index, array ) {\n\n\t\t\treturn array.indexOf( elem ) == index;\n\n\t\t} );\n\n\t\treturn times;\n\n\t}\n\n\t// Rotations are defined as Euler angles which can have values  of any size\n\t// These will be converted to quaternions which don't support values greater than\n\t// PI, so we'll interpolate large rotations\n\tfunction interpolateRotations( curve ) {\n\n\t\tfor ( var i = 1; i < curve.values.length; i ++ ) {\n\n\t\t\tvar initialValue = curve.values[ i - 1 ];\n\t\t\tvar valuesSpan = curve.values[ i ] - initialValue;\n\n\t\t\tvar absoluteSpan = Math.abs( valuesSpan );\n\n\t\t\tif ( absoluteSpan >= 180 ) {\n\n\t\t\t\tvar numSubIntervals = absoluteSpan / 180;\n\n\t\t\t\tvar step = valuesSpan / numSubIntervals;\n\t\t\t\tvar nextValue = initialValue + step;\n\n\t\t\t\tvar initialTime = curve.times[ i - 1 ];\n\t\t\t\tvar timeSpan = curve.times[ i ] - initialTime;\n\t\t\t\tvar interval = timeSpan / numSubIntervals;\n\t\t\t\tvar nextTime = initialTime + interval;\n\n\t\t\t\tvar interpolatedTimes = [];\n\t\t\t\tvar interpolatedValues = [];\n\n\t\t\t\twhile ( nextTime < curve.times[ i ] ) {\n\n\t\t\t\t\tinterpolatedTimes.push( nextTime );\n\t\t\t\t\tnextTime += interval;\n\n\t\t\t\t\tinterpolatedValues.push( nextValue );\n\t\t\t\t\tnextValue += step;\n\n\t\t\t\t}\n\n\t\t\t\tcurve.times = inject( curve.times, i, interpolatedTimes );\n\t\t\t\tcurve.values = inject( curve.values, i, interpolatedValues );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t// parse an FBX file in ASCII format\n\tfunction TextParser() {}\n\n\tObject.assign( TextParser.prototype, {\n\n\t\tgetPrevNode: function () {\n\n\t\t\treturn this.nodeStack[ this.currentIndent - 2 ];\n\n\t\t},\n\n\t\tgetCurrentNode: function () {\n\n\t\t\treturn this.nodeStack[ this.currentIndent - 1 ];\n\n\t\t},\n\n\t\tgetCurrentProp: function () {\n\n\t\t\treturn this.currentProp;\n\n\t\t},\n\n\t\tpushStack: function ( node ) {\n\n\t\t\tthis.nodeStack.push( node );\n\t\t\tthis.currentIndent += 1;\n\n\t\t},\n\n\t\tpopStack: function () {\n\n\t\t\tthis.nodeStack.pop();\n\t\t\tthis.currentIndent -= 1;\n\n\t\t},\n\n\t\tsetCurrentProp: function ( val, name ) {\n\n\t\t\tthis.currentProp = val;\n\t\t\tthis.currentPropName = name;\n\n\t\t},\n\n\t\tparse: function ( text ) {\n\n\t\t\tthis.currentIndent = 0;\n\t\t\tthis.allNodes = new FBXTree();\n\t\t\tthis.nodeStack = [];\n\t\t\tthis.currentProp = [];\n\t\t\tthis.currentPropName = '';\n\n\t\t\tvar self = this;\n\n\t\t\tvar split = text.split( '\\n' );\n\n\t\t\tsplit.forEach( function ( line, i ) {\n\n\t\t\t\tvar matchComment = line.match( /^[\\s\\t]*;/ );\n\t\t\t\tvar matchEmpty = line.match( /^[\\s\\t]*$/ );\n\n\t\t\t\tif ( matchComment || matchEmpty ) return;\n\n\t\t\t\tvar matchBeginning = line.match( '^\\\\t{' + self.currentIndent + '}(\\\\w+):(.*){', '' );\n\t\t\t\tvar matchProperty = line.match( '^\\\\t{' + ( self.currentIndent ) + '}(\\\\w+):[\\\\s\\\\t\\\\r\\\\n](.*)' );\n\t\t\t\tvar matchEnd = line.match( '^\\\\t{' + ( self.currentIndent - 1 ) + '}}' );\n\n\t\t\t\tif ( matchBeginning ) {\n\n\t\t\t\t\tself.parseNodeBegin( line, matchBeginning );\n\n\t\t\t\t} else if ( matchProperty ) {\n\n\t\t\t\t\tself.parseNodeProperty( line, matchProperty, split[ ++ i ] );\n\n\t\t\t\t} else if ( matchEnd ) {\n\n\t\t\t\t\tself.popStack();\n\n\t\t\t\t} else if ( line.match( /^[^\\s\\t}]/ ) ) {\n\n\t\t\t\t\t// large arrays are split over multiple lines terminated with a ',' character\n\t\t\t\t\t// if this is encountered the line needs to be joined to the previous line\n\t\t\t\t\tself.parseNodePropertyContinued( line );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\treturn this.allNodes;\n\n\t\t},\n\n\t\tparseNodeBegin: function ( line, property ) {\n\n\t\t\tvar nodeName = property[ 1 ].trim().replace( /^\"/, '' ).replace( /\"$/, '' );\n\n\t\t\tvar nodeAttrs = property[ 2 ].split( ',' ).map( function ( attr ) {\n\n\t\t\t\treturn attr.trim().replace( /^\"/, '' ).replace( /\"$/, '' );\n\n\t\t\t} );\n\n\t\t\tvar node = { name: nodeName };\n\t\t\tvar attrs = this.parseNodeAttr( nodeAttrs );\n\n\t\t\tvar currentNode = this.getCurrentNode();\n\n\t\t\t// a top node\n\t\t\tif ( this.currentIndent === 0 ) {\n\n\t\t\t\tthis.allNodes.add( nodeName, node );\n\n\t\t\t} else { // a subnode\n\n\t\t\t\t// if the subnode already exists, append it\n\t\t\t\tif ( nodeName in currentNode ) {\n\n\t\t\t\t// special case Pose needs PoseNodes as an array\n\t\t\t\t\tif ( nodeName === 'PoseNode' ) {\n\n\t\t\t\t\t\tcurrentNode.PoseNode.push( node );\n\n\t\t\t\t\t} else if ( currentNode[ nodeName ].id !== undefined ) {\n\n\t\t\t\t\t\tcurrentNode[ nodeName ] = {};\n\t\t\t\t\t\tcurrentNode[ nodeName ][ currentNode[ nodeName ].id ] = currentNode[ nodeName ];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attrs.id !== '' ) currentNode[ nodeName ][ attrs.id ] = node;\n\n\t\t\t\t} else if ( typeof attrs.id === 'number' ) {\n\n\t\t\t\t\tcurrentNode[ nodeName ] = {};\n\t\t\t\t\tcurrentNode[ nodeName ][ attrs.id ] = node;\n\n\t\t\t\t} else if ( nodeName !== 'Properties70' ) {\n\n\t\t\t\t\tif ( nodeName === 'PoseNode' )\tcurrentNode[ nodeName ] = [ node ];\n\t\t\t\t\telse currentNode[ nodeName ] = node;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( typeof attrs.id === 'number' ) node.id = attrs.id;\n\t\t\tif ( attrs.name !== '' ) node.attrName = attrs.name;\n\t\t\tif ( attrs.type !== '' ) node.attrType = attrs.type;\n\n\t\t\tthis.pushStack( node );\n\n\t\t},\n\n\t\tparseNodeAttr: function ( attrs ) {\n\n\t\t\tvar id = attrs[ 0 ];\n\n\t\t\tif ( attrs[ 0 ] !== '' ) {\n\n\t\t\t\tid = parseInt( attrs[ 0 ] );\n\n\t\t\t\tif ( isNaN( id ) ) {\n\n\t\t\t\t\tid = attrs[ 0 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar name = '', type = '';\n\n\t\t\tif ( attrs.length > 1 ) {\n\n\t\t\t\tname = attrs[ 1 ].replace( /^(\\w+)::/, '' );\n\t\t\t\ttype = attrs[ 2 ];\n\n\t\t\t}\n\n\t\t\treturn { id: id, name: name, type: type };\n\n\t\t},\n\n\t\tparseNodeProperty: function ( line, property, contentLine ) {\n\n\t\t\tvar propName = property[ 1 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\n\t\t\tvar propValue = property[ 2 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\n\n\t\t\t// for special case: base64 image data follows \"Content: ,\" line\n\t\t\t//\tContent: ,\n\t\t\t//\t \"/9j/4RDaRXhpZgAATU0A...\"\n\t\t\tif ( propName === 'Content' && propValue === ',' ) {\n\n\t\t\t\tpropValue = contentLine.replace( /\"/g, '' ).replace( /,$/, '' ).trim();\n\n\t\t\t}\n\n\t\t\tvar currentNode = this.getCurrentNode();\n\t\t\tvar parentName = currentNode.name;\n\n\t\t\tif ( parentName === 'Properties70' ) {\n\n\t\t\t\tthis.parseNodeSpecialProperty( line, propName, propValue );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\t// Connections\n\t\t\tif ( propName === 'C' ) {\n\n\t\t\t\tvar connProps = propValue.split( ',' ).slice( 1 );\n\t\t\t\tvar from = parseInt( connProps[ 0 ] );\n\t\t\t\tvar to = parseInt( connProps[ 1 ] );\n\n\t\t\t\tvar rest = propValue.split( ',' ).slice( 3 );\n\n\t\t\t\trest = rest.map( function ( elem ) {\n\n\t\t\t\t\treturn elem.trim().replace( /^\"/, '' );\n\n\t\t\t\t} );\n\n\t\t\t\tpropName = 'connections';\n\t\t\t\tpropValue = [ from, to ];\n\t\t\t\tappend( propValue, rest );\n\n\t\t\t\tif ( currentNode[ propName ] === undefined ) {\n\n\t\t\t\t\tcurrentNode[ propName ] = [];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Node\n\t\t\tif ( propName === 'Node' ) currentNode.id = propValue;\n\n\t\t\t// connections\n\t\t\tif ( propName in currentNode && Array.isArray( currentNode[ propName ] ) ) {\n\n\t\t\t\tcurrentNode[ propName ].push( propValue );\n\n\t\t\t} else {\n\n\t\t\t\tif ( propName !== 'a' ) currentNode[ propName ] = propValue;\n\t\t\t\telse currentNode.a = propValue;\n\n\t\t\t}\n\n\t\t\tthis.setCurrentProp( currentNode, propName );\n\n\t\t\t// convert string to array, unless it ends in ',' in which case more will be added to it\n\t\t\tif ( propName === 'a' && propValue.slice( - 1 ) !== ',' ) {\n\n\t\t\t\tcurrentNode.a = parseNumberArray( propValue );\n\n\t\t\t}\n\n\t\t},\n\n\t\tparseNodePropertyContinued: function ( line ) {\n\n\t\t\tvar currentNode = this.getCurrentNode();\n\n\t\t\tcurrentNode.a += line;\n\n\t\t\t// if the line doesn't end in ',' we have reached the end of the property value\n\t\t\t// so convert the string to an array\n\t\t\tif ( line.slice( - 1 ) !== ',' ) {\n\n\t\t\t\tcurrentNode.a = parseNumberArray( currentNode.a );\n\n\t\t\t}\n\n\t\t},\n\n\t\t// parse \"Property70\"\n\t\tparseNodeSpecialProperty: function ( line, propName, propValue ) {\n\n\t\t\t// split this\n\t\t\t// P: \"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\",1,1,1\n\t\t\t// into array like below\n\t\t\t// [\"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\", \"1,1,1\" ]\n\t\t\tvar props = propValue.split( '\",' ).map( function ( prop ) {\n\n\t\t\t\treturn prop.trim().replace( /^\\\"/, '' ).replace( /\\s/, '_' );\n\n\t\t\t} );\n\n\t\t\tvar innerPropName = props[ 0 ];\n\t\t\tvar innerPropType1 = props[ 1 ];\n\t\t\tvar innerPropType2 = props[ 2 ];\n\t\t\tvar innerPropFlag = props[ 3 ];\n\t\t\tvar innerPropValue = props[ 4 ];\n\n\t\t\t// cast values where needed, otherwise leave as strings\n\t\t\tswitch ( innerPropType1 ) {\n\n\t\t\t\tcase 'int':\n\t\t\t\tcase 'enum':\n\t\t\t\tcase 'bool':\n\t\t\t\tcase 'ULongLong':\n\t\t\t\tcase 'double':\n\t\t\t\tcase 'Number':\n\t\t\t\tcase 'FieldOfView':\n\t\t\t\t\tinnerPropValue = parseFloat( innerPropValue );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'Color':\n\t\t\t\tcase 'ColorRGB':\n\t\t\t\tcase 'Vector3D':\n\t\t\t\tcase 'Lcl_Translation':\n\t\t\t\tcase 'Lcl_Rotation':\n\t\t\t\tcase 'Lcl_Scaling':\n\t\t\t\t\tinnerPropValue = parseNumberArray( innerPropValue );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\t// CAUTION: these props must append to parent's parent\n\t\t\tthis.getPrevNode()[ innerPropName ] = {\n\n\t\t\t\t'type': innerPropType1,\n\t\t\t\t'type2': innerPropType2,\n\t\t\t\t'flag': innerPropFlag,\n\t\t\t\t'value': innerPropValue\n\n\t\t\t};\n\n\t\t\tthis.setCurrentProp( this.getPrevNode(), innerPropName );\n\n\t\t},\n\n\t} );\n\n\t// Parse an FBX file in Binary format\n\tfunction BinaryParser() {}\n\n\tObject.assign( BinaryParser.prototype, {\n\n\t\tparse: function ( buffer ) {\n\n\t\t\tvar reader = new BinaryReader( buffer );\n\t\t\treader.skip( 23 ); // skip magic 23 bytes\n\n\t\t\tvar version = reader.getUint32();\n\n\t\t\tconsole.log( 'THREE.FBXLoader: FBX binary version: ' + version );\n\n\t\t\tvar allNodes = new FBXTree();\n\n\t\t\twhile ( ! this.endOfContent( reader ) ) {\n\n\t\t\t\tvar node = this.parseNode( reader, version );\n\t\t\t\tif ( node !== null ) allNodes.add( node.name, node );\n\n\t\t\t}\n\n\t\t\treturn allNodes;\n\n\t\t},\n\n\t\t// Check if reader has reached the end of content.\n\t\tendOfContent: function ( reader ) {\n\n\t\t\t// footer size: 160bytes + 16-byte alignment padding\n\t\t\t// - 16bytes: magic\n\t\t\t// - padding til 16-byte alignment (at least 1byte?)\n\t\t\t//\t(seems like some exporters embed fixed 15 or 16bytes?)\n\t\t\t// - 4bytes: magic\n\t\t\t// - 4bytes: version\n\t\t\t// - 120bytes: zero\n\t\t\t// - 16bytes: magic\n\t\t\tif ( reader.size() % 16 === 0 ) {\n\n\t\t\t\treturn ( ( reader.getOffset() + 160 + 16 ) & ~ 0xf ) >= reader.size();\n\n\t\t\t} else {\n\n\t\t\t\treturn reader.getOffset() + 160 + 16 >= reader.size();\n\n\t\t\t}\n\n\t\t},\n\n\t\t// recursively parse nodes until the end of the file is reached\n\t\tparseNode: function ( reader, version ) {\n\n\t\t\tvar node = {};\n\n\t\t\t// The first three data sizes depends on version.\n\t\t\tvar endOffset = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\n\t\t\tvar numProperties = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\n\n\t\t\t// note: do not remove this even if you get a linter warning as it moves the buffer forward\n\t\t\tvar propertyListLen = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\n\n\t\t\tvar nameLen = reader.getUint8();\n\t\t\tvar name = reader.getString( nameLen );\n\n\t\t\t// Regards this node as NULL-record if endOffset is zero\n\t\t\tif ( endOffset === 0 ) return null;\n\n\t\t\tvar propertyList = [];\n\n\t\t\tfor ( var i = 0; i < numProperties; i ++ ) {\n\n\t\t\t\tpropertyList.push( this.parseProperty( reader ) );\n\n\t\t\t}\n\n\t\t\t// Regards the first three elements in propertyList as id, attrName, and attrType\n\t\t\tvar id = propertyList.length > 0 ? propertyList[ 0 ] : '';\n\t\t\tvar attrName = propertyList.length > 1 ? propertyList[ 1 ] : '';\n\t\t\tvar attrType = propertyList.length > 2 ? propertyList[ 2 ] : '';\n\n\t\t\t// check if this node represents just a single property\n\t\t\t// like (name, 0) set or (name2, [0, 1, 2]) set of {name: 0, name2: [0, 1, 2]}\n\t\t\tnode.singleProperty = ( numProperties === 1 && reader.getOffset() === endOffset ) ? true : false;\n\n\t\t\twhile ( endOffset > reader.getOffset() ) {\n\n\t\t\t\tvar subNode = this.parseNode( reader, version );\n\n\t\t\t\tif ( subNode !== null ) this.parseSubNode( name, node, subNode );\n\n\t\t\t}\n\n\t\t\tnode.propertyList = propertyList; // raw property list used by parent\n\n\t\t\tif ( typeof id === 'number' ) node.id = id;\n\t\t\tif ( attrName !== '' ) node.attrName = attrName;\n\t\t\tif ( attrType !== '' ) node.attrType = attrType;\n\t\t\tif ( name !== '' ) node.name = name;\n\n\t\t\treturn node;\n\n\t\t},\n\n\t\tparseSubNode: function ( name, node, subNode ) {\n\n\t\t\t// special case: child node is single property\n\t\t\tif ( subNode.singleProperty === true ) {\n\n\t\t\t\tvar value = subNode.propertyList[ 0 ];\n\n\t\t\t\tif ( Array.isArray( value ) ) {\n\n\t\t\t\t\tnode[ subNode.name ] = subNode;\n\n\t\t\t\t\tsubNode.a = value;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnode[ subNode.name ] = value;\n\n\t\t\t\t}\n\n\t\t\t} else if ( name === 'Connections' && subNode.name === 'C' ) {\n\n\t\t\t\tvar array = [];\n\n\t\t\t\tsubNode.propertyList.forEach( function ( property, i ) {\n\n\t\t\t\t\t// first Connection is FBX type (OO, OP, etc.). We'll discard these\n\t\t\t\t\tif ( i !== 0 ) array.push( property );\n\n\t\t\t\t} );\n\n\t\t\t\tif ( node.connections === undefined ) {\n\n\t\t\t\t\tnode.connections = [];\n\n\t\t\t\t}\n\n\t\t\t\tnode.connections.push( array );\n\n\t\t\t} else if ( subNode.name === 'Properties70' ) {\n\n\t\t\t\tvar keys = Object.keys( subNode );\n\n\t\t\t\tkeys.forEach( function ( key ) {\n\n\t\t\t\t\tnode[ key ] = subNode[ key ];\n\n\t\t\t\t} );\n\n\t\t\t} else if ( name === 'Properties70' && subNode.name === 'P' ) {\n\n\t\t\t\tvar innerPropName = subNode.propertyList[ 0 ];\n\t\t\t\tvar innerPropType1 = subNode.propertyList[ 1 ];\n\t\t\t\tvar innerPropType2 = subNode.propertyList[ 2 ];\n\t\t\t\tvar innerPropFlag = subNode.propertyList[ 3 ];\n\t\t\t\tvar innerPropValue;\n\n\t\t\t\tif ( innerPropName.indexOf( 'Lcl ' ) === 0 ) innerPropName = innerPropName.replace( 'Lcl ', 'Lcl_' );\n\t\t\t\tif ( innerPropType1.indexOf( 'Lcl ' ) === 0 ) innerPropType1 = innerPropType1.replace( 'Lcl ', 'Lcl_' );\n\n\t\t\t\tif ( innerPropType1 === 'Color' || innerPropType1 === 'ColorRGB' || innerPropType1 === 'Vector' || innerPropType1 === 'Vector3D' || innerPropType1.indexOf( 'Lcl_' ) === 0 ) {\n\n\t\t\t\t\tinnerPropValue = [\n\t\t\t\t\t\tsubNode.propertyList[ 4 ],\n\t\t\t\t\t\tsubNode.propertyList[ 5 ],\n\t\t\t\t\t\tsubNode.propertyList[ 6 ]\n\t\t\t\t\t];\n\n\t\t\t\t} else {\n\n\t\t\t\t\tinnerPropValue = subNode.propertyList[ 4 ];\n\n\t\t\t\t}\n\n\t\t\t\t// this will be copied to parent, see above\n\t\t\t\tnode[ innerPropName ] = {\n\n\t\t\t\t\t'type': innerPropType1,\n\t\t\t\t\t'type2': innerPropType2,\n\t\t\t\t\t'flag': innerPropFlag,\n\t\t\t\t\t'value': innerPropValue\n\n\t\t\t\t};\n\n\t\t\t} else if ( node[ subNode.name ] === undefined ) {\n\n\t\t\t\tif ( typeof subNode.id === 'number' ) {\n\n\t\t\t\t\tnode[ subNode.name ] = {};\n\t\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnode[ subNode.name ] = subNode;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tif ( subNode.name === 'PoseNode' ) {\n\n\t\t\t\t\tif ( ! Array.isArray( node[ subNode.name ] ) ) {\n\n\t\t\t\t\t\tnode[ subNode.name ] = [ node[ subNode.name ] ];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tnode[ subNode.name ].push( subNode );\n\n\t\t\t\t} else if ( node[ subNode.name ][ subNode.id ] === undefined ) {\n\n\t\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t},\n\n\t\tparseProperty: function ( reader ) {\n\n\t\t\tvar type = reader.getString( 1 );\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'C':\n\t\t\t\t\treturn reader.getBoolean();\n\n\t\t\t\tcase 'D':\n\t\t\t\t\treturn reader.getFloat64();\n\n\t\t\t\tcase 'F':\n\t\t\t\t\treturn reader.getFloat32();\n\n\t\t\t\tcase 'I':\n\t\t\t\t\treturn reader.getInt32();\n\n\t\t\t\tcase 'L':\n\t\t\t\t\treturn reader.getInt64();\n\n\t\t\t\tcase 'R':\n\t\t\t\t\tvar length = reader.getUint32();\n\t\t\t\t\treturn reader.getArrayBuffer( length );\n\n\t\t\t\tcase 'S':\n\t\t\t\t\tvar length = reader.getUint32();\n\t\t\t\t\treturn reader.getString( length );\n\n\t\t\t\tcase 'Y':\n\t\t\t\t\treturn reader.getInt16();\n\n\t\t\t\tcase 'b':\n\t\t\t\tcase 'c':\n\t\t\t\tcase 'd':\n\t\t\t\tcase 'f':\n\t\t\t\tcase 'i':\n\t\t\t\tcase 'l':\n\n\t\t\t\t\tvar arrayLength = reader.getUint32();\n\t\t\t\t\tvar encoding = reader.getUint32(); // 0: non-compressed, 1: compressed\n\t\t\t\t\tvar compressedLength = reader.getUint32();\n\n\t\t\t\t\tif ( encoding === 0 ) {\n\n\t\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\t\tcase 'b':\n\t\t\t\t\t\t\tcase 'c':\n\t\t\t\t\t\t\t\treturn reader.getBooleanArray( arrayLength );\n\n\t\t\t\t\t\t\tcase 'd':\n\t\t\t\t\t\t\t\treturn reader.getFloat64Array( arrayLength );\n\n\t\t\t\t\t\t\tcase 'f':\n\t\t\t\t\t\t\t\treturn reader.getFloat32Array( arrayLength );\n\n\t\t\t\t\t\t\tcase 'i':\n\t\t\t\t\t\t\t\treturn reader.getInt32Array( arrayLength );\n\n\t\t\t\t\t\t\tcase 'l':\n\t\t\t\t\t\t\t\treturn reader.getInt64Array( arrayLength );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( window.Zlib === undefined ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tvar inflate = new Zlib.Inflate( new Uint8Array( reader.getArrayBuffer( compressedLength ) ) ); // eslint-disable-line no-undef\n\t\t\t\t\tvar reader2 = new BinaryReader( inflate.decompress().buffer );\n\n\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\tcase 'b':\n\t\t\t\t\t\tcase 'c':\n\t\t\t\t\t\t\treturn reader2.getBooleanArray( arrayLength );\n\n\t\t\t\t\t\tcase 'd':\n\t\t\t\t\t\t\treturn reader2.getFloat64Array( arrayLength );\n\n\t\t\t\t\t\tcase 'f':\n\t\t\t\t\t\t\treturn reader2.getFloat32Array( arrayLength );\n\n\t\t\t\t\t\tcase 'i':\n\t\t\t\t\t\t\treturn reader2.getInt32Array( arrayLength );\n\n\t\t\t\t\t\tcase 'l':\n\t\t\t\t\t\t\treturn reader2.getInt64Array( arrayLength );\n\n\t\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown property type ' + type );\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\n\tfunction BinaryReader( buffer, littleEndian ) {\n\n\t\tthis.dv = new DataView( buffer );\n\t\tthis.offset = 0;\n\t\tthis.littleEndian = ( littleEndian !== undefined ) ? littleEndian : true;\n\n\t}\n\n\tObject.assign( BinaryReader.prototype, {\n\n\t\tgetOffset: function () {\n\n\t\t\treturn this.offset;\n\n\t\t},\n\n\t\tsize: function () {\n\n\t\t\treturn this.dv.buffer.byteLength;\n\n\t\t},\n\n\t\tskip: function ( length ) {\n\n\t\t\tthis.offset += length;\n\n\t\t},\n\n\t\t// seems like true/false representation depends on exporter.\n\t\t// true: 1 or 'Y'(=0x59), false: 0 or 'T'(=0x54)\n\t\t// then sees LSB.\n\t\tgetBoolean: function () {\n\n\t\t\treturn ( this.getUint8() & 1 ) === 1;\n\n\t\t},\n\n\t\tgetBooleanArray: function ( size ) {\n\n\t\t\tvar a = [];\n\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\n\n\t\t\t\ta.push( this.getBoolean() );\n\n\t\t\t}\n\n\t\t\treturn a;\n\n\t\t},\n\n\t\tgetUint8: function () {\n\n\t\t\tvar value = this.dv.getUint8( this.offset );\n\t\t\tthis.offset += 1;\n\t\t\treturn value;\n\n\t\t},\n\n\t\tgetInt16: function () {\n\n\t\t\tvar value = this.dv.getInt16( this.offset, this.littleEndian );\n\t\t\tthis.offset += 2;\n\t\t\treturn value;\n\n\t\t},\n\n\t\tgetInt32: function () {\n\n\t\t\tvar value = this.dv.getInt32( this.offset, this.littleEndian );\n\t\t\tthis.offset += 4;\n\t\t\treturn value;\n\n\t\t},\n\n\t\tgetInt32Array: function ( size ) {\n\n\t\t\tvar a = [];\n\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\n\n\t\t\t\ta.push( this.getInt32() );\n\n\t\t\t}\n\n\t\t\treturn a;\n\n\t\t},\n\n\t\tgetUint32: function () {\n\n\t\t\tvar value = this.dv.getUint32( this.offset, this.littleEndian );\n\t\t\tthis.offset += 4;\n\t\t\treturn value;\n\n\t\t},\n\n\t\t// JavaScript doesn't support 64-bit integer so calculate this here\n\t\t// 1 << 32 will return 1 so using multiply operation instead here.\n\t\t// There's a possibility that this method returns wrong value if the value\n\t\t// is out of the range between Number.MAX_SAFE_INTEGER and Number.MIN_SAFE_INTEGER.\n\t\t// TODO: safely handle 64-bit integer\n\t\tgetInt64: function () {\n\n\t\t\tvar low, high;\n\n\t\t\tif ( this.littleEndian ) {\n\n\t\t\t\tlow = this.getUint32();\n\t\t\t\thigh = this.getUint32();\n\n\t\t\t} else {\n\n\t\t\t\thigh = this.getUint32();\n\t\t\t\tlow = this.getUint32();\n\n\t\t\t}\n\n\t\t\t// calculate negative value\n\t\t\tif ( high & 0x80000000 ) {\n\n\t\t\t\thigh = ~ high & 0xFFFFFFFF;\n\t\t\t\tlow = ~ low & 0xFFFFFFFF;\n\n\t\t\t\tif ( low === 0xFFFFFFFF ) high = ( high + 1 ) & 0xFFFFFFFF;\n\n\t\t\t\tlow = ( low + 1 ) & 0xFFFFFFFF;\n\n\t\t\t\treturn - ( high * 0x100000000 + low );\n\n\t\t\t}\n\n\t\t\treturn high * 0x100000000 + low;\n\n\t\t},\n\n\t\tgetInt64Array: function ( size ) {\n\n\t\t\tvar a = [];\n\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\n\n\t\t\t\ta.push( this.getInt64() );\n\n\t\t\t}\n\n\t\t\treturn a;\n\n\t\t},\n\n\t\t// Note: see getInt64() comment\n\t\tgetUint64: function () {\n\n\t\t\tvar low, high;\n\n\t\t\tif ( this.littleEndian ) {\n\n\t\t\t\tlow = this.getUint32();\n\t\t\t\thigh = this.getUint32();\n\n\t\t\t} else {\n\n\t\t\t\thigh = this.getUint32();\n\t\t\t\tlow = this.getUint32();\n\n\t\t\t}\n\n\t\t\treturn high * 0x100000000 + low;\n\n\t\t},\n\n\t\tgetFloat32: function () {\n\n\t\t\tvar value = this.dv.getFloat32( this.offset, this.littleEndian );\n\t\t\tthis.offset += 4;\n\t\t\treturn value;\n\n\t\t},\n\n\t\tgetFloat32Array: function ( size ) {\n\n\t\t\tvar a = [];\n\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\n\n\t\t\t\ta.push( this.getFloat32() );\n\n\t\t\t}\n\n\t\t\treturn a;\n\n\t\t},\n\n\t\tgetFloat64: function () {\n\n\t\t\tvar value = this.dv.getFloat64( this.offset, this.littleEndian );\n\t\t\tthis.offset += 8;\n\t\t\treturn value;\n\n\t\t},\n\n\t\tgetFloat64Array: function ( size ) {\n\n\t\t\tvar a = [];\n\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\n\n\t\t\t\ta.push( this.getFloat64() );\n\n\t\t\t}\n\n\t\t\treturn a;\n\n\t\t},\n\n\t\tgetArrayBuffer: function ( size ) {\n\n\t\t\tvar value = this.dv.buffer.slice( this.offset, this.offset + size );\n\t\t\tthis.offset += size;\n\t\t\treturn value;\n\n\t\t},\n\n\t\tgetString: function ( size ) {\n\n\t\t\tvar a = new Uint8Array( size );\n\n\t\t\tfor ( var i = 0; i < size; i ++ ) {\n\n\t\t\t\ta[ i ] = this.getUint8();\n\n\t\t\t}\n\n\t\t\tvar nullByte = a.indexOf( 0 );\n\t\t\tif ( nullByte >= 0 ) a = a.slice( 0, nullByte );\n\n\t\t\treturn THREE.LoaderUtils.decodeText( a );\n\n\t\t}\n\n\t} );\n\n\t// FBXTree holds a representation of the FBX data, returned by the TextParser ( FBX ASCII format)\n\t// and BinaryParser( FBX Binary format)\n\tfunction FBXTree() {}\n\n\tObject.assign( FBXTree.prototype, {\n\n\t\tadd: function ( key, val ) {\n\n\t\t\tthis[ key ] = val;\n\n\t\t},\n\n\t} );\n\n\tfunction isFbxFormatBinary( buffer ) {\n\n\t\tvar CORRECT = 'Kaydara FBX Binary  \\0';\n\n\t\treturn buffer.byteLength >= CORRECT.length && CORRECT === convertArrayBufferToString( buffer, 0, CORRECT.length );\n\n\t}\n\n\tfunction isFbxFormatASCII( text ) {\n\n\t\tvar CORRECT = [ 'K', 'a', 'y', 'd', 'a', 'r', 'a', '\\\\', 'F', 'B', 'X', '\\\\', 'B', 'i', 'n', 'a', 'r', 'y', '\\\\', '\\\\' ];\n\n\t\tvar cursor = 0;\n\n\t\tfunction read( offset ) {\n\n\t\t\tvar result = text[ offset - 1 ];\n\t\t\ttext = text.slice( cursor + offset );\n\t\t\tcursor ++;\n\t\t\treturn result;\n\n\t\t}\n\n\t\tfor ( var i = 0; i < CORRECT.length; ++ i ) {\n\n\t\t\tvar num = read( 1 );\n\t\t\tif ( num === CORRECT[ i ] ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\tfunction getFbxVersion( text ) {\n\n\t\tvar versionRegExp = /FBXVersion: (\\d+)/;\n\t\tvar match = text.match( versionRegExp );\n\t\tif ( match ) {\n\n\t\t\tvar version = parseInt( match[ 1 ] );\n\t\t\treturn version;\n\n\t\t}\n\t\tthrow new Error( 'THREE.FBXLoader: Cannot find the version number for the file given.' );\n\n\t}\n\n\t// Converts FBX ticks into real time seconds.\n\tfunction convertFBXTimeToSeconds( time ) {\n\n\t\treturn time / 46186158000;\n\n\t}\n\n\n\t// Parses comma separated list of numbers and returns them an array.\n\t// Used internally by the TextParser\n\tfunction parseNumberArray( value ) {\n\n\t\tvar array = value.split( ',' ).map( function ( val ) {\n\n\t\t\treturn parseFloat( val );\n\n\t\t} );\n\n\t\treturn array;\n\n\t}\n\n\tfunction convertArrayBufferToString( buffer, from, to ) {\n\n\t\tif ( from === undefined ) from = 0;\n\t\tif ( to === undefined ) to = buffer.byteLength;\n\n\t\treturn THREE.LoaderUtils.decodeText( new Uint8Array( buffer, from, to ) );\n\n\t}\n\n\tfunction append( a, b ) {\n\n\t\tfor ( var i = 0, j = a.length, l = b.length; i < l; i ++, j ++ ) {\n\n\t\t\ta[ j ] = b[ i ];\n\n\t\t}\n\n\t}\n\n\tfunction slice( a, b, from, to ) {\n\n\t\tfor ( var i = from, j = 0; i < to; i ++, j ++ ) {\n\n\t\t\ta[ j ] = b[ i ];\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\t// inject array a2 into array a1 at index\n\tfunction inject( a1, index, a2 ) {\n\n\t\treturn a1.slice( 0, index ).concat( a2 ).concat( a1.slice( index ) );\n\n\t}\n\n} )();\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/utils/FBXLoader.js?");

/***/ }),

/***/ "./src/js/lib/utils/SceneUtils.js":
/*!****************************************!*\
  !*** ./src/js/lib/utils/SceneUtils.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nTHREE.SceneUtils = {\n\n\tcreateMultiMaterialObject: function ( geometry, materials ) {\n\n\t\tvar group = new THREE.Group();\n\n\t\tfor ( var i = 0, l = materials.length; i < l; i ++ ) {\n\n\t\t\tgroup.add( new THREE.Mesh( geometry, materials[ i ] ) );\n\n\t\t}\n\n\t\treturn group;\n\n\t},\n\n\tdetach: function ( child, parent, scene ) {\n\n\t\tchild.applyMatrix( parent.matrixWorld );\n\t\tparent.remove( child );\n\t\tscene.add( child );\n\n\t},\n\n\tattach: function ( child, scene, parent ) {\n\n\t\tchild.applyMatrix( new THREE.Matrix4().getInverse( parent.matrixWorld ) );\n\n\t\tscene.remove( child );\n\t\tparent.add( child );\n\n\t}\n\n};\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/utils/SceneUtils.js?");

/***/ }),

/***/ "./src/js/lib/utils/Stats.js":
/*!***********************************!*\
  !*** ./src/js/lib/utils/Stats.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nvar Stats = function () {\n\n\tvar mode = 0;\n\n    var container = document.createElement( 'div' );\n    container.classList.add('statsBox');\n\tcontainer.addEventListener( 'click', function ( event ) {\n\n\t\tevent.preventDefault();\n\t\tshowPanel( ++ mode % container.children.length );\n\n\t}, false );\n\n\t//\n\n\tfunction addPanel( panel ) {\n\n\t\tcontainer.appendChild( panel.dom );\n\t\treturn panel;\n\n\t}\n\n\tfunction showPanel( id ) {\n\n\t\tfor ( var i = 0; i < container.children.length; i ++ ) {\n\n\t\t\tcontainer.children[ i ].style.display = i === id ? 'block' : 'none';\n\n\t\t}\n\n\t\tmode = id;\n\n\t}\n\n\t//\n\n\tvar beginTime = ( performance || Date ).now(), prevTime = beginTime, frames = 0;\n\n\tvar fpsPanel = addPanel( new Stats.Panel( 'FPS', '#0ff', '#002' ) );\n\tvar msPanel = addPanel( new Stats.Panel( 'MS', '#0f0', '#020' ) );\n\n\tif ( self.performance && self.performance.memory ) {\n\n\t\tvar memPanel = addPanel( new Stats.Panel( 'MB', '#f08', '#201' ) );\n\n\t}\n\n\tshowPanel( 0 );\n\n\treturn {\n\n\t\tREVISION: 16,\n\n\t\tdom: container,\n\n\t\taddPanel: addPanel,\n\t\tshowPanel: showPanel,\n\n\t\tbegin: function () {\n\n\t\t\tbeginTime = ( performance || Date ).now();\n\n\t\t},\n\n\t\tend: function () {\n\n\t\t\tframes ++;\n\n\t\t\tvar time = ( performance || Date ).now();\n\n\t\t\tmsPanel.update( time - beginTime, 200 );\n\n\t\t\tif ( time > prevTime + 1000 ) {\n\n\t\t\t\tfpsPanel.update( ( frames * 1000 ) / ( time - prevTime ), 100 );\n\n\t\t\t\tprevTime = time;\n\t\t\t\tframes = 0;\n\n\t\t\t\tif ( memPanel ) {\n\n\t\t\t\t\tvar memory = performance.memory;\n\t\t\t\t\tmemPanel.update( memory.usedJSHeapSize / 1048576, memory.jsHeapSizeLimit / 1048576 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn time;\n\n\t\t},\n\n\t\tupdate: function () {\n\n\t\t\tbeginTime = this.end();\n\n\t\t},\n\n\t\t// Backwards Compatibility\n\n\t\tdomElement: container,\n\t\tsetMode: showPanel\n\n\t};\n\n};\n\nStats.Panel = function ( name, fg, bg ) {\n\n\tvar min = Infinity, max = 0, round = Math.round;\n\tvar PR = round( window.devicePixelRatio || 1 );\n\n\tvar WIDTH = 80 * PR, HEIGHT = 48 * PR,\n\t\t\tTEXT_X = 3 * PR, TEXT_Y = 2 * PR,\n\t\t\tGRAPH_X = 3 * PR, GRAPH_Y = 15 * PR,\n\t\t\tGRAPH_WIDTH = 74 * PR, GRAPH_HEIGHT = 30 * PR;\n\n\tvar canvas = document.createElement( 'canvas' );\n\tcanvas.width = WIDTH;\n\tcanvas.height = HEIGHT;\n\tcanvas.style.cssText = 'width:80px;height:48px';\n\n\tvar context = canvas.getContext( '2d' );\n\tcontext.font = 'bold ' + ( 9 * PR ) + 'px Helvetica,Arial,sans-serif';\n\tcontext.textBaseline = 'top';\n\n\tcontext.fillStyle = bg;\n\tcontext.fillRect( 0, 0, WIDTH, HEIGHT );\n\n\tcontext.fillStyle = fg;\n\tcontext.fillText( name, TEXT_X, TEXT_Y );\n\tcontext.fillRect( GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT );\n\n\tcontext.fillStyle = bg;\n\tcontext.globalAlpha = 0.9;\n\tcontext.fillRect( GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT );\n\n\treturn {\n\n\t\tdom: canvas,\n\n\t\tupdate: function ( value, maxValue ) {\n\n\t\t\tmin = Math.min( min, value );\n\t\t\tmax = Math.max( max, value );\n\n\t\t\tcontext.fillStyle = bg;\n\t\t\tcontext.globalAlpha = 1;\n\t\t\tcontext.fillRect( 0, 0, WIDTH, GRAPH_Y );\n\t\t\tcontext.fillStyle = fg;\n\t\t\tcontext.fillText( round( value ) + ' ' + name + ' (' + round( min ) + '-' + round( max ) + ')', TEXT_X, TEXT_Y );\n\n\t\t\tcontext.drawImage( canvas, GRAPH_X + PR, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT, GRAPH_X, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT );\n\n\t\t\tcontext.fillRect( GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, GRAPH_HEIGHT );\n\n\t\t\tcontext.fillStyle = bg;\n\t\t\tcontext.globalAlpha = 0.9;\n\t\t\tcontext.fillRect( GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, round( ( 1 - ( value / maxValue ) ) * GRAPH_HEIGHT ) );\n\n\t\t}\n\n\t};\n\n};\n\nconsole.log(\"ahoj2\");\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/utils/Stats.js?");

/***/ }),

/***/ "./src/js/lib/utils/dat.gui.js":
/*!*************************************!*\
  !*** ./src/js/lib/utils/dat.gui.js ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n(function (global, factory) {\n\t true ? module.exports = factory() :\n\tundefined;\n}(this, (function () { 'use strict';\n\nfunction ___$insertStyle(css) {\n  if (!css) {\n    return;\n  }\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  var style = document.createElement('style');\n\n  style.setAttribute('type', 'text/css');\n  style.innerHTML = css;\n  document.head.appendChild(style);\n\n  return css;\n}\n\nfunction colorToString (color, forceCSSHex) {\n  var colorFormat = color.__state.conversionName.toString();\n  var r = Math.round(color.r);\n  var g = Math.round(color.g);\n  var b = Math.round(color.b);\n  var a = color.a;\n  var h = Math.round(color.h);\n  var s = color.s.toFixed(1);\n  var v = color.v.toFixed(1);\n  if (forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX') {\n    var str = color.hex.toString(16);\n    while (str.length < 6) {\n      str = '0' + str;\n    }\n    return '#' + str;\n  } else if (colorFormat === 'CSS_RGB') {\n    return 'rgb(' + r + ',' + g + ',' + b + ')';\n  } else if (colorFormat === 'CSS_RGBA') {\n    return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n  } else if (colorFormat === 'HEX') {\n    return '0x' + color.hex.toString(16);\n  } else if (colorFormat === 'RGB_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ']';\n  } else if (colorFormat === 'RGBA_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ',' + a + ']';\n  } else if (colorFormat === 'RGB_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + '}';\n  } else if (colorFormat === 'RGBA_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';\n  } else if (colorFormat === 'HSV_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + '}';\n  } else if (colorFormat === 'HSVA_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';\n  }\n  return 'unknown format';\n}\n\nvar ARR_EACH = Array.prototype.forEach;\nvar ARR_SLICE = Array.prototype.slice;\nvar Common = {\n  BREAK: {},\n  extend: function extend(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (!this.isUndefined(obj[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  defaults: function defaults(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (this.isUndefined(target[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  compose: function compose() {\n    var toCall = ARR_SLICE.call(arguments);\n    return function () {\n      var args = ARR_SLICE.call(arguments);\n      for (var i = toCall.length - 1; i >= 0; i--) {\n        args = [toCall[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  },\n  each: function each(obj, itr, scope) {\n    if (!obj) {\n      return;\n    }\n    if (ARR_EACH && obj.forEach && obj.forEach === ARR_EACH) {\n      obj.forEach(itr, scope);\n    } else if (obj.length === obj.length + 0) {\n      var key = void 0;\n      var l = void 0;\n      for (key = 0, l = obj.length; key < l; key++) {\n        if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) {\n          return;\n        }\n      }\n    } else {\n      for (var _key in obj) {\n        if (itr.call(scope, obj[_key], _key) === this.BREAK) {\n          return;\n        }\n      }\n    }\n  },\n  defer: function defer(fnc) {\n    setTimeout(fnc, 0);\n  },\n  debounce: function debounce(func, threshold, callImmediately) {\n    var timeout = void 0;\n    return function () {\n      var obj = this;\n      var args = arguments;\n      function delayed() {\n        timeout = null;\n        if (!callImmediately) func.apply(obj, args);\n      }\n      var callNow = callImmediately || !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(delayed, threshold);\n      if (callNow) {\n        func.apply(obj, args);\n      }\n    };\n  },\n  toArray: function toArray(obj) {\n    if (obj.toArray) return obj.toArray();\n    return ARR_SLICE.call(obj);\n  },\n  isUndefined: function isUndefined(obj) {\n    return obj === undefined;\n  },\n  isNull: function isNull(obj) {\n    return obj === null;\n  },\n  isNaN: function (_isNaN) {\n    function isNaN(_x) {\n      return _isNaN.apply(this, arguments);\n    }\n    isNaN.toString = function () {\n      return _isNaN.toString();\n    };\n    return isNaN;\n  }(function (obj) {\n    return isNaN(obj);\n  }),\n  isArray: Array.isArray || function (obj) {\n    return obj.constructor === Array;\n  },\n  isObject: function isObject(obj) {\n    return obj === Object(obj);\n  },\n  isNumber: function isNumber(obj) {\n    return obj === obj + 0;\n  },\n  isString: function isString(obj) {\n    return obj === obj + '';\n  },\n  isBoolean: function isBoolean(obj) {\n    return obj === false || obj === true;\n  },\n  isFunction: function isFunction(obj) {\n    return Object.prototype.toString.call(obj) === '[object Function]';\n  }\n};\n\nvar INTERPRETATIONS = [\n{\n  litmus: Common.isString,\n  conversions: {\n    THREE_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString() + test[1].toString() + test[2].toString() + test[2].toString() + test[3].toString() + test[3].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    SIX_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9]{6})$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGB: {\n      read: function read(original) {\n        var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3])\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGBA: {\n      read: function read(original) {\n        var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3]),\n          a: parseFloat(test[4])\n        };\n      },\n      write: colorToString\n    }\n  }\n},\n{\n  litmus: Common.isNumber,\n  conversions: {\n    HEX: {\n      read: function read(original) {\n        return {\n          space: 'HEX',\n          hex: original,\n          conversionName: 'HEX'\n        };\n      },\n      write: function write(color) {\n        return color.hex;\n      }\n    }\n  }\n},\n{\n  litmus: Common.isArray,\n  conversions: {\n    RGB_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 3) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b];\n      }\n    },\n    RGBA_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 4) return false;\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2],\n          a: original[3]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b, color.a];\n      }\n    }\n  }\n},\n{\n  litmus: Common.isObject,\n  conversions: {\n    RGBA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b) && Common.isNumber(original.a)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b,\n          a: color.a\n        };\n      }\n    },\n    RGB_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b\n        };\n      }\n    },\n    HSVA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v) && Common.isNumber(original.a)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v,\n          a: color.a\n        };\n      }\n    },\n    HSV_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v\n        };\n      }\n    }\n  }\n}];\nvar result = void 0;\nvar toReturn = void 0;\nvar interpret = function interpret() {\n  toReturn = false;\n  var original = arguments.length > 1 ? Common.toArray(arguments) : arguments[0];\n  Common.each(INTERPRETATIONS, function (family) {\n    if (family.litmus(original)) {\n      Common.each(family.conversions, function (conversion, conversionName) {\n        result = conversion.read(original);\n        if (toReturn === false && result !== false) {\n          toReturn = result;\n          result.conversionName = conversionName;\n          result.conversion = conversion;\n          return Common.BREAK;\n        }\n      });\n      return Common.BREAK;\n    }\n  });\n  return toReturn;\n};\n\nvar tmpComponent = void 0;\nvar ColorMath = {\n  hsv_to_rgb: function hsv_to_rgb(h, s, v) {\n    var hi = Math.floor(h / 60) % 6;\n    var f = h / 60 - Math.floor(h / 60);\n    var p = v * (1.0 - s);\n    var q = v * (1.0 - f * s);\n    var t = v * (1.0 - (1.0 - f) * s);\n    var c = [[v, t, p], [q, v, p], [p, v, t], [p, q, v], [t, p, v], [v, p, q]][hi];\n    return {\n      r: c[0] * 255,\n      g: c[1] * 255,\n      b: c[2] * 255\n    };\n  },\n  rgb_to_hsv: function rgb_to_hsv(r, g, b) {\n    var min = Math.min(r, g, b);\n    var max = Math.max(r, g, b);\n    var delta = max - min;\n    var h = void 0;\n    var s = void 0;\n    if (max !== 0) {\n      s = delta / max;\n    } else {\n      return {\n        h: NaN,\n        s: 0,\n        v: 0\n      };\n    }\n    if (r === max) {\n      h = (g - b) / delta;\n    } else if (g === max) {\n      h = 2 + (b - r) / delta;\n    } else {\n      h = 4 + (r - g) / delta;\n    }\n    h /= 6;\n    if (h < 0) {\n      h += 1;\n    }\n    return {\n      h: h * 360,\n      s: s,\n      v: max / 255\n    };\n  },\n  rgb_to_hex: function rgb_to_hex(r, g, b) {\n    var hex = this.hex_with_component(0, 2, r);\n    hex = this.hex_with_component(hex, 1, g);\n    hex = this.hex_with_component(hex, 0, b);\n    return hex;\n  },\n  component_from_hex: function component_from_hex(hex, componentIndex) {\n    return hex >> componentIndex * 8 & 0xFF;\n  },\n  hex_with_component: function hex_with_component(hex, componentIndex, value) {\n    return value << (tmpComponent = componentIndex * 8) | hex & ~(0xFF << tmpComponent);\n  }\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\n\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar possibleConstructorReturn = function (self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\nvar Color = function () {\n  function Color() {\n    classCallCheck(this, Color);\n    this.__state = interpret.apply(this, arguments);\n    if (this.__state === false) {\n      throw new Error('Failed to interpret color arguments');\n    }\n    this.__state.a = this.__state.a || 1;\n  }\n  createClass(Color, [{\n    key: 'toString',\n    value: function toString() {\n      return colorToString(this);\n    }\n  }, {\n    key: 'toHexString',\n    value: function toHexString() {\n      return colorToString(this, true);\n    }\n  }, {\n    key: 'toOriginal',\n    value: function toOriginal() {\n      return this.__state.conversion.write(this);\n    }\n  }]);\n  return Color;\n}();\nfunction defineRGBComponent(target, component, componentHexIndex) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'RGB') {\n        return this.__state[component];\n      }\n      Color.recalculateRGB(this, component, componentHexIndex);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'RGB') {\n        Color.recalculateRGB(this, component, componentHexIndex);\n        this.__state.space = 'RGB';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nfunction defineHSVComponent(target, component) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'HSV') {\n        return this.__state[component];\n      }\n      Color.recalculateHSV(this);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'HSV') {\n        Color.recalculateHSV(this);\n        this.__state.space = 'HSV';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nColor.recalculateRGB = function (color, component, componentHexIndex) {\n  if (color.__state.space === 'HEX') {\n    color.__state[component] = ColorMath.component_from_hex(color.__state.hex, componentHexIndex);\n  } else if (color.__state.space === 'HSV') {\n    Common.extend(color.__state, ColorMath.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n  } else {\n    throw new Error('Corrupted color state');\n  }\n};\nColor.recalculateHSV = function (color) {\n  var result = ColorMath.rgb_to_hsv(color.r, color.g, color.b);\n  Common.extend(color.__state, {\n    s: result.s,\n    v: result.v\n  });\n  if (!Common.isNaN(result.h)) {\n    color.__state.h = result.h;\n  } else if (Common.isUndefined(color.__state.h)) {\n    color.__state.h = 0;\n  }\n};\nColor.COMPONENTS = ['r', 'g', 'b', 'h', 's', 'v', 'hex', 'a'];\ndefineRGBComponent(Color.prototype, 'r', 2);\ndefineRGBComponent(Color.prototype, 'g', 1);\ndefineRGBComponent(Color.prototype, 'b', 0);\ndefineHSVComponent(Color.prototype, 'h');\ndefineHSVComponent(Color.prototype, 's');\ndefineHSVComponent(Color.prototype, 'v');\nObject.defineProperty(Color.prototype, 'a', {\n  get: function get$$1() {\n    return this.__state.a;\n  },\n  set: function set$$1(v) {\n    this.__state.a = v;\n  }\n});\nObject.defineProperty(Color.prototype, 'hex', {\n  get: function get$$1() {\n    if (!this.__state.space !== 'HEX') {\n      this.__state.hex = ColorMath.rgb_to_hex(this.r, this.g, this.b);\n    }\n    return this.__state.hex;\n  },\n  set: function set$$1(v) {\n    this.__state.space = 'HEX';\n    this.__state.hex = v;\n  }\n});\n\nvar Controller = function () {\n  function Controller(object, property) {\n    classCallCheck(this, Controller);\n    this.initialValue = object[property];\n    this.domElement = document.createElement('div');\n    this.object = object;\n    this.property = property;\n    this.__onChange = undefined;\n    this.__onFinishChange = undefined;\n  }\n  createClass(Controller, [{\n    key: 'onChange',\n    value: function onChange(fnc) {\n      this.__onChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'onFinishChange',\n    value: function onFinishChange(fnc) {\n      this.__onFinishChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'setValue',\n    value: function setValue(newValue) {\n      this.object[this.property] = newValue;\n      if (this.__onChange) {\n        this.__onChange.call(this, newValue);\n      }\n      this.updateDisplay();\n      return this;\n    }\n  }, {\n    key: 'getValue',\n    value: function getValue() {\n      return this.object[this.property];\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      return this;\n    }\n  }, {\n    key: 'isModified',\n    value: function isModified() {\n      return this.initialValue !== this.getValue();\n    }\n  }]);\n  return Controller;\n}();\n\nvar EVENT_MAP = {\n  HTMLEvents: ['change'],\n  MouseEvents: ['click', 'mousemove', 'mousedown', 'mouseup', 'mouseover'],\n  KeyboardEvents: ['keydown']\n};\nvar EVENT_MAP_INV = {};\nCommon.each(EVENT_MAP, function (v, k) {\n  Common.each(v, function (e) {\n    EVENT_MAP_INV[e] = k;\n  });\n});\nvar CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\nfunction cssValueToPixels(val) {\n  if (val === '0' || Common.isUndefined(val)) {\n    return 0;\n  }\n  var match = val.match(CSS_VALUE_PIXELS);\n  if (!Common.isNull(match)) {\n    return parseFloat(match[1]);\n  }\n  return 0;\n}\nvar dom = {\n  makeSelectable: function makeSelectable(elem, selectable) {\n    if (elem === undefined || elem.style === undefined) return;\n    elem.onselectstart = selectable ? function () {\n      return false;\n    } : function () {};\n    elem.style.MozUserSelect = selectable ? 'auto' : 'none';\n    elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\n    elem.unselectable = selectable ? 'on' : 'off';\n  },\n  makeFullscreen: function makeFullscreen(elem, hor, vert) {\n    var vertical = vert;\n    var horizontal = hor;\n    if (Common.isUndefined(horizontal)) {\n      horizontal = true;\n    }\n    if (Common.isUndefined(vertical)) {\n      vertical = true;\n    }\n    elem.style.position = 'absolute';\n    if (horizontal) {\n      elem.style.left = 0;\n      elem.style.right = 0;\n    }\n    if (vertical) {\n      elem.style.top = 0;\n      elem.style.bottom = 0;\n    }\n  },\n  fakeEvent: function fakeEvent(elem, eventType, pars, aux) {\n    var params = pars || {};\n    var className = EVENT_MAP_INV[eventType];\n    if (!className) {\n      throw new Error('Event type ' + eventType + ' not supported.');\n    }\n    var evt = document.createEvent(className);\n    switch (className) {\n      case 'MouseEvents':\n        {\n          var clientX = params.x || params.clientX || 0;\n          var clientY = params.y || params.clientY || 0;\n          evt.initMouseEvent(eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0,\n          0,\n          clientX,\n          clientY,\n          false, false, false, false, 0, null);\n          break;\n        }\n      case 'KeyboardEvents':\n        {\n          var init = evt.initKeyboardEvent || evt.initKeyEvent;\n          Common.defaults(params, {\n            cancelable: true,\n            ctrlKey: false,\n            altKey: false,\n            shiftKey: false,\n            metaKey: false,\n            keyCode: undefined,\n            charCode: undefined\n          });\n          init(eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode);\n          break;\n        }\n      default:\n        {\n          evt.initEvent(eventType, params.bubbles || false, params.cancelable || true);\n          break;\n        }\n    }\n    Common.defaults(evt, aux);\n    elem.dispatchEvent(evt);\n  },\n  bind: function bind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.addEventListener) {\n      elem.addEventListener(event, func, bool);\n    } else if (elem.attachEvent) {\n      elem.attachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  unbind: function unbind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.removeEventListener) {\n      elem.removeEventListener(event, func, bool);\n    } else if (elem.detachEvent) {\n      elem.detachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  addClass: function addClass(elem, className) {\n    if (elem.className === undefined) {\n      elem.className = className;\n    } else if (elem.className !== className) {\n      var classes = elem.className.split(/ +/);\n      if (classes.indexOf(className) === -1) {\n        classes.push(className);\n        elem.className = classes.join(' ').replace(/^\\s+/, '').replace(/\\s+$/, '');\n      }\n    }\n    return dom;\n  },\n  removeClass: function removeClass(elem, className) {\n    if (className) {\n      if (elem.className === className) {\n        elem.removeAttribute('class');\n      } else {\n        var classes = elem.className.split(/ +/);\n        var index = classes.indexOf(className);\n        if (index !== -1) {\n          classes.splice(index, 1);\n          elem.className = classes.join(' ');\n        }\n      }\n    } else {\n      elem.className = undefined;\n    }\n    return dom;\n  },\n  hasClass: function hasClass(elem, className) {\n    return new RegExp('(?:^|\\\\s+)' + className + '(?:\\\\s+|$)').test(elem.className) || false;\n  },\n  getWidth: function getWidth(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-left-width']) + cssValueToPixels(style['border-right-width']) + cssValueToPixels(style['padding-left']) + cssValueToPixels(style['padding-right']) + cssValueToPixels(style.width);\n  },\n  getHeight: function getHeight(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-top-width']) + cssValueToPixels(style['border-bottom-width']) + cssValueToPixels(style['padding-top']) + cssValueToPixels(style['padding-bottom']) + cssValueToPixels(style.height);\n  },\n  getOffset: function getOffset(el) {\n    var elem = el;\n    var offset = { left: 0, top: 0 };\n    if (elem.offsetParent) {\n      do {\n        offset.left += elem.offsetLeft;\n        offset.top += elem.offsetTop;\n        elem = elem.offsetParent;\n      } while (elem);\n    }\n    return offset;\n  },\n  isActive: function isActive(elem) {\n    return elem === document.activeElement && (elem.type || elem.href);\n  }\n};\n\nvar BooleanController = function (_Controller) {\n  inherits(BooleanController, _Controller);\n  function BooleanController(object, property) {\n    classCallCheck(this, BooleanController);\n    var _this2 = possibleConstructorReturn(this, (BooleanController.__proto__ || Object.getPrototypeOf(BooleanController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__prev = _this2.getValue();\n    _this2.__checkbox = document.createElement('input');\n    _this2.__checkbox.setAttribute('type', 'checkbox');\n    function onChange() {\n      _this.setValue(!_this.__prev);\n    }\n    dom.bind(_this2.__checkbox, 'change', onChange, false);\n    _this2.domElement.appendChild(_this2.__checkbox);\n    _this2.updateDisplay();\n    return _this2;\n  }\n  createClass(BooleanController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      this.__prev = this.getValue();\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (this.getValue() === true) {\n        this.__checkbox.setAttribute('checked', 'checked');\n        this.__checkbox.checked = true;\n        this.__prev = true;\n      } else {\n        this.__checkbox.checked = false;\n        this.__prev = false;\n      }\n      return get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return BooleanController;\n}(Controller);\n\nvar OptionController = function (_Controller) {\n  inherits(OptionController, _Controller);\n  function OptionController(object, property, opts) {\n    classCallCheck(this, OptionController);\n    var _this2 = possibleConstructorReturn(this, (OptionController.__proto__ || Object.getPrototypeOf(OptionController)).call(this, object, property));\n    var options = opts;\n    var _this = _this2;\n    _this2.__select = document.createElement('select');\n    if (Common.isArray(options)) {\n      var map = {};\n      Common.each(options, function (element) {\n        map[element] = element;\n      });\n      options = map;\n    }\n    Common.each(options, function (value, key) {\n      var opt = document.createElement('option');\n      opt.innerHTML = key;\n      opt.setAttribute('value', value);\n      _this.__select.appendChild(opt);\n    });\n    _this2.updateDisplay();\n    dom.bind(_this2.__select, 'change', function () {\n      var desiredValue = this.options[this.selectedIndex].value;\n      _this.setValue(desiredValue);\n    });\n    _this2.domElement.appendChild(_this2.__select);\n    return _this2;\n  }\n  createClass(OptionController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (dom.isActive(this.__select)) return this;\n      this.__select.value = this.getValue();\n      return get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return OptionController;\n}(Controller);\n\nvar StringController = function (_Controller) {\n  inherits(StringController, _Controller);\n  function StringController(object, property) {\n    classCallCheck(this, StringController);\n    var _this2 = possibleConstructorReturn(this, (StringController.__proto__ || Object.getPrototypeOf(StringController)).call(this, object, property));\n    var _this = _this2;\n    function onChange() {\n      _this.setValue(_this.__input.value);\n    }\n    function onBlur() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'keyup', onChange);\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        this.blur();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(StringController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (!dom.isActive(this.__input)) {\n        this.__input.value = this.getValue();\n      }\n      return get(StringController.prototype.__proto__ || Object.getPrototypeOf(StringController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return StringController;\n}(Controller);\n\nfunction numDecimals(x) {\n  var _x = x.toString();\n  if (_x.indexOf('.') > -1) {\n    return _x.length - _x.indexOf('.') - 1;\n  }\n  return 0;\n}\nvar NumberController = function (_Controller) {\n  inherits(NumberController, _Controller);\n  function NumberController(object, property, params) {\n    classCallCheck(this, NumberController);\n    var _this = possibleConstructorReturn(this, (NumberController.__proto__ || Object.getPrototypeOf(NumberController)).call(this, object, property));\n    var _params = params || {};\n    _this.__min = _params.min;\n    _this.__max = _params.max;\n    _this.__step = _params.step;\n    if (Common.isUndefined(_this.__step)) {\n      if (_this.initialValue === 0) {\n        _this.__impliedStep = 1;\n      } else {\n        _this.__impliedStep = Math.pow(10, Math.floor(Math.log(Math.abs(_this.initialValue)) / Math.LN10)) / 10;\n      }\n    } else {\n      _this.__impliedStep = _this.__step;\n    }\n    _this.__precision = numDecimals(_this.__impliedStep);\n    return _this;\n  }\n  createClass(NumberController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var _v = v;\n      if (this.__min !== undefined && _v < this.__min) {\n        _v = this.__min;\n      } else if (this.__max !== undefined && _v > this.__max) {\n        _v = this.__max;\n      }\n      if (this.__step !== undefined && _v % this.__step !== 0) {\n        _v = Math.round(_v / this.__step) * this.__step;\n      }\n      return get(NumberController.prototype.__proto__ || Object.getPrototypeOf(NumberController.prototype), 'setValue', this).call(this, _v);\n    }\n  }, {\n    key: 'min',\n    value: function min(minValue) {\n      this.__min = minValue;\n      return this;\n    }\n  }, {\n    key: 'max',\n    value: function max(maxValue) {\n      this.__max = maxValue;\n      return this;\n    }\n  }, {\n    key: 'step',\n    value: function step(stepValue) {\n      this.__step = stepValue;\n      this.__impliedStep = stepValue;\n      this.__precision = numDecimals(stepValue);\n      return this;\n    }\n  }]);\n  return NumberController;\n}(Controller);\n\nfunction roundToDecimal(value, decimals) {\n  var tenTo = Math.pow(10, decimals);\n  return Math.round(value * tenTo) / tenTo;\n}\nvar NumberControllerBox = function (_NumberController) {\n  inherits(NumberControllerBox, _NumberController);\n  function NumberControllerBox(object, property, params) {\n    classCallCheck(this, NumberControllerBox);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerBox.__proto__ || Object.getPrototypeOf(NumberControllerBox)).call(this, object, property, params));\n    _this2.__truncationSuspended = false;\n    var _this = _this2;\n    var prevY = void 0;\n    function onChange() {\n      var attempted = parseFloat(_this.__input.value);\n      if (!Common.isNaN(attempted)) {\n        _this.setValue(attempted);\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onBlur() {\n      onFinish();\n    }\n    function onMouseDrag(e) {\n      var diff = prevY - e.clientY;\n      _this.setValue(_this.getValue() + diff * _this.__impliedStep);\n      prevY = e.clientY;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      onFinish();\n    }\n    function onMouseDown(e) {\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      prevY = e.clientY;\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'mousedown', onMouseDown);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        _this.__truncationSuspended = true;\n        this.blur();\n        _this.__truncationSuspended = false;\n        onFinish();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(NumberControllerBox, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal(this.getValue(), this.__precision);\n      return get(NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf(NumberControllerBox.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerBox;\n}(NumberController);\n\nfunction map(v, i1, i2, o1, o2) {\n  return o1 + (o2 - o1) * ((v - i1) / (i2 - i1));\n}\nvar NumberControllerSlider = function (_NumberController) {\n  inherits(NumberControllerSlider, _NumberController);\n  function NumberControllerSlider(object, property, min, max, step) {\n    classCallCheck(this, NumberControllerSlider);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerSlider.__proto__ || Object.getPrototypeOf(NumberControllerSlider)).call(this, object, property, { min: min, max: max, step: step }));\n    var _this = _this2;\n    _this2.__background = document.createElement('div');\n    _this2.__foreground = document.createElement('div');\n    dom.bind(_this2.__background, 'mousedown', onMouseDown);\n    dom.bind(_this2.__background, 'touchstart', onTouchStart);\n    dom.addClass(_this2.__background, 'slider');\n    dom.addClass(_this2.__foreground, 'slider-fg');\n    function onMouseDown(e) {\n      document.activeElement.blur();\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      onMouseDrag(e);\n    }\n    function onMouseDrag(e) {\n      e.preventDefault();\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n      return false;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onTouchStart(e) {\n      if (e.touches.length !== 1) {\n        return;\n      }\n      dom.bind(window, 'touchmove', onTouchMove);\n      dom.bind(window, 'touchend', onTouchEnd);\n      onTouchMove(e);\n    }\n    function onTouchMove(e) {\n      var clientX = e.touches[0].clientX;\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n    }\n    function onTouchEnd() {\n      dom.unbind(window, 'touchmove', onTouchMove);\n      dom.unbind(window, 'touchend', onTouchEnd);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.updateDisplay();\n    _this2.__background.appendChild(_this2.__foreground);\n    _this2.domElement.appendChild(_this2.__background);\n    return _this2;\n  }\n  createClass(NumberControllerSlider, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var pct = (this.getValue() - this.__min) / (this.__max - this.__min);\n      this.__foreground.style.width = pct * 100 + '%';\n      return get(NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf(NumberControllerSlider.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerSlider;\n}(NumberController);\n\nvar FunctionController = function (_Controller) {\n  inherits(FunctionController, _Controller);\n  function FunctionController(object, property, text) {\n    classCallCheck(this, FunctionController);\n    var _this2 = possibleConstructorReturn(this, (FunctionController.__proto__ || Object.getPrototypeOf(FunctionController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__button = document.createElement('div');\n    _this2.__button.innerHTML = text === undefined ? 'Fire' : text;\n    dom.bind(_this2.__button, 'click', function (e) {\n      e.preventDefault();\n      _this.fire();\n      return false;\n    });\n    dom.addClass(_this2.__button, 'button');\n    _this2.domElement.appendChild(_this2.__button);\n    return _this2;\n  }\n  createClass(FunctionController, [{\n    key: 'fire',\n    value: function fire() {\n      if (this.__onChange) {\n        this.__onChange.call(this);\n      }\n      this.getValue().call(this.object);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n    }\n  }]);\n  return FunctionController;\n}(Controller);\n\nvar ColorController = function (_Controller) {\n  inherits(ColorController, _Controller);\n  function ColorController(object, property) {\n    classCallCheck(this, ColorController);\n    var _this2 = possibleConstructorReturn(this, (ColorController.__proto__ || Object.getPrototypeOf(ColorController)).call(this, object, property));\n    _this2.__color = new Color(_this2.getValue());\n    _this2.__temp = new Color(0);\n    var _this = _this2;\n    _this2.domElement = document.createElement('div');\n    dom.makeSelectable(_this2.domElement, false);\n    _this2.__selector = document.createElement('div');\n    _this2.__selector.className = 'selector';\n    _this2.__saturation_field = document.createElement('div');\n    _this2.__saturation_field.className = 'saturation-field';\n    _this2.__field_knob = document.createElement('div');\n    _this2.__field_knob.className = 'field-knob';\n    _this2.__field_knob_border = '2px solid ';\n    _this2.__hue_knob = document.createElement('div');\n    _this2.__hue_knob.className = 'hue-knob';\n    _this2.__hue_field = document.createElement('div');\n    _this2.__hue_field.className = 'hue-field';\n    _this2.__input = document.createElement('input');\n    _this2.__input.type = 'text';\n    _this2.__input_textShadow = '0 1px 1px ';\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        onBlur.call(this);\n      }\n    });\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__selector, 'mousedown', function ()        {\n      dom.addClass(this, 'drag').bind(window, 'mouseup', function ()        {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    dom.bind(_this2.__selector, 'touchstart', function ()        {\n      dom.addClass(this, 'drag').bind(window, 'touchend', function ()        {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    var valueField = document.createElement('div');\n    Common.extend(_this2.__selector.style, {\n      width: '122px',\n      height: '102px',\n      padding: '3px',\n      backgroundColor: '#222',\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n    });\n    Common.extend(_this2.__field_knob.style, {\n      position: 'absolute',\n      width: '12px',\n      height: '12px',\n      border: _this2.__field_knob_border + (_this2.__color.v < 0.5 ? '#fff' : '#000'),\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n      borderRadius: '12px',\n      zIndex: 1\n    });\n    Common.extend(_this2.__hue_knob.style, {\n      position: 'absolute',\n      width: '15px',\n      height: '2px',\n      borderRight: '4px solid #fff',\n      zIndex: 1\n    });\n    Common.extend(_this2.__saturation_field.style, {\n      width: '100px',\n      height: '100px',\n      border: '1px solid #555',\n      marginRight: '3px',\n      display: 'inline-block',\n      cursor: 'pointer'\n    });\n    Common.extend(valueField.style, {\n      width: '100%',\n      height: '100%',\n      background: 'none'\n    });\n    linearGradient(valueField, 'top', 'rgba(0,0,0,0)', '#000');\n    Common.extend(_this2.__hue_field.style, {\n      width: '15px',\n      height: '100px',\n      border: '1px solid #555',\n      cursor: 'ns-resize',\n      position: 'absolute',\n      top: '3px',\n      right: '3px'\n    });\n    hueGradient(_this2.__hue_field);\n    Common.extend(_this2.__input.style, {\n      outline: 'none',\n      textAlign: 'center',\n      color: '#fff',\n      border: 0,\n      fontWeight: 'bold',\n      textShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'\n    });\n    dom.bind(_this2.__saturation_field, 'mousedown', fieldDown);\n    dom.bind(_this2.__saturation_field, 'touchstart', fieldDown);\n    dom.bind(_this2.__field_knob, 'mousedown', fieldDown);\n    dom.bind(_this2.__field_knob, 'touchstart', fieldDown);\n    dom.bind(_this2.__hue_field, 'mousedown', fieldDownH);\n    dom.bind(_this2.__hue_field, 'touchstart', fieldDownH);\n    function fieldDown(e) {\n      setSV(e);\n      dom.bind(window, 'mousemove', setSV);\n      dom.bind(window, 'touchmove', setSV);\n      dom.bind(window, 'mouseup', fieldUpSV);\n      dom.bind(window, 'touchend', fieldUpSV);\n    }\n    function fieldDownH(e) {\n      setH(e);\n      dom.bind(window, 'mousemove', setH);\n      dom.bind(window, 'touchmove', setH);\n      dom.bind(window, 'mouseup', fieldUpH);\n      dom.bind(window, 'touchend', fieldUpH);\n    }\n    function fieldUpSV() {\n      dom.unbind(window, 'mousemove', setSV);\n      dom.unbind(window, 'touchmove', setSV);\n      dom.unbind(window, 'mouseup', fieldUpSV);\n      dom.unbind(window, 'touchend', fieldUpSV);\n      onFinish();\n    }\n    function fieldUpH() {\n      dom.unbind(window, 'mousemove', setH);\n      dom.unbind(window, 'touchmove', setH);\n      dom.unbind(window, 'mouseup', fieldUpH);\n      dom.unbind(window, 'touchend', fieldUpH);\n      onFinish();\n    }\n    function onBlur() {\n      var i = interpret(this.value);\n      if (i !== false) {\n        _this.__color.__state = i;\n        _this.setValue(_this.__color.toOriginal());\n      } else {\n        this.value = _this.__color.toString();\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.__color.toOriginal());\n      }\n    }\n    _this2.__saturation_field.appendChild(valueField);\n    _this2.__selector.appendChild(_this2.__field_knob);\n    _this2.__selector.appendChild(_this2.__saturation_field);\n    _this2.__selector.appendChild(_this2.__hue_field);\n    _this2.__hue_field.appendChild(_this2.__hue_knob);\n    _this2.domElement.appendChild(_this2.__input);\n    _this2.domElement.appendChild(_this2.__selector);\n    _this2.updateDisplay();\n    function setSV(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__saturation_field.getBoundingClientRect();\n      var _ref = e.touches && e.touches[0] || e,\n          clientX = _ref.clientX,\n          clientY = _ref.clientY;\n      var s = (clientX - fieldRect.left) / (fieldRect.right - fieldRect.left);\n      var v = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (v > 1) {\n        v = 1;\n      } else if (v < 0) {\n        v = 0;\n      }\n      if (s > 1) {\n        s = 1;\n      } else if (s < 0) {\n        s = 0;\n      }\n      _this.__color.v = v;\n      _this.__color.s = s;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    function setH(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__hue_field.getBoundingClientRect();\n      var _ref2 = e.touches && e.touches[0] || e,\n          clientY = _ref2.clientY;\n      var h = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (h > 1) {\n        h = 1;\n      } else if (h < 0) {\n        h = 0;\n      }\n      _this.__color.h = h * 360;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    return _this2;\n  }\n  createClass(ColorController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var i = interpret(this.getValue());\n      if (i !== false) {\n        var mismatch = false;\n        Common.each(Color.COMPONENTS, function (component) {\n          if (!Common.isUndefined(i[component]) && !Common.isUndefined(this.__color.__state[component]) && i[component] !== this.__color.__state[component]) {\n            mismatch = true;\n            return {};\n          }\n        }, this);\n        if (mismatch) {\n          Common.extend(this.__color.__state, i);\n        }\n      }\n      Common.extend(this.__temp.__state, this.__color.__state);\n      this.__temp.a = 1;\n      var flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\n      var _flip = 255 - flip;\n      Common.extend(this.__field_knob.style, {\n        marginLeft: 100 * this.__color.s - 7 + 'px',\n        marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n        backgroundColor: this.__temp.toHexString(),\n        border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\n      });\n      this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px';\n      this.__temp.s = 1;\n      this.__temp.v = 1;\n      linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toHexString());\n      this.__input.value = this.__color.toString();\n      Common.extend(this.__input.style, {\n        backgroundColor: this.__color.toHexString(),\n        color: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\n        textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\n      });\n    }\n  }]);\n  return ColorController;\n}(Controller);\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\nfunction linearGradient(elem, x, a, b) {\n  elem.style.background = '';\n  Common.each(vendors, function (vendor) {\n    elem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\n  });\n}\nfunction hueGradient(elem) {\n  elem.style.background = '';\n  elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n}\n\nvar css = {\n  load: function load(url, indoc) {\n    var doc = indoc || document;\n    var link = doc.createElement('link');\n    link.type = 'text/css';\n    link.rel = 'stylesheet';\n    link.href = url;\n    doc.getElementsByTagName('head')[0].appendChild(link);\n  },\n  inject: function inject(cssContent, indoc) {\n    var doc = indoc || document;\n    var injected = document.createElement('style');\n    injected.type = 'text/css';\n    injected.innerHTML = cssContent;\n    var head = doc.getElementsByTagName('head')[0];\n    try {\n      head.appendChild(injected);\n    } catch (e) {\n    }\n  }\n};\n\nvar saveDialogContents = \"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n\\n    </div>\\n\\n  </div>\\n\\n</div>\";\n\nvar ControllerFactory = function ControllerFactory(object, property) {\n  var initialValue = object[property];\n  if (Common.isArray(arguments[2]) || Common.isObject(arguments[2])) {\n    return new OptionController(object, property, arguments[2]);\n  }\n  if (Common.isNumber(initialValue)) {\n    if (Common.isNumber(arguments[2]) && Common.isNumber(arguments[3])) {\n      if (Common.isNumber(arguments[4])) {\n        return new NumberControllerSlider(object, property, arguments[2], arguments[3], arguments[4]);\n      }\n      return new NumberControllerSlider(object, property, arguments[2], arguments[3]);\n    }\n    if (Common.isNumber(arguments[4])) {\n      return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3], step: arguments[4] });\n    }\n    return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3] });\n  }\n  if (Common.isString(initialValue)) {\n    return new StringController(object, property);\n  }\n  if (Common.isFunction(initialValue)) {\n    return new FunctionController(object, property, '');\n  }\n  if (Common.isBoolean(initialValue)) {\n    return new BooleanController(object, property);\n  }\n  return null;\n};\n\nfunction requestAnimationFrame(callback) {\n  setTimeout(callback, 1000 / 60);\n}\nvar requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame;\n\nvar CenteredDiv = function () {\n  function CenteredDiv() {\n    classCallCheck(this, CenteredDiv);\n    this.backgroundElement = document.createElement('div');\n    Common.extend(this.backgroundElement.style, {\n      backgroundColor: 'rgba(0,0,0,0.8)',\n      top: 0,\n      left: 0,\n      display: 'none',\n      zIndex: '1000',\n      opacity: 0,\n      WebkitTransition: 'opacity 0.2s linear',\n      transition: 'opacity 0.2s linear'\n    });\n    dom.makeFullscreen(this.backgroundElement);\n    this.backgroundElement.style.position = 'fixed';\n    this.domElement = document.createElement('div');\n    Common.extend(this.domElement.style, {\n      position: 'fixed',\n      display: 'none',\n      zIndex: '1001',\n      opacity: 0,\n      WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',\n      transition: 'transform 0.2s ease-out, opacity 0.2s linear'\n    });\n    document.body.appendChild(this.backgroundElement);\n    document.body.appendChild(this.domElement);\n    var _this = this;\n    dom.bind(this.backgroundElement, 'click', function () {\n      _this.hide();\n    });\n  }\n  createClass(CenteredDiv, [{\n    key: 'show',\n    value: function show() {\n      var _this = this;\n      this.backgroundElement.style.display = 'block';\n      this.domElement.style.display = 'block';\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n      this.layout();\n      Common.defer(function () {\n        _this.backgroundElement.style.opacity = 1;\n        _this.domElement.style.opacity = 1;\n        _this.domElement.style.webkitTransform = 'scale(1)';\n      });\n    }\n  }, {\n    key: 'hide',\n    value: function hide() {\n      var _this = this;\n      var hide = function hide() {\n        _this.domElement.style.display = 'none';\n        _this.backgroundElement.style.display = 'none';\n        dom.unbind(_this.domElement, 'webkitTransitionEnd', hide);\n        dom.unbind(_this.domElement, 'transitionend', hide);\n        dom.unbind(_this.domElement, 'oTransitionEnd', hide);\n      };\n      dom.bind(this.domElement, 'webkitTransitionEnd', hide);\n      dom.bind(this.domElement, 'transitionend', hide);\n      dom.bind(this.domElement, 'oTransitionEnd', hide);\n      this.backgroundElement.style.opacity = 0;\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n    }\n  }, {\n    key: 'layout',\n    value: function layout() {\n      this.domElement.style.left = window.innerWidth / 2 - dom.getWidth(this.domElement) / 2 + 'px';\n      this.domElement.style.top = window.innerHeight / 2 - dom.getHeight(this.domElement) / 2 + 'px';\n    }\n  }]);\n  return CenteredDiv;\n}();\n\n// var styleSheet = ___$insertStyle(\".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\");\n\n// css.inject(styleSheet);\nvar CSS_NAMESPACE = 'dg';\nvar HIDE_KEY_CODE = 72;\nvar CLOSE_BUTTON_HEIGHT = 20;\nvar DEFAULT_DEFAULT_PRESET_NAME = 'Default';\nvar SUPPORTS_LOCAL_STORAGE = function () {\n  try {\n    return 'localStorage' in window && window.localStorage !== null;\n  } catch (e) {\n    return false;\n  }\n}();\nvar SAVE_DIALOGUE = void 0;\nvar autoPlaceVirgin = true;\nvar autoPlaceContainer = void 0;\nvar hide = false;\nvar hideableGuis = [];\nvar GUI = function GUI(pars) {\n  var _this = this;\n  var params = pars || {};\n  this.domElement = document.createElement('div');\n  this.__ul = document.createElement('ul');\n  this.domElement.appendChild(this.__ul);\n  dom.addClass(this.domElement, CSS_NAMESPACE);\n  this.__folders = {};\n  this.__controllers = [];\n  this.__rememberedObjects = [];\n  this.__rememberedObjectIndecesToControllers = [];\n  this.__listening = [];\n  params = Common.defaults(params, {\n    closeOnTop: false,\n    autoPlace: true,\n    width: GUI.DEFAULT_WIDTH\n  });\n  params = Common.defaults(params, {\n    resizable: params.autoPlace,\n    hideable: params.autoPlace\n  });\n  if (!Common.isUndefined(params.load)) {\n    if (params.preset) {\n      params.load.preset = params.preset;\n    }\n  } else {\n    params.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\n  }\n  if (Common.isUndefined(params.parent) && params.hideable) {\n    hideableGuis.push(this);\n  }\n  params.resizable = Common.isUndefined(params.parent) && params.resizable;\n  if (params.autoPlace && Common.isUndefined(params.scrollable)) {\n    params.scrollable = true;\n  }\n  var useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(this, 'isLocal')) === 'true';\n  var saveToLocalStorage = void 0;\n  Object.defineProperties(this,\n  {\n    parent: {\n      get: function get$$1() {\n        return params.parent;\n      }\n    },\n    scrollable: {\n      get: function get$$1() {\n        return params.scrollable;\n      }\n    },\n    autoPlace: {\n      get: function get$$1() {\n        return params.autoPlace;\n      }\n    },\n    closeOnTop: {\n      get: function get$$1() {\n        return params.closeOnTop;\n      }\n    },\n    preset: {\n      get: function get$$1() {\n        if (_this.parent) {\n          return _this.getRoot().preset;\n        }\n        return params.load.preset;\n      },\n      set: function set$$1(v) {\n        if (_this.parent) {\n          _this.getRoot().preset = v;\n        } else {\n          params.load.preset = v;\n        }\n        setPresetSelectIndex(this);\n        _this.revert();\n      }\n    },\n    width: {\n      get: function get$$1() {\n        return params.width;\n      },\n      set: function set$$1(v) {\n        params.width = v;\n        setWidth(_this, v);\n      }\n    },\n    name: {\n      get: function get$$1() {\n        return params.name;\n      },\n      set: function set$$1(v) {\n        params.name = v;\n        if (titleRowName) {\n          titleRowName.innerHTML = params.name;\n        }\n      }\n    },\n    closed: {\n      get: function get$$1() {\n        return params.closed;\n      },\n      set: function set$$1(v) {\n        params.closed = v;\n        if (params.closed) {\n          dom.addClass(_this.__ul, GUI.CLASS_CLOSED);\n        } else {\n          dom.removeClass(_this.__ul, GUI.CLASS_CLOSED);\n        }\n        this.onResize();\n        if (_this.__closeButton) {\n          _this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\n        }\n      }\n    },\n    load: {\n      get: function get$$1() {\n        return params.load;\n      }\n    },\n    useLocalStorage: {\n      get: function get$$1() {\n        return useLocalStorage;\n      },\n      set: function set$$1(bool) {\n        if (SUPPORTS_LOCAL_STORAGE) {\n          useLocalStorage = bool;\n          if (bool) {\n            dom.bind(window, 'unload', saveToLocalStorage);\n          } else {\n            dom.unbind(window, 'unload', saveToLocalStorage);\n          }\n          localStorage.setItem(getLocalStorageHash(_this, 'isLocal'), bool);\n        }\n      }\n    }\n  });\n  if (Common.isUndefined(params.parent)) {\n    params.closed = false;\n    dom.addClass(this.domElement, GUI.CLASS_MAIN);\n    dom.makeSelectable(this.domElement, false);\n    if (SUPPORTS_LOCAL_STORAGE) {\n      if (useLocalStorage) {\n        _this.useLocalStorage = true;\n        var savedGui = localStorage.getItem(getLocalStorageHash(this, 'gui'));\n        if (savedGui) {\n          params.load = JSON.parse(savedGui);\n        }\n      }\n    }\n    this.__closeButton = document.createElement('div');\n    this.__closeButton.innerHTML = GUI.TEXT_CLOSED;\n    dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BUTTON);\n    if (params.closeOnTop) {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_TOP);\n      this.domElement.insertBefore(this.__closeButton, this.domElement.childNodes[0]);\n    } else {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BOTTOM);\n      this.domElement.appendChild(this.__closeButton);\n    }\n    dom.bind(this.__closeButton, 'click', function () {\n      _this.closed = !_this.closed;\n    });\n  } else {\n    if (params.closed === undefined) {\n      params.closed = true;\n    }\n    var _titleRowName = document.createTextNode(params.name);\n    dom.addClass(_titleRowName, 'controller-name');\n    var titleRow = addRow(_this, _titleRowName);\n    var onClickTitle = function onClickTitle(e) {\n      e.preventDefault();\n      _this.closed = !_this.closed;\n      return false;\n    };\n    dom.addClass(this.__ul, GUI.CLASS_CLOSED);\n    dom.addClass(titleRow, 'title');\n    dom.bind(titleRow, 'click', onClickTitle);\n    if (!params.closed) {\n      this.closed = false;\n    }\n  }\n  if (params.autoPlace) {\n    if (Common.isUndefined(params.parent)) {\n      if (autoPlaceVirgin) {\n        autoPlaceContainer = document.createElement('div');\n        dom.addClass(autoPlaceContainer, CSS_NAMESPACE);\n        dom.addClass(autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER);\n        document.body.appendChild(autoPlaceContainer);\n        autoPlaceVirgin = false;\n      }\n      autoPlaceContainer.appendChild(this.domElement);\n      dom.addClass(this.domElement, GUI.CLASS_AUTO_PLACE);\n    }\n    if (!this.parent) {\n      setWidth(_this, params.width);\n    }\n  }\n  this.__resizeHandler = function () {\n    _this.onResizeDebounced();\n  };\n  dom.bind(window, 'resize', this.__resizeHandler);\n  dom.bind(this.__ul, 'webkitTransitionEnd', this.__resizeHandler);\n  dom.bind(this.__ul, 'transitionend', this.__resizeHandler);\n  dom.bind(this.__ul, 'oTransitionEnd', this.__resizeHandler);\n  this.onResize();\n  if (params.resizable) {\n    addResizeHandle(this);\n  }\n  saveToLocalStorage = function saveToLocalStorage() {\n    if (SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(_this, 'isLocal')) === 'true') {\n      localStorage.setItem(getLocalStorageHash(_this, 'gui'), JSON.stringify(_this.getSaveObject()));\n    }\n  };\n  this.saveToLocalStorageIfPossible = saveToLocalStorage;\n  function resetWidth() {\n    var root = _this.getRoot();\n    root.width += 1;\n    Common.defer(function () {\n      root.width -= 1;\n    });\n  }\n  if (!params.parent) {\n    resetWidth();\n  }\n};\nGUI.toggleHide = function () {\n  hide = !hide;\n  Common.each(hideableGuis, function (gui) {\n    gui.domElement.style.display = hide ? 'none' : '';\n  });\n};\nGUI.CLASS_AUTO_PLACE = 'a';\nGUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\nGUI.CLASS_MAIN = 'main';\nGUI.CLASS_CONTROLLER_ROW = 'cr';\nGUI.CLASS_TOO_TALL = 'taller-than-window';\nGUI.CLASS_CLOSED = 'closed';\nGUI.CLASS_CLOSE_BUTTON = 'close-button';\nGUI.CLASS_CLOSE_TOP = 'close-top';\nGUI.CLASS_CLOSE_BOTTOM = 'close-bottom';\nGUI.CLASS_DRAG = 'drag';\nGUI.DEFAULT_WIDTH = 245;\nGUI.TEXT_CLOSED = 'Close Controls';\nGUI.TEXT_OPEN = 'Open Controls';\nGUI._keydownHandler = function (e) {\n  if (document.activeElement.type !== 'text' && (e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE)) {\n    GUI.toggleHide();\n  }\n};\ndom.bind(window, 'keydown', GUI._keydownHandler, false);\nCommon.extend(GUI.prototype,\n{\n  add: function add(object, property) {\n    return _add(this, object, property, {\n      factoryArgs: Array.prototype.slice.call(arguments, 2)\n    });\n  },\n  addColor: function addColor(object, property) {\n    return _add(this, object, property, {\n      color: true\n    });\n  },\n  remove: function remove(controller) {\n    this.__ul.removeChild(controller.__li);\n    this.__controllers.splice(this.__controllers.indexOf(controller), 1);\n    var _this = this;\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  destroy: function destroy() {\n    if (this.parent) {\n      throw new Error('Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.');\n    }\n    if (this.autoPlace) {\n      autoPlaceContainer.removeChild(this.domElement);\n    }\n    var _this = this;\n    Common.each(this.__folders, function (subfolder) {\n      _this.removeFolder(subfolder);\n    });\n    dom.unbind(window, 'keydown', GUI._keydownHandler, false);\n    removeListeners(this);\n  },\n  addFolder: function addFolder(name) {\n    if (this.__folders[name] !== undefined) {\n      throw new Error('You already have a folder in this GUI by the' + ' name \"' + name + '\"');\n    }\n    var newGuiParams = { name: name, parent: this };\n    newGuiParams.autoPlace = this.autoPlace;\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[name]) {\n      newGuiParams.closed = this.load.folders[name].closed;\n      newGuiParams.load = this.load.folders[name];\n    }\n    var gui = new GUI(newGuiParams);\n    this.__folders[name] = gui;\n    var li = addRow(this, gui.domElement);\n    dom.addClass(li, 'folder');\n    return gui;\n  },\n  removeFolder: function removeFolder(folder) {\n    this.__ul.removeChild(folder.domElement.parentElement);\n    delete this.__folders[folder.name];\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[folder.name]) {\n      delete this.load.folders[folder.name];\n    }\n    removeListeners(folder);\n    var _this = this;\n    Common.each(folder.__folders, function (subfolder) {\n      folder.removeFolder(subfolder);\n    });\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  open: function open() {\n    this.closed = false;\n  },\n  close: function close() {\n    this.closed = true;\n  },\n  onResize: function onResize() {\n    var root = this.getRoot();\n    if (root.scrollable) {\n      var top = dom.getOffset(root.__ul).top;\n      var h = 0;\n      Common.each(root.__ul.childNodes, function (node) {\n        if (!(root.autoPlace && node === root.__save_row)) {\n          h += dom.getHeight(node);\n        }\n      });\n      if (window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h) {\n        dom.addClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\n      } else {\n        dom.removeClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = 'auto';\n      }\n    }\n    if (root.__resize_handle) {\n      Common.defer(function () {\n        root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\n      });\n    }\n    if (root.__closeButton) {\n      root.__closeButton.style.width = root.width + 'px';\n    }\n  },\n  onResizeDebounced: Common.debounce(function () {\n    this.onResize();\n  }, 50),\n  remember: function remember() {\n    if (Common.isUndefined(SAVE_DIALOGUE)) {\n      SAVE_DIALOGUE = new CenteredDiv();\n      SAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;\n    }\n    if (this.parent) {\n      throw new Error('You can only call remember on a top level GUI.');\n    }\n    var _this = this;\n    Common.each(Array.prototype.slice.call(arguments), function (object) {\n      if (_this.__rememberedObjects.length === 0) {\n        addSaveMenu(_this);\n      }\n      if (_this.__rememberedObjects.indexOf(object) === -1) {\n        _this.__rememberedObjects.push(object);\n      }\n    });\n    if (this.autoPlace) {\n      setWidth(this, this.width);\n    }\n  },\n  getRoot: function getRoot() {\n    var gui = this;\n    while (gui.parent) {\n      gui = gui.parent;\n    }\n    return gui;\n  },\n  getSaveObject: function getSaveObject() {\n    var toReturn = this.load;\n    toReturn.closed = this.closed;\n    if (this.__rememberedObjects.length > 0) {\n      toReturn.preset = this.preset;\n      if (!toReturn.remembered) {\n        toReturn.remembered = {};\n      }\n      toReturn.remembered[this.preset] = getCurrentPreset(this);\n    }\n    toReturn.folders = {};\n    Common.each(this.__folders, function (element, key) {\n      toReturn.folders[key] = element.getSaveObject();\n    });\n    return toReturn;\n  },\n  save: function save() {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n    }\n    this.load.remembered[this.preset] = getCurrentPreset(this);\n    markPresetModified(this, false);\n    this.saveToLocalStorageIfPossible();\n  },\n  saveAs: function saveAs(presetName) {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n      this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME] = getCurrentPreset(this, true);\n    }\n    this.load.remembered[presetName] = getCurrentPreset(this);\n    this.preset = presetName;\n    addPresetOption(this, presetName, true);\n    this.saveToLocalStorageIfPossible();\n  },\n  revert: function revert(gui) {\n    Common.each(this.__controllers, function (controller) {\n      if (!this.getRoot().load.remembered) {\n        controller.setValue(controller.initialValue);\n      } else {\n        recallSavedValue(gui || this.getRoot(), controller);\n      }\n      if (controller.__onFinishChange) {\n        controller.__onFinishChange.call(controller, controller.getValue());\n      }\n    }, this);\n    Common.each(this.__folders, function (folder) {\n      folder.revert(folder);\n    });\n    if (!gui) {\n      markPresetModified(this.getRoot(), false);\n    }\n  },\n  listen: function listen(controller) {\n    var init = this.__listening.length === 0;\n    this.__listening.push(controller);\n    if (init) {\n      updateDisplays(this.__listening);\n    }\n  },\n  updateDisplay: function updateDisplay() {\n    Common.each(this.__controllers, function (controller) {\n      controller.updateDisplay();\n    });\n    Common.each(this.__folders, function (folder) {\n      folder.updateDisplay();\n    });\n  }\n});\nfunction addRow(gui, newDom, liBefore) {\n  var li = document.createElement('li');\n  if (newDom) {\n    li.appendChild(newDom);\n  }\n  if (liBefore) {\n    gui.__ul.insertBefore(li, liBefore);\n  } else {\n    gui.__ul.appendChild(li);\n  }\n  gui.onResize();\n  return li;\n}\nfunction removeListeners(gui) {\n  dom.unbind(window, 'resize', gui.__resizeHandler);\n  if (gui.saveToLocalStorageIfPossible) {\n    dom.unbind(window, 'unload', gui.saveToLocalStorageIfPossible);\n  }\n}\nfunction markPresetModified(gui, modified) {\n  var opt = gui.__preset_select[gui.__preset_select.selectedIndex];\n  if (modified) {\n    opt.innerHTML = opt.value + '*';\n  } else {\n    opt.innerHTML = opt.value;\n  }\n}\nfunction augmentController(gui, li, controller) {\n  controller.__li = li;\n  controller.__gui = gui;\n  Common.extend(controller,                                   {\n    options: function options(_options) {\n      if (arguments.length > 1) {\n        var nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: nextSibling,\n          factoryArgs: [Common.toArray(arguments)]\n        });\n      }\n      if (Common.isArray(_options) || Common.isObject(_options)) {\n        var _nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: _nextSibling,\n          factoryArgs: [_options]\n        });\n      }\n    },\n    name: function name(_name) {\n      controller.__li.firstElementChild.firstElementChild.innerHTML = _name;\n      return controller;\n    },\n    listen: function listen() {\n      controller.__gui.listen(controller);\n      return controller;\n    },\n    remove: function remove() {\n      controller.__gui.remove(controller);\n      return controller;\n    }\n  });\n  if (controller instanceof NumberControllerSlider) {\n    var box = new NumberControllerBox(controller.object, controller.property, { min: controller.__min, max: controller.__max, step: controller.__step });\n    Common.each(['updateDisplay', 'onChange', 'onFinishChange', 'step'], function (method) {\n      var pc = controller[method];\n      var pb = box[method];\n      controller[method] = box[method] = function () {\n        var args = Array.prototype.slice.call(arguments);\n        pb.apply(box, args);\n        return pc.apply(controller, args);\n      };\n    });\n    dom.addClass(li, 'has-slider');\n    controller.domElement.insertBefore(box.domElement, controller.domElement.firstElementChild);\n  } else if (controller instanceof NumberControllerBox) {\n    var r = function r(returned) {\n      if (Common.isNumber(controller.__min) && Common.isNumber(controller.__max)) {\n        var oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;\n        var wasListening = controller.__gui.__listening.indexOf(controller) > -1;\n        controller.remove();\n        var newController = _add(gui, controller.object, controller.property, {\n          before: controller.__li.nextElementSibling,\n          factoryArgs: [controller.__min, controller.__max, controller.__step]\n        });\n        newController.name(oldName);\n        if (wasListening) newController.listen();\n        return newController;\n      }\n      return returned;\n    };\n    controller.min = Common.compose(r, controller.min);\n    controller.max = Common.compose(r, controller.max);\n  } else if (controller instanceof BooleanController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__checkbox, 'click');\n    });\n    dom.bind(controller.__checkbox, 'click', function (e) {\n      e.stopPropagation();\n    });\n  } else if (controller instanceof FunctionController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__button, 'click');\n    });\n    dom.bind(li, 'mouseover', function () {\n      dom.addClass(controller.__button, 'hover');\n    });\n    dom.bind(li, 'mouseout', function () {\n      dom.removeClass(controller.__button, 'hover');\n    });\n  } else if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n    controller.updateDisplay = Common.compose(function (val) {\n      li.style.borderLeftColor = controller.__color.toString();\n      return val;\n    }, controller.updateDisplay);\n    controller.updateDisplay();\n  }\n  controller.setValue = Common.compose(function (val) {\n    if (gui.getRoot().__preset_select && controller.isModified()) {\n      markPresetModified(gui.getRoot(), true);\n    }\n    return val;\n  }, controller.setValue);\n}\nfunction recallSavedValue(gui, controller) {\n  var root = gui.getRoot();\n  var matchedIndex = root.__rememberedObjects.indexOf(controller.object);\n  if (matchedIndex !== -1) {\n    var controllerMap = root.__rememberedObjectIndecesToControllers[matchedIndex];\n    if (controllerMap === undefined) {\n      controllerMap = {};\n      root.__rememberedObjectIndecesToControllers[matchedIndex] = controllerMap;\n    }\n    controllerMap[controller.property] = controller;\n    if (root.load && root.load.remembered) {\n      var presetMap = root.load.remembered;\n      var preset = void 0;\n      if (presetMap[gui.preset]) {\n        preset = presetMap[gui.preset];\n      } else if (presetMap[DEFAULT_DEFAULT_PRESET_NAME]) {\n        preset = presetMap[DEFAULT_DEFAULT_PRESET_NAME];\n      } else {\n        return;\n      }\n      if (preset[matchedIndex] && preset[matchedIndex][controller.property] !== undefined) {\n        var value = preset[matchedIndex][controller.property];\n        controller.initialValue = value;\n        controller.setValue(value);\n      }\n    }\n  }\n}\nfunction _add(gui, object, property, params) {\n  if (object[property] === undefined) {\n    throw new Error('Object \"' + object + '\" has no property \"' + property + '\"');\n  }\n  var controller = void 0;\n  if (params.color) {\n    controller = new ColorController(object, property);\n  } else {\n    var factoryArgs = [object, property].concat(params.factoryArgs);\n    controller = ControllerFactory.apply(gui, factoryArgs);\n  }\n  if (params.before instanceof Controller) {\n    params.before = params.before.__li;\n  }\n  recallSavedValue(gui, controller);\n  dom.addClass(controller.domElement, 'c');\n  var name = document.createElement('span');\n  dom.addClass(name, 'property-name');\n  name.innerHTML = controller.property;\n  var container = document.createElement('div');\n  container.appendChild(name);\n  container.appendChild(controller.domElement);\n  var li = addRow(gui, container, params.before);\n  dom.addClass(li, GUI.CLASS_CONTROLLER_ROW);\n  if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n  } else {\n    dom.addClass(li, _typeof(controller.getValue()));\n  }\n  augmentController(gui, li, controller);\n  gui.__controllers.push(controller);\n  return controller;\n}\nfunction getLocalStorageHash(gui, key) {\n  return document.location.href + '.' + key;\n}\nfunction addPresetOption(gui, name, setSelected) {\n  var opt = document.createElement('option');\n  opt.innerHTML = name;\n  opt.value = name;\n  gui.__preset_select.appendChild(opt);\n  if (setSelected) {\n    gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\n  }\n}\nfunction showHideExplain(gui, explain) {\n  explain.style.display = gui.useLocalStorage ? 'block' : 'none';\n}\nfunction addSaveMenu(gui) {\n  var div = gui.__save_row = document.createElement('li');\n  dom.addClass(gui.domElement, 'has-save');\n  gui.__ul.insertBefore(div, gui.__ul.firstChild);\n  dom.addClass(div, 'save-row');\n  var gears = document.createElement('span');\n  gears.innerHTML = '&nbsp;';\n  dom.addClass(gears, 'button gears');\n  var button = document.createElement('span');\n  button.innerHTML = 'Save';\n  dom.addClass(button, 'button');\n  dom.addClass(button, 'save');\n  var button2 = document.createElement('span');\n  button2.innerHTML = 'New';\n  dom.addClass(button2, 'button');\n  dom.addClass(button2, 'save-as');\n  var button3 = document.createElement('span');\n  button3.innerHTML = 'Revert';\n  dom.addClass(button3, 'button');\n  dom.addClass(button3, 'revert');\n  var select = gui.__preset_select = document.createElement('select');\n  if (gui.load && gui.load.remembered) {\n    Common.each(gui.load.remembered, function (value, key) {\n      addPresetOption(gui, key, key === gui.preset);\n    });\n  } else {\n    addPresetOption(gui, DEFAULT_DEFAULT_PRESET_NAME, false);\n  }\n  dom.bind(select, 'change', function () {\n    for (var index = 0; index < gui.__preset_select.length; index++) {\n      gui.__preset_select[index].innerHTML = gui.__preset_select[index].value;\n    }\n    gui.preset = this.value;\n  });\n  div.appendChild(select);\n  div.appendChild(gears);\n  div.appendChild(button);\n  div.appendChild(button2);\n  div.appendChild(button3);\n  if (SUPPORTS_LOCAL_STORAGE) {\n    var explain = document.getElementById('dg-local-explain');\n    var localStorageCheckBox = document.getElementById('dg-local-storage');\n    var saveLocally = document.getElementById('dg-save-locally');\n    saveLocally.style.display = 'block';\n    if (localStorage.getItem(getLocalStorageHash(gui, 'isLocal')) === 'true') {\n      localStorageCheckBox.setAttribute('checked', 'checked');\n    }\n    showHideExplain(gui, explain);\n    dom.bind(localStorageCheckBox, 'change', function () {\n      gui.useLocalStorage = !gui.useLocalStorage;\n      showHideExplain(gui, explain);\n    });\n  }\n  var newConstructorTextArea = document.getElementById('dg-new-constructor');\n  dom.bind(newConstructorTextArea, 'keydown', function (e) {\n    if (e.metaKey && (e.which === 67 || e.keyCode === 67)) {\n      SAVE_DIALOGUE.hide();\n    }\n  });\n  dom.bind(gears, 'click', function () {\n    newConstructorTextArea.innerHTML = JSON.stringify(gui.getSaveObject(), undefined, 2);\n    SAVE_DIALOGUE.show();\n    newConstructorTextArea.focus();\n    newConstructorTextArea.select();\n  });\n  dom.bind(button, 'click', function () {\n    gui.save();\n  });\n  dom.bind(button2, 'click', function () {\n    var presetName = prompt('Enter a new preset name.');\n    if (presetName) {\n      gui.saveAs(presetName);\n    }\n  });\n  dom.bind(button3, 'click', function () {\n    gui.revert();\n  });\n}\nfunction addResizeHandle(gui) {\n  var pmouseX = void 0;\n  gui.__resize_handle = document.createElement('div');\n  Common.extend(gui.__resize_handle.style, {\n    width: '6px',\n    marginLeft: '-3px',\n    height: '200px',\n    cursor: 'ew-resize',\n    position: 'absolute'\n  });\n  function drag(e) {\n    e.preventDefault();\n    gui.width += pmouseX - e.clientX;\n    gui.onResize();\n    pmouseX = e.clientX;\n    return false;\n  }\n  function dragStop() {\n    dom.removeClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.unbind(window, 'mousemove', drag);\n    dom.unbind(window, 'mouseup', dragStop);\n  }\n  function dragStart(e) {\n    e.preventDefault();\n    pmouseX = e.clientX;\n    dom.addClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.bind(window, 'mousemove', drag);\n    dom.bind(window, 'mouseup', dragStop);\n    return false;\n  }\n  dom.bind(gui.__resize_handle, 'mousedown', dragStart);\n  dom.bind(gui.__closeButton, 'mousedown', dragStart);\n  gui.domElement.insertBefore(gui.__resize_handle, gui.domElement.firstElementChild);\n}\nfunction setWidth(gui, w) {\n  gui.domElement.style.width = w + 'px';\n  if (gui.__save_row && gui.autoPlace) {\n    gui.__save_row.style.width = w + 'px';\n  }\n  if (gui.__closeButton) {\n    gui.__closeButton.style.width = w + 'px';\n  }\n}\nfunction getCurrentPreset(gui, useInitialValues) {\n  var toReturn = {};\n  Common.each(gui.__rememberedObjects, function (val, index) {\n    var savedValues = {};\n    var controllerMap = gui.__rememberedObjectIndecesToControllers[index];\n    Common.each(controllerMap, function (controller, property) {\n      savedValues[property] = useInitialValues ? controller.initialValue : controller.getValue();\n    });\n    toReturn[index] = savedValues;\n  });\n  return toReturn;\n}\nfunction setPresetSelectIndex(gui) {\n  for (var index = 0; index < gui.__preset_select.length; index++) {\n    if (gui.__preset_select[index].value === gui.preset) {\n      gui.__preset_select.selectedIndex = index;\n    }\n  }\n}\nfunction updateDisplays(controllerArray) {\n  if (controllerArray.length !== 0) {\n    requestAnimationFrame$1.call(window, function () {\n      updateDisplays(controllerArray);\n    });\n  }\n  Common.each(controllerArray, function (c) {\n    c.updateDisplay();\n  });\n}\n\nvar index = {\n  color: {\n    Color: Color,\n    math: ColorMath,\n    interpret: interpret\n  },\n  controllers: {\n    Controller: Controller,\n    BooleanController: BooleanController,\n    OptionController: OptionController,\n    StringController: StringController,\n    NumberController: NumberController,\n    NumberControllerBox: NumberControllerBox,\n    NumberControllerSlider: NumberControllerSlider,\n    FunctionController: FunctionController,\n    ColorController: ColorController\n  },\n  dom: {\n    dom: dom\n  },\n  gui: {\n    GUI: GUI\n  },\n  GUI: GUI\n};\n\nreturn index;\n\n})));\n//# sourceMappingURL=dat.gui.js.map\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/utils/dat.gui.js?");

/***/ }),

/***/ "./src/js/lib/utils/inflate.min.js":
/*!*****************************************!*\
  !*** ./src/js/lib/utils/inflate.min.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function() {'use strict';var l=void 0,aa=this;function r(c,d){var a=c.split(\".\"),b=aa;!(a[0]in b)&&b.execScript&&b.execScript(\"var \"+a[0]);for(var e;a.length&&(e=a.shift());)!a.length&&d!==l?b[e]=d:b=b[e]?b[e]:b[e]={}};var t=\"undefined\"!==typeof Uint8Array&&\"undefined\"!==typeof Uint16Array&&\"undefined\"!==typeof Uint32Array&&\"undefined\"!==typeof DataView;function v(c){var d=c.length,a=0,b=Number.POSITIVE_INFINITY,e,f,g,h,k,m,n,p,s,x;for(p=0;p<d;++p)c[p]>a&&(a=c[p]),c[p]<b&&(b=c[p]);e=1<<a;f=new (t?Uint32Array:Array)(e);g=1;h=0;for(k=2;g<=a;){for(p=0;p<d;++p)if(c[p]===g){m=0;n=h;for(s=0;s<g;++s)m=m<<1|n&1,n>>=1;x=g<<16|p;for(s=m;s<e;s+=k)f[s]=x;++h}++g;h<<=1;k<<=1}return[f,a,b]};function w(c,d){this.g=[];this.h=32768;this.d=this.f=this.a=this.l=0;this.input=t?new Uint8Array(c):c;this.m=!1;this.i=y;this.r=!1;if(d||!(d={}))d.index&&(this.a=d.index),d.bufferSize&&(this.h=d.bufferSize),d.bufferType&&(this.i=d.bufferType),d.resize&&(this.r=d.resize);switch(this.i){case A:this.b=32768;this.c=new (t?Uint8Array:Array)(32768+this.h+258);break;case y:this.b=0;this.c=new (t?Uint8Array:Array)(this.h);this.e=this.z;this.n=this.v;this.j=this.w;break;default:throw Error(\"invalid inflate mode\");\n}}var A=0,y=1,B={t:A,s:y};\nw.prototype.k=function(){for(;!this.m;){var c=C(this,3);c&1&&(this.m=!0);c>>>=1;switch(c){case 0:var d=this.input,a=this.a,b=this.c,e=this.b,f=d.length,g=l,h=l,k=b.length,m=l;this.d=this.f=0;if(a+1>=f)throw Error(\"invalid uncompressed block header: LEN\");g=d[a++]|d[a++]<<8;if(a+1>=f)throw Error(\"invalid uncompressed block header: NLEN\");h=d[a++]|d[a++]<<8;if(g===~h)throw Error(\"invalid uncompressed block header: length verify\");if(a+g>d.length)throw Error(\"input buffer is broken\");switch(this.i){case A:for(;e+\ng>b.length;){m=k-e;g-=m;if(t)b.set(d.subarray(a,a+m),e),e+=m,a+=m;else for(;m--;)b[e++]=d[a++];this.b=e;b=this.e();e=this.b}break;case y:for(;e+g>b.length;)b=this.e({p:2});break;default:throw Error(\"invalid inflate mode\");}if(t)b.set(d.subarray(a,a+g),e),e+=g,a+=g;else for(;g--;)b[e++]=d[a++];this.a=a;this.b=e;this.c=b;break;case 1:this.j(ba,ca);break;case 2:for(var n=C(this,5)+257,p=C(this,5)+1,s=C(this,4)+4,x=new (t?Uint8Array:Array)(D.length),S=l,T=l,U=l,u=l,M=l,F=l,z=l,q=l,V=l,q=0;q<s;++q)x[D[q]]=\nC(this,3);if(!t){q=s;for(s=x.length;q<s;++q)x[D[q]]=0}S=v(x);u=new (t?Uint8Array:Array)(n+p);q=0;for(V=n+p;q<V;)switch(M=E(this,S),M){case 16:for(z=3+C(this,2);z--;)u[q++]=F;break;case 17:for(z=3+C(this,3);z--;)u[q++]=0;F=0;break;case 18:for(z=11+C(this,7);z--;)u[q++]=0;F=0;break;default:F=u[q++]=M}T=t?v(u.subarray(0,n)):v(u.slice(0,n));U=t?v(u.subarray(n)):v(u.slice(n));this.j(T,U);break;default:throw Error(\"unknown BTYPE: \"+c);}}return this.n()};\nvar G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=t?new Uint16Array(G):G,H=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],I=t?new Uint16Array(H):H,J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],K=t?new Uint8Array(J):J,L=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],da=t?new Uint16Array(L):L,ea=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,\n13,13],N=t?new Uint8Array(ea):ea,O=new (t?Uint8Array:Array)(288),P,fa;P=0;for(fa=O.length;P<fa;++P)O[P]=143>=P?8:255>=P?9:279>=P?7:8;var ba=v(O),Q=new (t?Uint8Array:Array)(30),R,ga;R=0;for(ga=Q.length;R<ga;++R)Q[R]=5;var ca=v(Q);function C(c,d){for(var a=c.f,b=c.d,e=c.input,f=c.a,g=e.length,h;b<d;){if(f>=g)throw Error(\"input buffer is broken\");a|=e[f++]<<b;b+=8}h=a&(1<<d)-1;c.f=a>>>d;c.d=b-d;c.a=f;return h}\nfunction E(c,d){for(var a=c.f,b=c.d,e=c.input,f=c.a,g=e.length,h=d[0],k=d[1],m,n;b<k&&!(f>=g);)a|=e[f++]<<b,b+=8;m=h[a&(1<<k)-1];n=m>>>16;if(n>b)throw Error(\"invalid code length: \"+n);c.f=a>>n;c.d=b-n;c.a=f;return m&65535}\nw.prototype.j=function(c,d){var a=this.c,b=this.b;this.o=c;for(var e=a.length-258,f,g,h,k;256!==(f=E(this,c));)if(256>f)b>=e&&(this.b=b,a=this.e(),b=this.b),a[b++]=f;else{g=f-257;k=I[g];0<K[g]&&(k+=C(this,K[g]));f=E(this,d);h=da[f];0<N[f]&&(h+=C(this,N[f]));b>=e&&(this.b=b,a=this.e(),b=this.b);for(;k--;)a[b]=a[b++-h]}for(;8<=this.d;)this.d-=8,this.a--;this.b=b};\nw.prototype.w=function(c,d){var a=this.c,b=this.b;this.o=c;for(var e=a.length,f,g,h,k;256!==(f=E(this,c));)if(256>f)b>=e&&(a=this.e(),e=a.length),a[b++]=f;else{g=f-257;k=I[g];0<K[g]&&(k+=C(this,K[g]));f=E(this,d);h=da[f];0<N[f]&&(h+=C(this,N[f]));b+k>e&&(a=this.e(),e=a.length);for(;k--;)a[b]=a[b++-h]}for(;8<=this.d;)this.d-=8,this.a--;this.b=b};\nw.prototype.e=function(){var c=new (t?Uint8Array:Array)(this.b-32768),d=this.b-32768,a,b,e=this.c;if(t)c.set(e.subarray(32768,c.length));else{a=0;for(b=c.length;a<b;++a)c[a]=e[a+32768]}this.g.push(c);this.l+=c.length;if(t)e.set(e.subarray(d,d+32768));else for(a=0;32768>a;++a)e[a]=e[d+a];this.b=32768;return e};\nw.prototype.z=function(c){var d,a=this.input.length/this.a+1|0,b,e,f,g=this.input,h=this.c;c&&(\"number\"===typeof c.p&&(a=c.p),\"number\"===typeof c.u&&(a+=c.u));2>a?(b=(g.length-this.a)/this.o[2],f=258*(b/2)|0,e=f<h.length?h.length+f:h.length<<1):e=h.length*a;t?(d=new Uint8Array(e),d.set(h)):d=h;return this.c=d};\nw.prototype.n=function(){var c=0,d=this.c,a=this.g,b,e=new (t?Uint8Array:Array)(this.l+(this.b-32768)),f,g,h,k;if(0===a.length)return t?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);f=0;for(g=a.length;f<g;++f){b=a[f];h=0;for(k=b.length;h<k;++h)e[c++]=b[h]}f=32768;for(g=this.b;f<g;++f)e[c++]=d[f];this.g=[];return this.buffer=e};\nw.prototype.v=function(){var c,d=this.b;t?this.r?(c=new Uint8Array(d),c.set(this.c.subarray(0,d))):c=this.c.subarray(0,d):(this.c.length>d&&(this.c.length=d),c=this.c);return this.buffer=c};function W(c,d){var a,b;this.input=c;this.a=0;if(d||!(d={}))d.index&&(this.a=d.index),d.verify&&(this.A=d.verify);a=c[this.a++];b=c[this.a++];switch(a&15){case ha:this.method=ha;break;default:throw Error(\"unsupported compression method\");}if(0!==((a<<8)+b)%31)throw Error(\"invalid fcheck flag:\"+((a<<8)+b)%31);if(b&32)throw Error(\"fdict flag is not supported\");this.q=new w(c,{index:this.a,bufferSize:d.bufferSize,bufferType:d.bufferType,resize:d.resize})}\nW.prototype.k=function(){var c=this.input,d,a;d=this.q.k();this.a=this.q.a;if(this.A){a=(c[this.a++]<<24|c[this.a++]<<16|c[this.a++]<<8|c[this.a++])>>>0;var b=d;if(\"string\"===typeof b){var e=b.split(\"\"),f,g;f=0;for(g=e.length;f<g;f++)e[f]=(e[f].charCodeAt(0)&255)>>>0;b=e}for(var h=1,k=0,m=b.length,n,p=0;0<m;){n=1024<m?1024:m;m-=n;do h+=b[p++],k+=h;while(--n);h%=65521;k%=65521}if(a!==(k<<16|h)>>>0)throw Error(\"invalid adler-32 checksum\");}return d};var ha=8;r(\"Zlib.Inflate\",W);r(\"Zlib.Inflate.prototype.decompress\",W.prototype.k);var X={ADAPTIVE:B.s,BLOCK:B.t},Y,Z,$,ia;if(Object.keys)Y=Object.keys(X);else for(Z in Y=[],$=0,X)Y[$++]=Z;$=0;for(ia=Y.length;$<ia;++$)Z=Y[$],r(\"Zlib.Inflate.BufferType.\"+Z,X[Z]);}).call(this);\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/lib/utils/inflate.min.js?");

/***/ }),

/***/ "./src/js/simulation/RelativeSpringSimulator.js":
/*!******************************************************!*\
  !*** ./src/js/simulation/RelativeSpringSimulator.js ***!
  \******************************************************/
/*! exports provided: RelativeSpringSimulator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RelativeSpringSimulator\", function() { return RelativeSpringSimulator; });\n/* harmony import */ var _SimulatorBase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SimulatorBase */ \"./src/js/simulation/SimulatorBase.js\");\n\r\n// import THREE from 'three';\r\n\r\nclass RelativeSpringSimulator extends _SimulatorBase__WEBPACK_IMPORTED_MODULE_0__[\"SimulatorBase\"] {\r\n\r\n    constructor(fps, mass, damping) {\r\n\r\n        //Construct base\r\n        super(fps);\r\n\r\n        // Simulated values\r\n        this.position = 0;\r\n        this.velocity = 0;\r\n\r\n        // Simulation parameters\r\n        this.target = 0;\r\n        this.mass = mass;\r\n        this.damping = damping;\r\n\r\n        // Last lerped position for relative output\r\n        this.lastLerp = 0;\r\n    }\r\n\r\n    /**\r\n     * Advances the simulation by given time step\r\n     * @param {number} timeStep \r\n     */\r\n    simulate(timeStep) {\r\n        \r\n        if(timeStep == undefined) console.log('Pass the timeStep!');\r\n\r\n        this.generateFrames(timeStep);\r\n        \r\n        //SpringR lerping\r\n        // Lerp from 0 to next frame\r\n        let lerp = THREE.Math.lerp(0, this.cache[1].position, this.offset / this.frameTime);\r\n\r\n        // Substract last lerp from current to make output relative\r\n        this.position = (lerp - this.lastLerp);\r\n        this.lastLerp = lerp;\r\n        \r\n        this.velocity = THREE.Math.lerp(this.cache[0].velocity, this.cache[1].velocity,  this.offset / this.frameTime);\r\n    }\r\n\r\n    /**\r\n     * Generates frames between last simulation call and the current one\r\n     * @param {timeStep} timeStep \r\n     */\r\n    generateFrames(timeStep) {\r\n\r\n        // Initialize cache by pushing two frames\r\n        if(this.cache.length == 0) {\r\n            for (let i = 0; i < 2; i++) {\r\n                this.cache.push({\r\n                    position: 0,\r\n                    velocity: 0\r\n                });\r\n            }\r\n        }\r\n\r\n        // Update cache\r\n        // Find out how many frames needs to be generated\r\n        let totalTimeStep = this.offset + timeStep;\r\n        let framesToGenerate = Math.floor(totalTimeStep / this.frameTime);\r\n        this.offset = totalTimeStep % this.frameTime;\r\n\r\n        // Generate simulation frames\r\n        if(framesToGenerate > 0) {\r\n            for (let i = 0; i < framesToGenerate; i++) {\r\n                this.cache.push(this.getFrame(i + 1 == framesToGenerate));\r\n            }\r\n            this.cache = this.cache.slice(-2);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets another simulation frame\r\n     */\r\n    getFrame(lastFrame) {\r\n\r\n        let newFrame = Object.assign({}, this.lastFrame());\r\n\r\n        if(lastFrame) {\r\n            // Reset position\r\n            newFrame.position = 0;\r\n            // Transition to next frame\r\n            this.lastLerp = this.lastLerp - this.lastFrame().position;\r\n        }\r\n\r\n        return Object(_SimulatorBase__WEBPACK_IMPORTED_MODULE_0__[\"spring\"])(newFrame.position, this.target, newFrame.velocity, this.mass, this.damping);\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/simulation/RelativeSpringSimulator.js?");

/***/ }),

/***/ "./src/js/simulation/SimulatorBase.js":
/*!********************************************!*\
  !*** ./src/js/simulation/SimulatorBase.js ***!
  \********************************************/
/*! exports provided: SimulatorBase, spring, springV */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SimulatorBase\", function() { return SimulatorBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"spring\", function() { return spring; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"springV\", function() { return springV; });\n// import THREE from 'three';\r\n\r\nclass SimulatorBase {\r\n\r\n    constructor(fps) {\r\n        this.frameTime = 1/fps;\r\n        this.offset = 0; // 0 - frameTime\r\n        this.cache = []; // At least two frames\r\n    }\r\n\r\n    set setFPS(value) {\r\n        this.frameTime = 1/value;\r\n    }\r\n\r\n    get lastFrame() {\r\n        return this.cache[this.cache.length - 1];\r\n    }\r\n}\r\n\r\nfunction spring(source, dest, velocity, mass, damping) {\r\n    let acceleration = dest - source;\r\n    acceleration /= mass;\r\n    velocity += acceleration;\r\n    velocity *= damping;\r\n\r\n    let position = source += velocity;\r\n\r\n    return { position: position, velocity: velocity };\r\n}\r\n\r\nfunction springV(source, dest, velocity, mass, damping) {\r\n    let acceleration = new THREE.Vector3().subVectors(dest, source);\r\n    acceleration.divideScalar(mass);\r\n    velocity.add(acceleration);\r\n    velocity.multiplyScalar(damping);\r\n    source.add(velocity);\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/simulation/SimulatorBase.js?");

/***/ }),

/***/ "./src/js/simulation/SpringSimulation.js":
/*!***********************************************!*\
  !*** ./src/js/simulation/SpringSimulation.js ***!
  \***********************************************/
/*! exports provided: SpringSimulator, VectorSpringSimulator, RelativeSpringSimulator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _SpringSimulator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SpringSimulator */ \"./src/js/simulation/SpringSimulator.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"SpringSimulator\", function() { return _SpringSimulator__WEBPACK_IMPORTED_MODULE_0__[\"SpringSimulator\"]; });\n\n/* harmony import */ var _VectorSpringSimulator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./VectorSpringSimulator */ \"./src/js/simulation/VectorSpringSimulator.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"VectorSpringSimulator\", function() { return _VectorSpringSimulator__WEBPACK_IMPORTED_MODULE_1__[\"VectorSpringSimulator\"]; });\n\n/* harmony import */ var _RelativeSpringSimulator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./RelativeSpringSimulator */ \"./src/js/simulation/RelativeSpringSimulator.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"RelativeSpringSimulator\", function() { return _RelativeSpringSimulator__WEBPACK_IMPORTED_MODULE_2__[\"RelativeSpringSimulator\"]; });\n\n\r\n\r\n\r\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/simulation/SpringSimulation.js?");

/***/ }),

/***/ "./src/js/simulation/SpringSimulator.js":
/*!**********************************************!*\
  !*** ./src/js/simulation/SpringSimulator.js ***!
  \**********************************************/
/*! exports provided: SpringSimulator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SpringSimulator\", function() { return SpringSimulator; });\n/* harmony import */ var _SimulatorBase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SimulatorBase */ \"./src/js/simulation/SimulatorBase.js\");\n\r\n// import THREE from 'three';\r\n\r\nclass SpringSimulator extends _SimulatorBase__WEBPACK_IMPORTED_MODULE_0__[\"SimulatorBase\"] {\r\n\r\n    constructor(fps, mass, damping) {\r\n        \r\n        // Construct base\r\n        super(fps);\r\n\r\n        // Simulated values\r\n        this.position = 0;\r\n        this.velocity = 0;\r\n    \r\n        // Simulation parameters\r\n        this.target = 0;\r\n        this.mass = mass;\r\n        this.damping = damping;\r\n    }\r\n\r\n    /**\r\n     * Advances the simulation by given time step\r\n     * @param {number} timeStep \r\n     */\r\n    simulate(timeStep) {\r\n        \r\n        if(timeStep == undefined) console.log('Pass the timeStep!');\r\n\r\n        this.generateFrames(timeStep);\r\n        \r\n        // Return values interpolated between cached frames\r\n        this.position = THREE.Math.lerp(this.cache[0].position, this.cache[1].position,  this.offset / this.frameTime);\r\n        this.velocity = THREE.Math.lerp(this.cache[0].velocity, this.cache[1].velocity,  this.offset / this.frameTime);\r\n    }\r\n\r\n    /**\r\n     * Generates frames between last simulation call and the current one\r\n     * @param {timeStep} timeStep \r\n     */\r\n    generateFrames(timeStep) {\r\n\r\n        // Initialize cache by pushing two frames\r\n        if(this.cache.length == 0) {\r\n            for (let i = 0; i < 2; i++) {\r\n                this.cache.push({\r\n                    position: 0,\r\n                    velocity: 0\r\n                });\r\n            }\r\n        }\r\n\r\n        // Update cache\r\n        // Find out how many frames needs to be generated\r\n        let totalTimeStep = this.offset + timeStep;\r\n        let framesToGenerate = Math.floor(totalTimeStep / this.frameTime);\r\n        this.offset = totalTimeStep % this.frameTime;\r\n\r\n        // Generate simulation frames\r\n        if(framesToGenerate > 0) {\r\n            for (let i = 0; i < framesToGenerate; i++) {\r\n                this.cache.push(this.getFrame());\r\n            }\r\n            this.cache = this.cache.slice(-2);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets another simulation frame\r\n     */\r\n    getFrame() {\r\n        return Object(_SimulatorBase__WEBPACK_IMPORTED_MODULE_0__[\"spring\"])(this.lastFrame().position, this.target, this.lastFrame().velocity, this.mass, this.damping);\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/simulation/SpringSimulator.js?");

/***/ }),

/***/ "./src/js/simulation/VectorSpringSimulator.js":
/*!****************************************************!*\
  !*** ./src/js/simulation/VectorSpringSimulator.js ***!
  \****************************************************/
/*! exports provided: VectorSpringSimulator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"VectorSpringSimulator\", function() { return VectorSpringSimulator; });\n/* harmony import */ var _SimulatorBase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SimulatorBase */ \"./src/js/simulation/SimulatorBase.js\");\n// import THREE from 'three';\r\n\r\n\r\nclass VectorSpringSimulator extends _SimulatorBase__WEBPACK_IMPORTED_MODULE_0__[\"SimulatorBase\"] {\r\n\r\n    constructor(fps, mass, damping) {\r\n\r\n        //Construct base\r\n        super(fps);\r\n\r\n        // Simulated values\r\n        this.position = new THREE.Vector3();\r\n        this.velocity = new THREE.Vector3();\r\n\r\n        // Simulation parameters\r\n        this.target = new THREE.Vector3();\r\n        this.mass = mass;\r\n        this.damping = damping;\r\n    }\r\n    \r\n    /**\r\n     * Advances the simulation by given time step\r\n     * @param {number} timeStep \r\n     */\r\n    simulate(timeStep) {\r\n        \r\n        if(timeStep == undefined) console.log('Pass the timeStep!');\r\n\r\n        // Generate new frames\r\n        this.generateFrames(timeStep);\r\n\r\n        // Return interpolation\r\n        this.position.lerpVectors(this.cache[0].position, this.cache[1].position, this.offset / this.frameTime); \r\n        this.velocity.lerpVectors(this.cache[0].velocity, this.cache[1].velocity, this.offset / this.frameTime);\r\n    }\r\n\r\n    /**\r\n     * Generates frames between last simulation call and the current one\r\n     * @param {timeStep} timeStep \r\n     */\r\n    generateFrames(timeStep) {\r\n\r\n        // Initialize cache by pushing two frames\r\n        if(this.cache.length == 0) {\r\n            for (let i = 0; i < 2; i++) {\r\n                this.cache.push({\r\n                    position: new THREE.Vector3(),\r\n                    velocity: new THREE.Vector3()\r\n                });\r\n            }\r\n        }\r\n\r\n        // Update cache\r\n        // Find out how many frames needs to be generated\r\n        let totalTimeStep = this.offset + timeStep;\r\n        let framesToGenerate = Math.floor(totalTimeStep / this.frameTime);\r\n        this.offset = totalTimeStep % this.frameTime;\r\n\r\n        // Generate simulation frames\r\n        if(framesToGenerate > 0) {\r\n            for (let i = 0; i < framesToGenerate; i++) {\r\n                this.cache.push(this.getFrame());\r\n            }\r\n            this.cache = this.cache.slice(-2);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets another simulation frame\r\n     */\r\n    getFrame() {\r\n        // Deep clone data from previous frame\r\n        let newSpring = {\r\n            position: this.lastFrame().position.clone(),\r\n            velocity: this.lastFrame().velocity.clone()\r\n        };\r\n        // Calculate new Spring\r\n        Object(_SimulatorBase__WEBPACK_IMPORTED_MODULE_0__[\"springV\"])(newSpring.position, this.target, newSpring.velocity, this.mass, this.damping);\r\n        // Return new Spring\r\n        return newSpring;\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/simulation/VectorSpringSimulator.js?");

/***/ }),

/***/ "./src/js/sketchbook.js":
/*!******************************!*\
  !*** ./src/js/sketchbook.js ***!
  \******************************/
/*! exports provided: CameraControls, Character, CharacterAI_Default, CharacterAI_FollowCharacter, CharacterAI_Random, CharacterState_DefaultState, CharacterState_DropIdle, CharacterState_DropRunning, CharacterState_EndWalk, CharacterState_Falling, CharacterState_Idle, CharacterState_JumpIdle, CharacterState_JumpRunning, CharacterState_Sprint, CharacterState_StartWalkForward, CharacterState_Walk, Control_EventControl, Control_LerpControl, GameMode_CharacterControls, GameMode_FreeCameraControls, Utilities, World */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_shaders_EffectComposer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/shaders/EffectComposer */ \"./src/js/lib/shaders/EffectComposer.js\");\n/* harmony import */ var _lib_shaders_EffectComposer__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lib_shaders_EffectComposer__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_shaders_RenderPass__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/shaders/RenderPass */ \"./src/js/lib/shaders/RenderPass.js\");\n/* harmony import */ var _lib_shaders_RenderPass__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_lib_shaders_RenderPass__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_shaders_MaskPass__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./lib/shaders/MaskPass */ \"./src/js/lib/shaders/MaskPass.js\");\n/* harmony import */ var _lib_shaders_MaskPass__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_lib_shaders_MaskPass__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_shaders_ShaderPass__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./lib/shaders/ShaderPass */ \"./src/js/lib/shaders/ShaderPass.js\");\n/* harmony import */ var _lib_shaders_ShaderPass__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_lib_shaders_ShaderPass__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _lib_shaders_FXAAShader__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./lib/shaders/FXAAShader */ \"./src/js/lib/shaders/FXAAShader.js\");\n/* harmony import */ var _lib_shaders_FXAAShader__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_lib_shaders_FXAAShader__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _lib_shaders_CopyShader__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./lib/shaders/CopyShader */ \"./src/js/lib/shaders/CopyShader.js\");\n/* harmony import */ var _lib_shaders_CopyShader__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_lib_shaders_CopyShader__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _lib_shaders_Sky__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./lib/shaders/Sky */ \"./src/js/lib/shaders/Sky.js\");\n/* harmony import */ var _lib_shaders_Sky__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_lib_shaders_Sky__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var _lib_utils_Detector__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./lib/utils/Detector */ \"./src/js/lib/utils/Detector.js\");\n/* harmony import */ var _lib_utils_Detector__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_lib_utils_Detector__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var _lib_utils_Stats__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./lib/utils/Stats */ \"./src/js/lib/utils/Stats.js\");\n/* harmony import */ var _lib_utils_Stats__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(_lib_utils_Stats__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var _lib_utils_dat_gui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./lib/utils/dat.gui */ \"./src/js/lib/utils/dat.gui.js\");\n/* harmony import */ var _lib_utils_dat_gui__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(_lib_utils_dat_gui__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var _lib_utils_inflate_min__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./lib/utils/inflate.min */ \"./src/js/lib/utils/inflate.min.js\");\n/* harmony import */ var _lib_utils_inflate_min__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(_lib_utils_inflate_min__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var _lib_utils_FBXLoader__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./lib/utils/FBXLoader */ \"./src/js/lib/utils/FBXLoader.js\");\n/* harmony import */ var _lib_utils_FBXLoader__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(_lib_utils_FBXLoader__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var _lib_utils_SceneUtils__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./lib/utils/SceneUtils */ \"./src/js/lib/utils/SceneUtils.js\");\n/* harmony import */ var _lib_utils_SceneUtils__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(_lib_utils_SceneUtils__WEBPACK_IMPORTED_MODULE_12__);\n/* harmony import */ var _sketchbook_CameraControls__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./sketchbook/CameraControls */ \"./src/js/sketchbook/CameraControls.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CameraControls\", function() { return _sketchbook_CameraControls__WEBPACK_IMPORTED_MODULE_13__[\"CameraControls\"]; });\n\n/* harmony import */ var _characters_Character__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./characters/Character */ \"./src/js/characters/Character.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"Character\", function() { return _characters_Character__WEBPACK_IMPORTED_MODULE_14__[\"Character\"]; });\n\n/* harmony import */ var _characters_CharacterAI__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./characters/CharacterAI */ \"./src/js/characters/CharacterAI.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterAI_Default\", function() { return _characters_CharacterAI__WEBPACK_IMPORTED_MODULE_15__[\"CharacterAI_Default\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterAI_FollowCharacter\", function() { return _characters_CharacterAI__WEBPACK_IMPORTED_MODULE_15__[\"CharacterAI_FollowCharacter\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterAI_Random\", function() { return _characters_CharacterAI__WEBPACK_IMPORTED_MODULE_15__[\"CharacterAI_Random\"]; });\n\n/* harmony import */ var _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./characters/CharacterStates */ \"./src/js/characters/CharacterStates.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_DefaultState\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_DefaultState\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_DropIdle\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_DropIdle\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_DropRunning\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_DropRunning\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_EndWalk\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_EndWalk\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_Falling\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_Falling\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_Idle\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_Idle\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_JumpIdle\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_JumpIdle\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_JumpRunning\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_JumpRunning\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_Sprint\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_Sprint\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_StartWalkForward\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_StartWalkForward\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"CharacterState_Walk\", function() { return _characters_CharacterStates__WEBPACK_IMPORTED_MODULE_16__[\"CharacterState_Walk\"]; });\n\n/* harmony import */ var _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./sketchbook/Controls */ \"./src/js/sketchbook/Controls.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"Control_EventControl\", function() { return _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_17__[\"Control_EventControl\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"Control_LerpControl\", function() { return _sketchbook_Controls__WEBPACK_IMPORTED_MODULE_17__[\"Control_LerpControl\"]; });\n\n/* harmony import */ var _sketchbook_GameModes__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./sketchbook/GameModes */ \"./src/js/sketchbook/GameModes.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"GameMode_CharacterControls\", function() { return _sketchbook_GameModes__WEBPACK_IMPORTED_MODULE_18__[\"GameMode_CharacterControls\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"GameMode_FreeCameraControls\", function() { return _sketchbook_GameModes__WEBPACK_IMPORTED_MODULE_18__[\"GameMode_FreeCameraControls\"]; });\n\n/* harmony import */ var _sketchbook_Utilities__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./sketchbook/Utilities */ \"./src/js/sketchbook/Utilities.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"Utilities\", function() { return _sketchbook_Utilities__WEBPACK_IMPORTED_MODULE_19__[\"Utilities\"]; });\n\n/* harmony import */ var _sketchbook_World__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./sketchbook/World */ \"./src/js/sketchbook/World.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"World\", function() { return _sketchbook_World__WEBPACK_IMPORTED_MODULE_20__[\"World\"]; });\n\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// require('./lib/shaders/EffectComposer');\r\n// require('./lib/shaders/RenderPass');\r\n// require('./lib/shaders/MaskPass');\r\n// require('./lib/shaders/ShaderPass');\r\n// require('./lib/shaders/FXAAShader');\r\n// require('./lib/shaders/CopyShader');\r\n// require('./lib/shaders/Sky');\r\n\r\n// require('./lib/utils/Detector');\r\n// require('./lib/utils/Stats');\r\n// require('./lib/utils/dat.gui');\r\n// require('./lib/utils/inflate.min');\r\n// require('./lib/utils/FBXLoader');\r\n// require('./lib/utils/SceneUtils');\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n\n//# sourceURL=webpack://Sketchbook/./src/js/sketchbook.js?");

/***/ }),

/***/ "./src/js/sketchbook/CameraControls.js":
/*!*********************************************!*\
  !*** ./src/js/sketchbook/CameraControls.js ***!
  \*********************************************/
/*! exports provided: CameraControls */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CameraControls\", function() { return CameraControls; });\n// import THREE from 'three';\r\n\r\nclass CameraControls {\r\n    constructor(camera) {\r\n\r\n        this.camera = camera;\r\n        this.target = new THREE.Vector3();\r\n    \r\n        this.radius = 3;\r\n        this.theta = 0;\r\n        this.phi = 0;\r\n    \r\n        this.onMouseDownPosition = new THREE.Vector2();\r\n        this.onMouseDownTheta = this.theta;\r\n        this.onMouseDownPhi = this.phi;\r\n    \r\n        document.addEventListener( 'mousedown', this.onMouseDown, false );\r\n    }\r\n\r\n    onMouseDown(event) {\r\n        this.onMouseDownPosition = new THREE.Vector2(event.clientX, event.clientY);\r\n        this.onMouseDownTheta = this.theta;\r\n        this.onMouseDownPhi = this.phi;\r\n\r\n        document.addEventListener( 'mousemove', this.onMouseMove, false );\r\n        document.addEventListener( 'mouseup', this.onMouseUp, false );\r\n    }\r\n\r\n    onMouseMove(event) {\r\n        this.theta = -((event.clientX - this.onMouseDownPosition.x) * 0.5) + this.onMouseDownTheta;\r\n        this.phi = ((event.clientY - this.onMouseDownPosition.y) * 0.5) + this.onMouseDownPhi;\r\n        this.phi = Math.min( 179, Math.max( -179, this.phi ) );\r\n    }\r\n\r\n    onMouseUp(event) {\r\n        document.removeEventListener( 'mousemove', this.onMouseMove, false );\r\n        document.removeEventListener( 'mouseup', this.onMouseUp, false );\r\n    }\r\n\r\n    setRadius(value) {\r\n        this.radius = Math.max( 0.001, value );\r\n    }\r\n    \r\n    update() {\r\n        this.camera.position.x = this.target.x + this.radius * Math.sin( this.theta * Math.PI / 360 ) * Math.cos( this.phi * Math.PI / 360 );\r\n        this.camera.position.y = this.target.y + this.radius * Math.sin( this.phi * Math.PI / 360 );\r\n        this.camera.position.z = this.target.z + this.radius * Math.cos( this.theta * Math.PI / 360 ) * Math.cos( this.phi * Math.PI / 360 );\r\n        this.camera.updateMatrix();\r\n        this.camera.lookAt(this.target);\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/sketchbook/CameraControls.js?");

/***/ }),

/***/ "./src/js/sketchbook/Controls.js":
/*!***************************************!*\
  !*** ./src/js/sketchbook/Controls.js ***!
  \***************************************/
/*! exports provided: Control_EventControl, Control_LerpControl */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Control_EventControl\", function() { return Control_EventControl; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Control_LerpControl\", function() { return Control_LerpControl; });\nclass Control_EventControl {\r\n    constructor() {\r\n        this.value = false;\r\n        this.justPressed = false;\r\n        this.justReleased = false;\r\n    }\r\n}\r\n\r\nclass Control_LerpControl {\r\n    constructor() {\r\n        this.value = false;\r\n        this.floatValue = 0;\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/sketchbook/Controls.js?");

/***/ }),

/***/ "./src/js/sketchbook/GameModes.js":
/*!****************************************!*\
  !*** ./src/js/sketchbook/GameModes.js ***!
  \****************************************/
/*! exports provided: GameMode_FreeCameraControls, GameMode_CharacterControls */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"GameMode_FreeCameraControls\", function() { return GameMode_FreeCameraControls; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"GameMode_CharacterControls\", function() { return GameMode_CharacterControls; });\n/* harmony import */ var _Controls__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Controls */ \"./src/js/sketchbook/Controls.js\");\n// import THREE from 'three';\r\n\r\n\r\n/**\r\n * Free camera game mode.\r\n * @param {Character} character Character to control \r\n */\r\nclass GameMode_FreeCameraControls {\r\n\r\n    constructor(sketchbook) {\r\n        this.sketchbook = sketchbook;\r\n        this.camera = sketchbook.camera;\r\n        this.previousGameMode = sketchbook.gameMode;\r\n        this.movementSpeed = 0.06;\r\n    \r\n        this.init();\r\n        // sketchbook.cameraControls.update();\r\n    \r\n        // Keymap\r\n        this.keymap = {\r\n            'w':      { action: 'forward'  },\r\n            's':      { action: 'back'     },\r\n            'a':      { action: 'left'     },\r\n            'd':      { action: 'right'    },\r\n            'e':      { action: 'up'       },\r\n            'q':      { action: 'down'     },\r\n            'shift':  { action: 'fast'     }\r\n        };\r\n    \r\n        this.controls = {\r\n            forward:   new _Controls__WEBPACK_IMPORTED_MODULE_0__[\"Control_LerpControl\"](),\r\n            left:      new _Controls__WEBPACK_IMPORTED_MODULE_0__[\"Control_LerpControl\"](),\r\n            right:     new _Controls__WEBPACK_IMPORTED_MODULE_0__[\"Control_LerpControl\"](),\r\n            up:        new _Controls__WEBPACK_IMPORTED_MODULE_0__[\"Control_LerpControl\"](),\r\n            back:      new _Controls__WEBPACK_IMPORTED_MODULE_0__[\"Control_LerpControl\"](),\r\n            down:      new _Controls__WEBPACK_IMPORTED_MODULE_0__[\"Control_LerpControl\"](),\r\n            fast:      new _Controls__WEBPACK_IMPORTED_MODULE_0__[\"Control_LerpControl\"]()\r\n        };\r\n    }\r\n    \r\n    init() {\r\n        this.sketchbook.cameraControls.target.copy(this.sketchbook.camera.position);\r\n        this.sketchbook.cameraControls.setRadius(0);\r\n        this.sketchbook.dirLight.target = this.camera;\r\n    }\r\n    \r\n    /**\r\n     * Handles game actions based on supplied inputs.\r\n     * @param {*} event Keyboard or mouse event\r\n     * @param {char} key Key or button pressed\r\n     * @param {boolean} value Value to be assigned to action\r\n     */\r\n    handleKey(event, key, value) {\r\n    \r\n        // Shift modifier fix\r\n        key = key.toLowerCase();\r\n    \r\n        // Turn off free cam\r\n        if(this.previousGameMode != undefined && key == 'c' && value == true && event.shiftKey == true) {\r\n            this.sketchbook.gameMode = this.previousGameMode;\r\n            this.sketchbook.gameMode.init();\r\n        }\r\n        // Is key bound to action\r\n        else if (key in this.keymap) {\r\n    \r\n            // Get action and set it's parameters\r\n            let action = this.controls[this.keymap[key].action];\r\n            action.value = value;\r\n        }\r\n    }\r\n    \r\n    update() {\r\n        \r\n        // Make light follow camera (for shadows)\r\n        this.sketchbook.dirLight.position.set(this.camera.position.x + this.sketchbook.sun.x * 5, this.camera.position.y + this.sketchbook.sun.y * 5, this.camera.position.z + this.sketchbook.sun.z * 5);\r\n       \r\n        for(let key in this.controls){\r\n            let ctrl = this.controls[key];\r\n            ctrl.floatValue = Math.lerp(ctrl.floatValue, +ctrl.value , 0.3);\r\n        }\r\n    \r\n        let forward = new THREE.Vector3(  0,  0, -1 ).applyQuaternion(this.camera.quaternion);\r\n        let back    = new THREE.Vector3(  0,  0,  1 ).applyQuaternion(this.camera.quaternion);\r\n        let left    = new THREE.Vector3( -1,  0,  0 ).applyQuaternion(this.camera.quaternion);\r\n        let right   = new THREE.Vector3(  1,  0,  0 ).applyQuaternion(this.camera.quaternion);\r\n        let up      = new THREE.Vector3(  0,  1,  0 ).applyQuaternion(this.camera.quaternion);\r\n        let down    = new THREE.Vector3(  0, -1,  0 ).applyQuaternion(this.camera.quaternion);\r\n        \r\n        let speed = this.movementSpeed * (this.controls.fast.value ? 3 : 1);\r\n    \r\n        this.sketchbook.cameraControls.target.add(forward.multiplyScalar(speed * this.controls.forward.floatValue));\r\n        this.sketchbook.cameraControls.target.add(back.multiplyScalar(speed * this.controls.back.floatValue));\r\n        this.sketchbook.cameraControls.target.add(left.multiplyScalar(speed * this.controls.left.floatValue));\r\n        this.sketchbook.cameraControls.target.add(right.multiplyScalar(speed * this.controls.right.floatValue));\r\n        this.sketchbook.cameraControls.target.add(up.multiplyScalar(speed * this.controls.up.floatValue));\r\n        this.sketchbook.cameraControls.target.add(down.multiplyScalar(speed * this.controls.down.floatValue));\r\n    }\r\n}\r\n\r\n/**\r\n * Character controls game mode. Allows player to control a character.\r\n * @param {Character} character Character to control \r\n */\r\nclass GameMode_CharacterControls {\r\n\r\n    constructor(sketchbook, character) {\r\n        this.sketchbook = sketchbook;\r\n        this.character = character;\r\n    \r\n        this.init();\r\n    \r\n        // Keymap\r\n        this.keymap = {\r\n            'w':      { action: 'up'       },\r\n            's':      { action: 'down'     },\r\n            'a':      { action: 'left'     },\r\n            'd':      { action: 'right'    },\r\n            'shift':  { action: 'run'      },\r\n            ' ':      { action: 'jump'     },\r\n            'e':      { action: 'use'      },\r\n            'mouse0': { action: 'primary'  },\r\n            'mouse2': { action: 'secondary'},\r\n            'mouse1': { action: 'tertiary' }\r\n        };\r\n    }\r\n    \r\n    init() {\r\n        this.sketchbook.cameraControls.setRadius(2);\r\n        this.sketchbook.dirLight.target = this.character;\r\n    }\r\n    \r\n    /**\r\n     * Handles game actions based on supplied inputs.\r\n     * @param {*} event Keyboard or mouse event\r\n     * @param {char} key Key or button pressed\r\n     * @param {boolean} value Value to be assigned to action\r\n     */\r\n    handleKey(event, key, value) {\r\n    \r\n        // Shift modifier fix\r\n        key = key.toLowerCase();\r\n    \r\n        //Free cam\r\n        if(key == 'c' && value == true && event.shiftKey == true) {\r\n            this.character.resetControls();\r\n            this.sketchbook.gameMode = new FreeCameraControls(this.sketchbook, this);\r\n        }\r\n        // Is key bound to action\r\n        if (key in this.keymap) {\r\n            this.character.setControl(this.keymap[key].action, value);\r\n        }\r\n    }\r\n    \r\n    update() {\r\n    \r\n        // Look in camera's direction\r\n        this.character.viewVector = new THREE.Vector3().subVectors(this.character.position, this.sketchbook.camera.position);\r\n        \r\n        // Make light follow player (for shadows)\r\n        this.sketchbook.dirLight.position.set(this.character.position.x + this.sketchbook.sun.x * 5, this.character.position.y + this.sketchbook.sun.y * 5, this.character.position.z + this.sketchbook.sun.z * 5);\r\n        \r\n        // Position camera\r\n        this.sketchbook.cameraControls.target.copy(\r\n            new THREE.Vector3(\r\n                this.character.position.x,\r\n                this.character.position.y + this.character.height / 1.7,\r\n                this.character.position.z)\r\n        );\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/sketchbook/GameModes.js?");

/***/ }),

/***/ "./src/js/sketchbook/Utilities.js":
/*!****************************************!*\
  !*** ./src/js/sketchbook/Utilities.js ***!
  \****************************************/
/*! exports provided: Utilities */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Utilities\", function() { return Utilities; });\n// import THREE from 'three';\r\n\r\nclass Utilities {\r\n    //\r\n    // Geometry\r\n    //\r\n    static createCapsuleGeometry(radius = 1, height = 2, N = 32) {\r\n        const geometry = new THREE.Geometry();\r\n        const TWOPI = Math.PI*2;\r\n    \r\n        const PID2 = 1.570796326794896619231322;\r\n    \r\n        const normals = [];\r\n    \r\n        // top cap\r\n        for (let i = 0; i <= N / 4; i++) {\r\n            for (let j = 0; j <= N; j++) {\r\n                let theta = j * TWOPI / N;\r\n                let phi = -PID2 + Math.PI * i / (N / 2);\r\n                let vertex = new THREE.Vector3();\r\n                let normal = new THREE.Vector3();\r\n                vertex.x = radius * Math.cos(phi) * Math.cos(theta);\r\n                vertex.y = radius * Math.cos(phi) * Math.sin(theta);\r\n                vertex.z = radius * Math.sin(phi);\r\n                vertex.z -= height / 2;\r\n                normal.x = vertex.x;\r\n                normal.y = vertex.y;\r\n                normal.z = vertex.z;\r\n                geometry.vertices.push(vertex);\r\n                normals.push(normal);\r\n            }\r\n        }\r\n\r\n        // bottom cap\r\n        for (let i = N / 4; i <= N / 2; i++) {\r\n            for (let j = 0; j <= N; j++) {\r\n                let theta = j * TWOPI / N;\r\n                let phi = -PID2 + Math.PI * i / (N / 2);\r\n                let vertex = new THREE.Vector3();\r\n                let normal = new THREE.Vector3();\r\n                vertex.x = radius * Math.cos(phi) * Math.cos(theta);\r\n                vertex.y = radius * Math.cos(phi) * Math.sin(theta);\r\n                vertex.z = radius * Math.sin(phi);\r\n                vertex.z += height / 2;\r\n                normal.x = vertex.x;\r\n                normal.y = vertex.y;\r\n                normal.z = vertex.z;\r\n                geometry.vertices.push(vertex);\r\n                normals.push(normal);\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i <= N / 2; i++) {\r\n            for (let j = 0; j < N; j++) {\r\n                let vec = new THREE.Vector4(\r\n                    i * (N + 1) + j,\r\n                    i * (N + 1) + (j + 1),\r\n                    (i + 1) * (N + 1) + (j + 1),\r\n                    (i + 1) * (N + 1) + j\r\n                );\r\n\r\n                if (i == N / 4) {\r\n                    let face_1 = new THREE.Face3(vec.x, vec.y, vec.z, [ //ok\r\n                        normals[vec.x],\r\n                        normals[vec.y],\r\n                        normals[vec.z]\r\n                    ]);\r\n\r\n                    let face_2 = new THREE.Face3(vec.x, vec.z, vec.w, [\r\n                        normals[vec.x],\r\n                        normals[vec.z],\r\n                        normals[vec.w]\r\n                    ]);\r\n\r\n                    geometry.faces.push(face_2);\r\n                    geometry.faces.push(face_1);\r\n                } else {\r\n                    let face_1 = new THREE.Face3(vec.x, vec.y, vec.z, [\r\n                        normals[vec.x],\r\n                        normals[vec.y],\r\n                        normals[vec.z]\r\n                    ]);\r\n\r\n                    let face_2 = new THREE.Face3(vec.x, vec.z, vec.w, [\r\n                        normals[vec.x],\r\n                        normals[vec.z],\r\n                        normals[vec.w]\r\n                    ]);\r\n\r\n                    geometry.faces.push(face_1);\r\n                    geometry.faces.push(face_2);\r\n                }\r\n            }\r\n            // if(i==(N/4)) break; // N/4 is when the center segments are solved\r\n        }\r\n    \r\n        geometry.computeFaceNormals();\r\n        // geometry.computeVertexNormals();\r\n    \r\n        return geometry;\r\n    }\r\n\r\n    /**\r\n     * Constructs a 2D matrix from first vector, replacing the Y axes with the global Y axis,\r\n     * and applies this matrix to the second vector. Saves performance when compared to full 3D matrix application.\r\n     * Useful for character rotation, as it only happens on the Y axis.\r\n     * @param {Vector3} a Vector to construct 2D matrix from\r\n     * @param {Vector3} b Vector to apply basis to\r\n     */\r\n    static appplyVectorMatrixXZ(a, b) {\r\n        return new THREE.Vector3(\r\n            a.x * b.z + a.z * b.x, 0,\r\n            a.z * b.z + -a.x * b.x\r\n        );\r\n    }\r\n\r\n    //\r\n    // Other\r\n    //\r\n\r\n    static createArray(length) {\r\n        let arr = new Array(length || 0),\r\n            i = length;\r\n\r\n        if (arguments.length > 1) {\r\n            let args = Array.prototype.slice.call(arguments, 1);\r\n            while(i--) arr[length-1 - i] = this.createArray.apply(this, args);\r\n        }\r\n\r\n        return arr;\r\n    }\r\n\r\n    static getGlobalProperties(prefix = '') {\r\n        let keyValues = [], global = window; // window for browser environments\r\n        for (let prop in global) {\r\n            if (prop.indexOf(prefix) == 0) // check the prefix\r\n                keyValues.push(prop /*+ \"=\" + global[prop]*/);\r\n        }\r\n        return keyValues; // build the string\r\n    }\r\n}\n\n//# sourceURL=webpack://Sketchbook/./src/js/sketchbook/Utilities.js?");

/***/ }),

/***/ "./src/js/sketchbook/World.js":
/*!************************************!*\
  !*** ./src/js/sketchbook/World.js ***!
  \************************************/
/*! exports provided: World */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* WEBPACK VAR INJECTION */(function(Detector, Stats) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"World\", function() { return World; });\n/* harmony import */ var _CameraControls__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./CameraControls */ \"./src/js/sketchbook/CameraControls.js\");\n/* harmony import */ var _Utilities__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Utilities */ \"./src/js/sketchbook/Utilities.js\");\n/* harmony import */ var _GameModes__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GameModes */ \"./src/js/sketchbook/GameModes.js\");\n// import THREE from 'three';\r\n// import CANNON from 'cannon';\r\n\r\n// import { Detector } from '../lib/utils/Detector';\r\n// import { Stats } from '../lib/utils/Stats';\r\n\r\n// import { GUI } from '../lib/utils/dat.gui';\r\n\r\n\r\n\r\n\r\nclass World {\r\n\r\n    constructor() {\r\n\r\n        this.characters = [];\r\n        this.vehicles = [];\r\n\r\n        const scope = this;\r\n\r\n        //#region HTML\r\n        \r\n        // WebGL not supported\r\n        if (!Detector.webgl) Detector.addGetWebGLMessage();\r\n\r\n        // Renderer\r\n        this.renderer = new THREE.WebGLRenderer();\r\n        this.renderer.setPixelRatio(window.devicePixelRatio);\r\n        this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n        this.renderer.shadowMap.enabled = true;\r\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n        document.body.appendChild(this.renderer.domElement);\r\n        // Global variables\r\n\r\n        // Auto window resize\r\n        function onWindowResize() {\r\n            scope.camera.aspect = window.innerWidth / window.innerHeight;\r\n            scope.camera.updateProjectionMatrix();\r\n            scope.renderer.setSize(window.innerWidth, window.innerHeight);\r\n            effectFXAA.uniforms['resolution'].value.set(1 / (window.innerWidth * dpr), 1 / (window.innerHeight * dpr));\r\n            scope.composer.setSize(window.innerWidth * dpr, window.innerHeight * dpr);\r\n        }\r\n        window.addEventListener('resize', onWindowResize, false);\r\n\r\n        // Stats (FPS, Frame time, Memory)\r\n        this.stats = new Stats();\r\n        document.body.appendChild(this.stats.dom);\r\n\r\n        //#endregion\r\n\r\n        //#region THREE\r\n\r\n        this.graphicsWorld = new THREE.Scene();\r\n\r\n        // Fog\r\n        // this.graphicsWorld.fog = new THREE.FogExp2(0xC8D3D5, 0.25);\r\n\r\n        // Camera\r\n        this.camera = new THREE.PerspectiveCamera(80, window.innerWidth / window.innerHeight, 0.1, 120);\r\n\r\n        // Scene render pass\r\n        let renderScene = new THREE.RenderPass(this.graphicsWorld, this.camera);\r\n\r\n        // DPR for FXAA\r\n        let dpr = 1;\r\n        if (window.devicePixelRatio !== undefined) {\r\n            dpr = window.devicePixelRatio;\r\n        }\r\n        // FXAA\r\n        let effectFXAA = new THREE.ShaderPass(THREE.FXAAShader);\r\n        effectFXAA.uniforms['resolution'].value.set(1 / (window.innerWidth * dpr), 1 / (window.innerHeight * dpr));\r\n        effectFXAA.renderToScreen = true;\r\n\r\n        // Composer\r\n        this.composer = new THREE.EffectComposer(this.renderer);\r\n        this.composer.setSize(window.innerWidth * dpr, window.innerHeight * dpr);\r\n        this.composer.addPass(renderScene);\r\n        this.composer.addPass(effectFXAA);\r\n\r\n        // Sky\r\n        let sky = new THREE.Sky();\r\n        sky.scale.setScalar(100);\r\n        this.graphicsWorld.add(sky);\r\n\r\n        // Sun helper\r\n        this.sun = new THREE.Vector3();\r\n        let theta = Math.PI * (-0.3);\r\n        let phi = 2 * Math.PI * (-0.25);\r\n        this.sun.x = Math.cos(phi);\r\n        this.sun.y = Math.sin(phi) * Math.sin(theta);\r\n        this.sun.z = Math.sin(phi) * Math.cos(theta);\r\n        sky.material.uniforms.sunPosition.value.copy(this.sun);\r\n\r\n        // Lighting\r\n        let ambientLight = new THREE.AmbientLight(0x888888); // soft white light\r\n        this.graphicsWorld.add(ambientLight);\r\n\r\n        // Sun light with shadowmap\r\n        this.dirLight = new THREE.DirectionalLight(0xffffff, 0.6);\r\n        this.dirLight.castShadow = true;\r\n\r\n        this.dirLight.shadow.mapSize.width = 1024;\r\n        this.dirLight.shadow.mapSize.height = 1024;\r\n        this.dirLight.shadow.camera.near = 0.5;\r\n        this.dirLight.shadow.camera.far = 8;\r\n\r\n        this.dirLight.shadow.camera.top = 5;\r\n        this.dirLight.shadow.camera.right = 5;\r\n        this.dirLight.shadow.camera.bottom = -5;\r\n        this.dirLight.shadow.camera.left = -5;\r\n\r\n        this.dirLight.shadow.camera;\r\n        this.graphicsWorld.add(this.dirLight);\r\n\r\n        // Helpers\r\n        let helper = new THREE.GridHelper(10, 10, 0x000000, 0x000000);\r\n        helper.position.set(0, 0.01, 0);\r\n        helper.material.opacity = 0.2;\r\n        helper.material.transparent = true;\r\n        this.graphicsWorld.add( helper );\r\n        helper = new THREE.AxesHelper(2);\r\n        // this.graphicsWorld.add( helper );\r\n        helper = new THREE.DirectionalLightHelper(this.dirLight, 3);\r\n        // this.graphicsWorld.add( helper );\r\n        helper = new THREE.CameraHelper(this.dirLight.shadow.camera);\r\n        // this.graphicsWorld.add( helper );\r\n\r\n        //#endregion\r\n\r\n        //#region CANNON\r\n\r\n        this.physicsWorld = new CANNON.World();\r\n        this.physicsWorld.gravity.set(0,-9.81,0);\r\n        this.physicsWorld.broadphase = new CANNON.NaiveBroadphase();\r\n        this.physicsWorld.solver.iterations = 10;\r\n\r\n        this.parallelPairs = [];\r\n        this.physicsFramerate = 1/60;\r\n        this.physicsMaxPrediction = 10;\r\n\r\n        //#endregion\r\n\r\n        //#region RenderLoop\r\n\r\n        this.clock = new THREE.Clock();\r\n        this.delta = 0;\r\n        this.sinceLastFrame = 0;\r\n        this.justRendered = false;\r\n\r\n        //#endregion\r\n\r\n        //#region Input\r\n\r\n        // Input\r\n        // Event listeners\r\n        document.addEventListener(\"keydown\", keyDown, false);\r\n        document.addEventListener(\"keyup\", keyUp, false);\r\n        document.addEventListener(\"mousedown\", mouseDown, false);\r\n        document.addEventListener(\"mouseup\", mouseUp, false);\r\n        document.addEventListener(\"wheel\", mouseWheel, false);\r\n\r\n        // Event handlers\r\n        function keyDown(event) {\r\n            if(typeof scope.gameMode !== 'undefined')\r\n                scope.gameMode.handleKey(event, event.key, true);\r\n        }\r\n        function keyUp(event) {\r\n            if(typeof scope.gameMode !== 'undefined')\r\n                scope.gameMode.handleKey(event, event.key, false);\r\n        }\r\n        function mouseDown(event) {\r\n            if(typeof scope.gameMode !== 'undefined')\r\n                scope.gameMode.handleKey(event, 'mouse' + event.button, true);\r\n        }\r\n        function mouseUp(event) {\r\n            if(typeof scope.gameMode !== 'undefined')\r\n                scope.gameMode.handleKey(event, 'mouse' + event.button, false);\r\n        }\r\n\r\n        // Changing time scale with scroll wheel\r\n        this.timeScaleBottomLimit = 0.003;\r\n        this.timeScaleChangeSpeed = 1.3;\r\n        this.timeScaleTarget = 1;\r\n        function mouseWheel(event) {\r\n\r\n            if(event.deltaY > 0) {\r\n                scope.timeScaleTarget /= scope.timeScaleChangeSpeed;\r\n                if(scope.timeScaleTarget < scope.timeScaleBottomLimit) scope.timeScaleTarget = 0;\r\n            }\r\n            else {\r\n                scope.timeScaleTarget *= scope.timeScaleChangeSpeed;\r\n                if(scope.timeScaleTarget < scope.timeScaleBottomLimit) scope.timeScaleTarget = scope.timeScaleBottomLimit;\r\n                scope.timeScaleTarget = Math.min(scope.timeScaleTarget, 9999999999);\r\n                if(scope.params.Time_Scale > 0.9) scope.params.Time_Scale *= scope.timeScaleChangeSpeed;\r\n            }\r\n        }\r\n\r\n        //#endregion\r\n        \r\n        //#region ParamGUI\r\n        \r\n        // Variables\r\n        let params = {\r\n            FPS_Limit: 60,\r\n            Time_Scale: 1,\r\n            Shadows: true,\r\n            FXAA: false,\r\n            Draw_Capsules: false,\r\n            RayCast_Debug: false\r\n        };\r\n        this.params = params;\r\n\r\n        let gui = new GUI();\r\n        let graphics_folder = gui.addFolder('Rendering');\r\n        graphics_folder.add(params, 'FPS_Limit', 0, 60);\r\n        let timeController = graphics_folder.add(params, 'Time_Scale', 0, 1).listen();\r\n        let shadowSwitch = graphics_folder.add(params, 'Shadows');\r\n        graphics_folder.add(params, 'FXAA');\r\n\r\n        let debug_folder = gui.addFolder('Debug');\r\n        let dc = debug_folder.add(params, 'Draw_Capsules');\r\n        let rcd = debug_folder.add(params, 'RayCast_Debug');\r\n\r\n        gui.open();\r\n        \r\n        timeController.onChange(function(value) {\r\n            this.timeScaleTarget = value;\r\n        });\r\n\r\n        dc.onChange(function(enabled) {\r\n            scope.characters.forEach(char => {\r\n                if(enabled) char.characterCapsule.visual.visible = true;\r\n                else        char.characterCapsule.visual.visible = false;\r\n            });\r\n        });\r\n\r\n        rcd.onChange(function(enabled) {\r\n            scope.characters.forEach(char => {\r\n                if(enabled) char.raycastBox.visible = true;\r\n                else        char.raycastBox.visible = false;\r\n            });\r\n        });\r\n\r\n        shadowSwitch.onChange(function(enabled) {\r\n            if(enabled) {\r\n                scope.dirLight.castShadow = true;\r\n            }\r\n            else {\r\n                scope.dirLight.castShadow = false;\r\n            }\r\n        });\r\n\r\n        //#endregion\r\n\r\n        //Initialization\r\n        this.cameraControls = new _CameraControls__WEBPACK_IMPORTED_MODULE_0__[\"CameraControls\"](this.camera);\r\n        this.gameMode = new _GameModes__WEBPACK_IMPORTED_MODULE_2__[\"GameMode_FreeCameraControls\"](this);\r\n        this.loader = new THREE.FBXLoader();\r\n    }\r\n\r\n    ControlCharacter(character) {\r\n        this.gameMode = new _GameModes__WEBPACK_IMPORTED_MODULE_2__[\"GameMode_FreeCameraControls\"](this, character);\r\n    }\r\n    \r\n    // Update\r\n    // Handles all logic updates.\r\n    Update(timeStep) {\r\n    \r\n        this.updatePhysics(timeStep);\r\n    \r\n        this.characters.forEach(char => {\r\n            char.behaviour.update(timeStep);\r\n            char.updateMatrixWorld();\r\n        });\r\n    \r\n        this.gameMode.update(timeStep);\r\n    \r\n        // Rotate and position camera according to cameraTarget and angles\r\n        this.cameraControls.update();\r\n    \r\n        // Lerp timescale parameter\r\n        this.params.Time_Scale = Math.lerp(this.params.Time_Scale, this.timeScaleTarget, 0.2);\r\n    }\r\n    \r\n    /**\r\n     * Render\r\n     * Rendering loop with variable FPS limit.\r\n     * Calls the \"Update\" function before rendering.\r\n     */\r\n    Render(World) {\r\n    \r\n        // Stats begin\r\n        if (this.justRendered) {\r\n            this.justRendered = false;\r\n            this.stats.begin();\r\n        }\r\n    \r\n        requestAnimationFrame(function() {\r\n            World.Render(World);\r\n        });\r\n    \r\n        // Measuring time and correcting for variable timeScale\r\n        this.delta = this.clock.getDelta();\r\n        let timeStep = this.delta * this.params.Time_Scale;\r\n    \r\n        // Logic\r\n        World.Update(timeStep);\r\n    \r\n        // Frame limiting\r\n        this.sinceLastFrame += this.delta + this.clock.getDelta();\r\n        let interval = 1 / this.params.FPS_Limit;\r\n        if (this.sinceLastFrame > interval) {\r\n            this.sinceLastFrame %= interval;\r\n    \r\n            // Actual rendering with a FXAA ON/OFF switch\r\n            if (this.params.FXAA) this.composer.render();\r\n            else this.renderer.render(this.graphicsWorld, this.camera);\r\n    \r\n            // Stats end\r\n            this.stats.end();\r\n            this.justRendered = true;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Start\r\n     * Starts sketchbook rendering and logic\r\n     */\r\n    Start() {\r\n        this.Render(this);\r\n    }\r\n    \r\n    /**\r\n     * Adds character to sketchbook\r\n     * @param {Character} character \r\n     */\r\n    AddCharacter(character) {\r\n    \r\n        // Register character\r\n        this.characters.push(character);\r\n        \r\n        // Register physics\r\n        this.physicsWorld.addBody(character.characterCapsule.physical);\r\n        \r\n        // Register capsule visuals\r\n        this.graphicsWorld.add(character.characterCapsule.visual);\r\n        this.graphicsWorld.add(character.raycastBox);\r\n    \r\n        // Register for synchronization\r\n        this.parallelPairs.push(character.characterCapsule);\r\n    \r\n        // Add to graphicsWorld\r\n        this.graphicsWorld.add(character);\r\n    }\r\n    \r\n    updatePhysics(timeStep) {\r\n        // Step the physics world\r\n        this.physicsWorld.step(this.physicsFramerate, timeStep, this.physicsMaxPrediction);\r\n    \r\n        // Sync physics/visuals\r\n        this.parallelPairs.forEach(pair => {\r\n    \r\n            if(pair.physical.position.y < -1) {\t\r\n                pair.physical.position.y = 10;\r\n            }\r\n    \r\n            if(pair.physical.position.y > 10) {\t\r\n                pair.physical.position.y = -1;\r\n            }\r\n    \r\n            if(pair.physical.position.x > 8) {\t\r\n                pair.physical.position.x = -8;\r\n            }\r\n    \r\n            if(pair.physical.position.x < -8) {\t\r\n                pair.physical.position.x = 8;\r\n            }\r\n    \r\n            if(pair.physical.position.z > 8) {\t\r\n                pair.physical.position.z = -8;\r\n            }\r\n    \r\n            if(pair.physical.position.z < -8) {\t\r\n                pair.physical.position.z = 8;\r\n            }\r\n    \r\n            pair.visual.position.copy(pair.physical.interpolatedPosition);\r\n            pair.visual.quaternion.copy(pair.physical.interpolatedQuaternion);\r\n        });\r\n    }\r\n    \r\n    createBoxPrimitive(options) {\r\n    \r\n        let mass = options.mass || 1;\r\n        let position = options.position || new CANNON.Vec3();\r\n        let size = options.size || new CANNON.Vec3(0.3, 0.3, 0.3);\r\n        let friction = options.friction || 0.3;\r\n        let visible = options.visible || true;\r\n\r\n        let mat = new CANNON.Material();\r\n        mat.friction = friction;\r\n    \r\n        let shape = new CANNON.Box(size);\r\n        shape.material = mat;\r\n    \r\n        // Add phys sphere\r\n        let physBox = new CANNON.Body({\r\n            mass: mass,\r\n            position: position,\r\n            shape: shape\r\n        });\r\n    \r\n        physBox.material = mat;\r\n        this.physicsWorld.addBody(physBox);\r\n        \r\n        // Add visual box\r\n        let geometry = new THREE.BoxGeometry( size.x*2, size.y*2, size.z*2 );\r\n        let material = new THREE.MeshLambertMaterial( { color: 0xcccccc } );\r\n        let visualBox = new THREE.Mesh( geometry, material );\r\n        visualBox.castShadow = true;\r\n        visualBox.receiveShadow = true;\r\n        visualBox.visible = visible;\r\n        this.graphicsWorld.add( visualBox );\r\n    \r\n        let pair = {\r\n            physical: physBox,\r\n            visual: visualBox\r\n        };\r\n      \r\n        this.parallelPairs.push(pair);\r\n        return pair;\r\n    }\r\n    \r\n    createSpherePrimitive(options) {\r\n    \r\n        let mass = options.mass || 1;\r\n        let position = options.position || new CANNON.Vec3();\r\n        let radius = options.radius || 0.3;\r\n        let friction = options.friction || 0.3;\r\n        let visible = options.visible || true;\r\n\r\n        let mat = new CANNON.Material();\r\n        mat.friction = friction;\r\n    \r\n        let shape = new CANNON.Sphere(radius);\r\n        shape.material = mat;\r\n    \r\n        // Add phys sphere\r\n        let physSphere = new CANNON.Body({\r\n            mass: mass, // kg\r\n            position: position, // m\r\n            shape: shape\r\n        });\r\n        physSphere.material = mat;\r\n        this.physicsWorld.addBody(physSphere);\r\n        \r\n        // Add visual sphere\r\n        let geometry2 = new THREE.SphereGeometry(radius);\r\n        let material2 = new THREE.MeshLambertMaterial( { color: 0xcccccc } );\r\n        let visualSphere = new THREE.Mesh( geometry2, material2 );\r\n        visualSphere.castShadow = true;\r\n        visualSphere.receiveShadow = true;\r\n        visualSphere.visible = visible;\r\n        this.graphicsWorld.add( visualSphere );\r\n    \r\n        let pair = {\r\n            physical: physSphere,\r\n            visual: visualSphere\r\n        };\r\n    \r\n        this.parallelPairs.push(pair);\r\n        return pair;\r\n    }\r\n    \r\n    createCapsulePrimitive(options) {\r\n    \r\n        let mass = options.mass || 1;\r\n        let position = options.position || new CANNON.Vec3();\r\n        let height = options.height || 0.5;\r\n        let radius = options.radius || 0.25;\r\n        let segments = options.segments || 8;\r\n        let friction = options.friction || 0.3;\r\n        let visible = options.visible || true;\r\n\r\n        let mat = new CANNON.Material();\r\n        mat.friction = friction;\r\n    \r\n        let physicalCapsule = new CANNON.Body({\r\n            mass: mass,\r\n            position: position\r\n        });\r\n        \r\n        // Compound shape\r\n        let sphereShape = new CANNON.Sphere(radius);\r\n        let cylinderShape = new CANNON.Cylinder(radius, radius, height / 2, segments);\r\n        cylinderShape.transformAllPoints(new CANNON.Vec3(), new CANNON.Quaternion(0.707,0,0,0.707));\r\n    \r\n        // Materials\r\n        physicalCapsule.material = mat;\r\n        sphereShape.material = mat;\r\n        cylinderShape.material = mat;\r\n    \r\n        physicalCapsule.addShape(sphereShape, new CANNON.Vec3( 0, height / 2, 0));\r\n        physicalCapsule.addShape(sphereShape, new CANNON.Vec3( 0, -height / 2, 0));\r\n        physicalCapsule.addShape(cylinderShape, new CANNON.Vec3( 0, 0, 0));\r\n    \r\n        let visualCapsule = new THREE.Mesh(\r\n            _Utilities__WEBPACK_IMPORTED_MODULE_1__[\"Utilities\"].createCapsuleGeometry(radius, height, segments).rotateX(Math.PI/2),\r\n            new THREE.MeshLambertMaterial( { color: 0xcccccc, wireframe: true} )\r\n        );\r\n        visualCapsule.visible = visible;\r\n    \r\n        let pair = {\r\n            physical: physicalCapsule,\r\n            visual: visualCapsule\r\n        };\r\n    \r\n        return pair;\r\n    }\r\n}\r\n\r\n\r\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./src/js/lib/utils/Detector.js */ \"./src/js/lib/utils/Detector.js\"), __webpack_require__(/*! ./src/js/lib/utils/Detector.js */ \"./src/js/lib/utils/Detector.js\")))\n\n//# sourceURL=webpack://Sketchbook/./src/js/sketchbook/World.js?");

/***/ }),

/***/ "three":
/*!************************!*\
  !*** external "THREE" ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = __WEBPACK_EXTERNAL_MODULE_three__;\n\n//# sourceURL=webpack://Sketchbook/external_%22THREE%22?");

/***/ })

/******/ });
});